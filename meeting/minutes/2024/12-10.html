<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>QT4 CG Meeting 102 Minutes 2024-12-10</title>
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="/meeting/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="../../../css/style.css"/>
<link rel="shortcut icon" href="/img/QT4-64.png" />
<link rel="apple-touch-icon" sizes="64x64" href="/img/QT4-64.png" type="image/png" />
<link rel="apple-touch-icon" sizes="76x76" href="/img/QT4-76.png" type="image/png" />
<link rel="apple-touch-icon" sizes="120x120" href="/img/QT4-120.png" type="image/png" />
<link rel="apple-touch-icon" sizes="152x152" href="/img/QT4-152.png" type="image/png" />
</head>
<body>
<div id="content" class="content">
<h1 class="title">QT4 CG Meeting 102 Minutes 2024-12-10</h1>
<p>
<a href="../">Meeting index</a> / <a href="https://qt4cg.org">QT4CG.org</a> / <a href="https://qt4cg.org/dashboard">Dashboard</a> / <a href="https://github.com/qt4cg/qtspecs/issues">GH Issues</a> / <a href="https://github.com/qt4cg/qtspecs/pulls">GH Pull Requests</a>
</p>

<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#minutes">Draft Minutes</a></li>
<li><a href="#new-actions">Summary of new and continuing actions <code>[0/7]</code></a></li>
<li><a href="#administrivia">1. Administrivia</a>
<ul>
<li><a href="#roll-call">1.1. Roll call <code>[9/12]</code></a></li>
<li><a href="#agenda">1.2. Accept the agenda</a>
<ul>
<li><a href="#so-far">1.2.1. Status so far…</a></li>
</ul>
</li>
<li><a href="#approve-minutes">1.3. Approve minutes of the previous meeting</a></li>
<li><a href="#next-meeting">1.4. Next meeting</a></li>
<li><a href="#open-actions">1.5. Review of open action items <code>[4/11]</code></a></li>
<li><a href="#open-pull-requests">1.6. Review of open pull requests and issues</a>
<ul>
<li><a href="#blocked">1.6.1. Blocked</a></li>
<li><a href="#merge-without-discussion">1.6.2. Merge without discussion</a></li>
<li><a href="#close-without-action">1.6.3. Close without action</a></li>
<li><a href="#substantive">1.6.4. Substantive PRs</a></li>
<li><a href="#required-40">1.6.5. Required for V4.0</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#technical-agenda">2. Technical agenda</a>
<ul>
<li><a href="#pr-1636">2.1. PR #1636: Initial conversion of EXPath Binary/File</a></li>
<li><a href="#pr-1587">2.2. PR #1587: 557 Add fn:binary-resource</a></li>
<li><a href="#pr-1609">2.3. PR #1609: 564 Ordered Maps</a></li>
<li><a href="#pr-1616">2.4. PR #1616: A little cleanup; support function/xfunction globally</a></li>
</ul>
</li>
<li><a href="#any-other-business">3. Any other business</a></li>
<li><a href="#adjourned">4. Adjourned</a></li>
</ul>
</div>
</div>

<div id="outline-container-minutes" class="outline-2">
<h2 id="minutes">Draft Minutes</h2>
<div class="outline-text-2" id="text-minutes">
</div>
</div>

<div id="outline-container-new-actions" class="outline-2">
<h2 id="new-actions">Summary of new and continuing actions <code>[0/7]</code></h2>
<div class="outline-text-2" id="text-new-actions">
<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-080-07: NW to update the build instructions in the README</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-082-02: DN to work with MK to come to agreement on the fn:ranks proposal</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-088-01: NW to consider how best to add a dedication to MSM.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-088-04: [Someone] needs to update the processing model diagram needs vis-a-vis the static typing feature</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-089-01: CG to draft a PR that attempts to resolve the operators described in #755 to a smaller number of orthogonal choices.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-097-02: MK to make the XSD schema component references into links to XSD</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-097-03: DN to proposal an axis for accessing the siblings of a node.</li>
</ul>
</div>
</div>

<div id="outline-container-administrivia" class="outline-2">
<h2 id="administrivia"><span class="section-number-2">1.</span> Administrivia</h2>
<div class="outline-text-2" id="text-administrivia">
</div>

<div id="outline-container-roll-call" class="outline-3">
<h3 id="roll-call"><span class="section-number-3">1.1.</span> Roll call <code>[9/12]</code></h3>
<div class="outline-text-3" id="text-roll-call">
<ul class="org-ul">
<li class="on"><code>[X]</code> David J Birnbaum (DB)</li>
<li class="on"><code>[X]</code> Reece Dunn (RD)</li>
<li class="off"><code>[&#xa0;]</code> Sasha Firsov (SF)</li>
<li class="on"><code>[X]</code> Christian Grün (CG)</li>
<li class="off"><code>[&#xa0;]</code> Joel Kalvesmaki (JK)</li>
<li class="on"><code>[X]</code> Michael Kay (MK)</li>
<li class="on"><code>[X]</code> Juri Leino (JLO)</li>
<li class="on"><code>[X]</code> John Lumley (JWL)</li>
<li class="on"><code>[X]</code> Dimitre Novatchev (DN)</li>
<li class="on"><code>[X]</code> Wendell Piez (WP)</li>
<li class="off"><code>[&#xa0;]</code> Ed Porter (EP)</li>
<li class="on"><code>[X]</code> Norm Tovey-Walsh (NW). <i>Scribe</i>. <i>Chair</i>.</li>
</ul>
</div>
</div>

<div id="outline-container-agenda" class="outline-3">
<h3 id="agenda"><span class="section-number-3">1.2.</span> Accept the agenda</h3>
<div class="outline-text-3" id="text-agenda">
<p>
Proposal: Accept <a href="../../agenda/2024/12-10.html">the agenda</a>.
</p>

<p>
Accepted.
</p>
</div>

<div id="outline-container-so-far" class="outline-4">
<h4 id="so-far"><span class="section-number-4">1.2.1.</span> Status so far…</h4>
<div class="outline-text-4" id="text-so-far">
<p>
These charts have been adjusted so they reflect the preceding six months of work.
</p>


<div id="org884cf6f" class="figure">
<p><img src="./issues-open-2024-12-10.png" alt="issues-open-2024-12-10.png" />
</p>
<p><span class="figure-number">Figure 1: </span>“Burn down” chart on open issues</p>
</div>


<div id="org2030033" class="figure">
<p><img src="./issues-by-spec-2024-12-10.png" alt="issues-by-spec-2024-12-10.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Open issues by specification</p>
</div>


<div id="orgfbdb319" class="figure">
<p><img src="./issues-by-type-2024-12-10.png" alt="issues-by-type-2024-12-10.png" />
</p>
<p><span class="figure-number">Figure 3: </span>Open issues by type</p>
</div>
</div>
</div>
</div>

<div id="outline-container-approve-minutes" class="outline-3">
<h3 id="approve-minutes"><span class="section-number-3">1.3.</span> Approve minutes of the previous meeting</h3>
<div class="outline-text-3" id="text-approve-minutes">
<p>
Proposal: Accept <a href="../../minutes/2024/12-03.html">the minutes of the previous meeting</a>.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-next-meeting" class="outline-3">
<h3 id="next-meeting"><span class="section-number-3">1.4.</span> Next meeting</h3>
<div class="outline-text-3" id="text-next-meeting">
<p>
This next meeting is planned for 17 December. That will the last meeting
in 2024.
</p>

<p>
JWL gives regrets.
</p>

<p>
The CG does not plan to meet on 24 or 31 December.
</p>
</div>
</div>

<div id="outline-container-open-actions" class="outline-3">
<h3 id="open-actions"><span class="section-number-3">1.5.</span> Review of open action items <code>[4/11]</code></h3>
<div class="outline-text-3" id="text-open-actions">
<p>
(Items marked [X] are believed to have been closed via email before
this agenda was posted.)
</p>

<ul class="org-ul">
<li class="off"><code>[&#xa0;]</code> QT4CG-080-07: NW to update the build instructions in the README</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-082-02: DN to work with MK to come to agreement on the fn:ranks proposal</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-088-01: NW to consider how best to add a dedication to MSM.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-088-04: [Someone] needs to update the processing model diagram needs vis-a-vis the static typing feature</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-089-01: CG to draft a PR that attempts to resolve the operators described in #755 to a smaller number of orthogonal choices.</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-097-02: MK to make the XSD schema component references into links to XSD</li>
<li class="off"><code>[&#xa0;]</code> QT4CG-097-03: DN to proposal an axis for accessing the siblings of a node.</li>
<li class="on"><code>[X]</code> QT4CG-101-01: MK to add a way to query the sort order of a map</li>
<li class="on"><code>[X]</code> QT4CG-101-02: MK to review the option “random” for a map order option</li>
<li class="on"><code>[X]</code> QT4CG-101-03: MK to provide a bit more of the motivation for map ordering.</li>
<li class="on"><code>[X]</code> QT4CG-101-04: MK to consider how map ordering applies to records.</li>
</ul>
</div>
</div>

<div id="outline-container-open-pull-requests" class="outline-3">
<h3 id="open-pull-requests"><span class="section-number-3">1.6.</span> Review of open pull requests and issues</h3>
<div class="outline-text-3" id="text-open-pull-requests">
</div>

<div id="outline-container-blocked" class="outline-4">
<h4 id="blocked"><span class="section-number-4">1.6.1.</span> Blocked</h4>
<div class="outline-text-4" id="text-blocked">
<p>
The following PRs are open but have merge conflicts or comments which
suggest they aren’t ready for action.
</p>

<ul class="org-ul">
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1296">#1296</a>: 982 Rewrite of scan-left and scan-right</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1283">#1283</a>: 77b Update expressions</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1062">#1062</a>: 150bis revised proposal for fn:ranks</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1227">#1227</a>: 150 PR resubmission for fn ranks</li>
</ul>
</div>
</div>

<div id="outline-container-merge-without-discussion" class="outline-4">
<h4 id="merge-without-discussion"><span class="section-number-4">1.6.2.</span> Merge without discussion</h4>
<div class="outline-text-4" id="text-merge-without-discussion">
<p>
The following PRs are editorial, small, or otherwise appeared to be
uncontroversial when the agenda was prepared. The chairs propose that
these can be merged without discussion. If you think discussion is
necessary, please say so.
</p>

<ul class="org-ul">
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1643">#1643</a>: 1103 Normalize line endings in CSV prior to parsing</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1642">#1642</a>: 1637 Add/Amend notes to fn:function-lookup</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1641">#1641</a>: 1554-change-formal-specification-heading</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1640">#1640</a>: 1639 Add missing rule for elements-to-maps</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1629">#1629</a>: 1628 Clarify rules for XQuery version declaration</li>
</ul>

<p>
Proposal: Merge without discussion.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-close-without-action" class="outline-4">
<h4 id="close-without-action"><span class="section-number-4">1.6.3.</span> Close without action</h4>
<div class="outline-text-4" id="text-close-without-action">
<p>
It has been proposed that the following issues be closed without action.
If you think discussion is necessary, please say so.
</p>

<ul class="org-ul">
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1592">#1592</a>: fn:elements-to-maps: Observations</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1588">#1588</a>: Move the Streamability chapter?</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1457">#1457</a>: Common name for maps &amp; arrays</li>
</ul>

<p>
Proposal: Close without further action.
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-substantive" class="outline-4">
<h4 id="substantive"><span class="section-number-4">1.6.4.</span> Substantive PRs</h4>
<div class="outline-text-4" id="text-substantive">
<p>
The following substantive PRs were open when this agenda was prepared.
</p>

<ul class="org-ul">
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1638">#1638</a>: 1634 Update description of decimal properties in the static context</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1636">#1636</a>: Initial conversion of EXPath Binary/File</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1633">#1633</a>: 1627 Tweaks to schema type functions</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1622">#1622</a>: 1619 Specify XSLT map-for-key function</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1620">#1620</a>: 332 Add options for fn:path</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1617">#1617</a>: 1606 Drop named item types, refine named record types, esp in XSLT</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1616">#1616</a>: A little cleanup; support function/xfunction globally</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1609">#1609</a>: 564 Ordered Maps</li>
<li>PR <a href="https://qt4cg.org/dashboard/#pr-1587">#1587</a>: 557 Add fn:binary-resource</li>
</ul>
</div>
</div>

<div id="outline-container-required-40" class="outline-4">
<h4 id="required-40"><span class="section-number-4">1.6.5.</span> Required for V4.0</h4>
<div class="outline-text-4" id="text-required-40">
<p>
The following issues are labeled “required for V4.0”.
</p>

<ul class="org-ul">
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1252">#1252</a>: Add a new function `fn:html-doc`</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1240">#1240</a>: $sequence-of-maps ? info()</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1238">#1238</a>: XSLT on-no-match="shallow-copy-all" - revised rules</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1127">#1127</a>: Binary resources</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1045">#1045</a>: Functions to manage namespace usage</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1021">#1021</a>: Extend `fn:doc`, `fn:collection` and `fn:uri-collection` with options maps</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/1011">#1011</a>: fn:transform() improvements</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/986">#986</a>: Numeric Comparisons</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/967">#967</a>: XPath Appendix I: Comparisons</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/826">#826</a>: Arrays: Representation of single members of an array</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/748">#748</a>: Parse functions: consistency</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/675">#675</a>: XSLT streaming rules for new constructs</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/501">#501</a>: Error handling: Rethrow errors; finally block</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/490">#490</a>: Control over schema validation in parse-xml(), doc(), etc.</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/407">#407</a>: XSLT-specific context properties used in function items</li>
<li>Issue <a href="https://github.com/qt4cg/qtspecs/issues/272">#272</a>: Setting parameter values in xsl:use-package</li>
</ul>
</div>
</div>
</div>
</div>

<div id="outline-container-technical-agenda" class="outline-2">
<h2 id="technical-agenda"><span class="section-number-2">2.</span> Technical agenda</h2>
<div class="outline-text-2" id="text-technical-agenda">
</div>

<div id="outline-container-pr-1636" class="outline-3">
<h3 id="pr-1636"><span class="section-number-3">2.1.</span> PR #1636: Initial conversion of EXPath Binary/File</h3>
<div class="outline-text-3" id="text-pr-1636">
<p>
See PR <a href="https://qt4cg.org/dashboard/#pr-1636">#1636</a>
</p>

<p>
JWL has done an initial conversion of the EXPath binary and file specifications
to the QT4CG build system. They won’t (usefully) build before they are committed
to the repo, but in the short term, you can see formatted versions here:
</p>

<ul class="org-ul">
<li><a href="https://qt4cgtest.nwalsh.com/branch/johnlumley-expath/expath-binary-40/Overview.html">https://qt4cgtest.nwalsh.com/branch/johnlumley-expath/expath-binary-40/Overview.html</a></li>
<li><a href="https://qt4cgtest.nwalsh.com/branch/johnlumley-expath/expath-file-40/Overview.html">https://qt4cgtest.nwalsh.com/branch/johnlumley-expath/expath-file-40/Overview.html</a></li>

<li>NW: I propose that we merge these.</li>
<li>DN: It seems to me that the names are a bit odd. Binary could be part of file. Maybe
we should give them better names.</li>
<li>MK: Are we going to display them on the homepage.</li>
<li>WP: Does conformance include some optional features? I’m in favor of moving
forward, but escape hatches.</li>
<li>JWL: There are cross links to conformance in both of them; I’ve tried to make
them refer to F&amp;O where F&amp;O tells you how to do things. Those links are in.
<ul class="org-ul">
<li>… The binary module is very simple. It only deals with the handling of
base64/hexBinary types: basically byte sequences.</li>
<li>… Some of that stuff is already implicit in the current specs.</li>
<li>… The file specification is much trickier; I think there will be a lot of
discussion there.</li>
</ul></li>
<li>JLO: Regarding binary, when I was testing and playing around with different
implementations, I found that a lot of the binary module is already present
because there’s a lot of overlap with hexBinary/base64Binary.</li>
<li>JWL: Those types were well established types; it was a question of putting
functions that dealt with that type on top of the bytes held in those types.</li>
<li>DN: Is the question of asynchrony dealt with at all. Or all they all synchronous.</li>
<li>CG: It’s all synchronous.</li>
<li>DN: Maybe we need to think about asynchrony.</li>
<li>CG: All of the functions are synchronous, but they are side-effecting and
labeled as non-deterministic. A clean solution in the main might be hard, but
the file module has worked fine for ten years with implementation defined
behavior.</li>
<li>RD: The main issue is reordering expressions in XPath and XQuery and not
synchronous vs. asynchronous.</li>
<li>MK: Well, both are relevant and they’re not separable.
<ul class="org-ul">
<li>… I reread the paper that Adam Retter and Debbie Lockett wrote a few years
ago about asynchronous and non-deterministic tasks.</li>
<li>… In particular, it tries to tackle both problems with the same solution.</li>
<li>… File is much trickier.</li>
</ul></li>
<li>RD: Is there anything from the AR/DL proposal that would need implementing in
XPath and XQuery?</li>
<li>MK: It provides ideas for a way forward.</li>
</ul>

<p>
Proposal: Merge this PR
</p>

<p>
Accepted.
</p>
</div>
</div>

<div id="outline-container-pr-1587" class="outline-3">
<h3 id="pr-1587"><span class="section-number-3">2.2.</span> PR #1587: 557 Add fn:binary-resource</h3>
<div class="outline-text-3" id="text-pr-1587">
<p>
See PR <a href="https://qt4cg.org/dashboard/#pr-1587">#1587</a>
</p>

<ul class="org-ul">
<li>MK: Let’s defer until we’ve reviewed the file and binary specs and see how the relate.</li>
</ul>
</div>
</div>

<div id="outline-container-pr-1609" class="outline-3">
<h3 id="pr-1609"><span class="section-number-3">2.3.</span> PR #1609: 564 Ordered Maps</h3>
<div class="outline-text-3" id="text-pr-1609">
<p>
See PR <a href="https://qt4cg.org/dashboard/#pr-1609">#1609</a>
</p>

<ul class="org-ul">
<li>MK: I think it’ll be most productive today to talk about the principles
because there’s been pushback on the principles.
<ul class="org-ul">
<li>… How we got here: a long time ago, I raised an issue saying that sorted
maps would be a good idea. That was in response to a use case about
searching maps.</li>
<li>… More recently, looking at XML to JSON conversion has raised issues about
preserving order. The current functions destroy order and that’s problematic
for users.</li>
<li>… The two issues seemed to be related, so I tried to tackle them both. We’d
extend the data model to provide a property for ordering. That would allow
the current “random” order and two new orders, “insertion-last” (primarily
used to retain JSON order when you parse JSON into a map; the serialization
would retain that order and small changes would be small changes in the output),
and “sorted-by-key” (primarily for key or range searches).</li>
<li>… Doing them together seemed to make more sense than separately. CG has
given some pushback, especially on sorted maps. Do we need either or both or
neither?</li>
</ul></li>
<li>CG: I’m torn. On the one hand, I see the general advantage of having different
data structures and collections. I think this would be a pretty big change: it
introduces two data structures at once. In part, because there may be other
implementors to consider. Immutable maps can be quite challenging, adding
order preserving and sorted versions might be that much harder. I think the
two extensions should be discussed separately. For the insertion-last flavor,
I think that lots of other languages (Python, JavaScript, etc.) that preserver
order. We’ve had lots of experience with users who find the unordered behavior
of XPath confusing.
<ul class="org-ul">
<li>… Always doing it that way might be good; it’s a performance issue but the
solutions are well known.</li>
<li>… For sorted maps, I have more reservations. There are other things we could
do, with comparitors for example. It’s mostly about improving performance.
We already provide functions to let folks get at maps. Unlike
insertion-last, they’re not a game changing feature.</li>
</ul></li>
<li>RD: On the insertion order, there are various built-in classes for ordered
maps in different languages. A lot of the implementation languages will
provide insertion-order dictionaries for you. On sorted maps, the main use
cases I see there are in serialization getting the output in sorted order for
formatting, and also in terms of enumerating keys. But if you’re enumerating
keys, you could use an <code>order by</code> constraint to get the sort order. From an
implementor perspective, the only feature I see is getting the keys in sorted
order but that could be done in the serializer.</li>
<li>WP: I’m going to be a little niave, but my first thought is why aren’t you
using XML? I believe MK when he says he has a requirement here, but I wonder
given the depth of the design change if it isn’t worth looking at other
approaches rather than changing the object model to support this.
<ul class="org-ul">
<li>… Today, maps and JSON are very similar and I think that’s a virtue.</li>
</ul></li>
<li>JLO: I think changing the default behavior of maps to insertion order is a
good idea.</li>
<li>DN: We should definitely understand that “ordered” is different from “sorted”.
In C# those are very different types. Sorted variants can be much slower.
It seems to me that we haven’t considered the performance implications.
In C#, an ordered map has the same performance as a regular map.
<ul class="org-ul">
<li>… Order isn’t used for regular map operations; it’s only used for serializing.</li>
</ul></li>
<li>MK: I think there’s always a memory implication; an ordered map uses more
memory than an ordinary map.</li>
<li>DN: True, but that isn’t usually an issue because maps don’t often have
thousands of keys.
<ul class="org-ul">
<li>… I’d prefer to have separate ordered map types. It seems to me that ordered
maps would be used primarily by users who want to serialize to JSON and that
seems like a niche case. So maybe we shouldn’t touch the current maps, just
a separate type.</li>
</ul></li>
<li>CG: The only thing I wanted to add is that there are other cases for
orderedness. For example, creating the manifest for an archive, where the
order of the files is important.</li>
<li>DN: I think that’s a serialization question too.</li>
<li>CG: This isn’t serialization, it’s about creating the archive. But there are
many other cases where users have created maps and expect them to be in the
order they created them.</li>
<li>DN: Sorted maps also have more memory consumption because they require data
structures to keep the order.</li>
</ul>

<p>
NW: I think the consensus is in favor of ordered maps, perhaps by default.
</p>

<ul class="org-ul">
<li>MK: I’m nervous about whether we’d be imposing a performance cost on users who
don’t need the feature.</li>
<li>CG: I have similar concerns. I’d like to find a compromise. One way might be
to enforce order when it’s created, but allow updates to aribtrarily destroy
the order. For many simple cases, where you already have an order, it could be
helpful to retain the order. But then you have to decide <b>which</b> operations
preserve order.</li>
<li>MK: I think an important use case is when you load a JSON data structure and
make a small transformation to it. You want the result to keep the changes minimal.</li>
<li>WP: Could we say something softer about preserving order?
<ul class="org-ul">
<li>… Identify the ones where we know it might be lost.</li>
</ul></li>
<li>MK: Once you’ve lost the order, it’s not recoverable…
<ul class="org-ul">
<li>… DN has talked about doing it with distinct types, that would give you
support for different operations and I think it’s a nice feature that the
operations <b>aren’t</b> different.</li>
<li>… Adding a property to the data model but not changing the type system makes
it simpler.</li>
<li>… The big question is: do we want two or three different kinds of maps or not?</li>
<li>… One option is to leave it as it is, one is to say make everything ordered,
another is to put it under user control.</li>
<li>… I’m inclined to the somewhat conservative view that we leave the behavior
as it has been unless users specificially ask for the new behavior.</li>
</ul></li>
<li>DN: I’m glad that I heard concern about adding order to the regular maps. I
still think the best way to go forward is to have a separate ordered map type.
What MK said about complicating the data model is maybe not the case. We could
say that this new type has all the features of the existing map, but with a
few new properties.
<ul class="org-ul">
<li>… Changing the current map could be very confusing for users. It seems to me
that ordered maps would be used in very few use cases. That’s another reason
to make them a separate type.</li>
</ul></li>
<li>JLO: Would an option that could be declared at the top of an XQuery main
module be a way foward?
<ul class="org-ul">
<li>… Then I’d assume all the operations would preserve order.</li>
</ul></li>
<li>MK: Making it a configuration property that’s scoped to a module means you
have to create maps in different modules to have different scopes.
<ul class="org-ul">
<li>… The implementation still has to support both, but it’s harder for the user
to control. It should be something they do when they construct the map.</li>
<li>… If we didn’t do anything, then one could consider having an implementation
feature to do it, but that’s inflexible for users.</li>
</ul></li>
<li>RD: Implementors already have a large degree of freedom in the data structures
they implement. This is providing a mechanism for users to have guarantees.
From the XQuery/XPath side, it’s more like working with interfaces than the
concrete implementations.</li>
<li>MK: That’s true. It’s not declaring an implementation, but a property that you want on the map.</li>
</ul>

<p>
NW: I think the consensus is in favor of ordered maps, but not by default. But
sorted maps aren’t gaining consensus.
</p>

<ul class="org-ul">
<li>DN: In addition to what I already said about preferring a new type of map, I
want to say that it would be very easy to switch from a map to an ordered map
by having a constructor that takes a comparitor.</li>
</ul>

<p>
Related links from the Zoom chat:
</p>

<ul class="org-ul">
<li>Java &#x2013; <a href="https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html">https://docs.oracle.com/javase/8/docs/api/java/util/LinkedHashMap.html</a></li>
<li>C# &#x2013; <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.specialized.ordereddictionary?view=net-9.0">https://learn.microsoft.com/en-us/dotnet/api/system.collections.specialized.ordereddictionary?view=net-9.0</a></li>
<li>Rust &#x2013; <a href="https://docs.rs/indexmap/latest/indexmap/">https://docs.rs/indexmap/latest/indexmap/</a></li>
<li>For immutable variants (which we will need), the VAVR and PCollections libraries could be used.</li>

<li>CG: If we had ordered maps, then you can imagine an “at position” function for
ordered maps.</li>
</ul>
</div>
</div>

<div id="outline-container-pr-1616" class="outline-3">
<h3 id="pr-1616"><span class="section-number-3">2.4.</span> PR #1616: A little cleanup; support function/xfunction globally</h3>
<div class="outline-text-3" id="text-pr-1616">
<p>
See PR <a href="https://qt4cg.org/dashboard/#pr-1616">#1616</a>
</p>

<ul class="org-ul">
<li>NW: May I merge this?</li>
<li>MK: Yes, please do.</li>
</ul>
</div>
</div>
</div>

<div id="outline-container-any-other-business" class="outline-2">
<h2 id="any-other-business"><span class="section-number-2">3.</span> Any other business</h2>
<div class="outline-text-2" id="text-any-other-business">
<p>
None heard.
</p>
</div>
</div>

<div id="outline-container-adjourned" class="outline-2">
<h2 id="adjourned"><span class="section-number-2">4.</span> Adjourned</h2>
<div class="outline-text-2" id="text-adjourned">
</div>
</div>
</div>
</body>
</html>
