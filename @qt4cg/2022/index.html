<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses in 2022</title></head><body><main><article><h1>@qt4cg statuses in 2022</h1><p>This page displays status
              updates
              about the QT4 CG project from 2022.</p><p>See also <a href="../">recent statuses</a>.</p><div class="toots">
<div class="toot" id="created-297"><h2>Issue #297 created<span class="toot-id"> #created-297</span></h2><div class="pubdate">28 Dec at 23:51:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/297">https://github.com/qt4cg/qtspecs/issues/297</a></div><details><summary>Lookup in deeply nested JSON, an abbreviated syntax for map:find</summary><div class="markup"><p>In XML, you can select all X nodes with an abbreviated syntax //X</p>
<p>There is no abbreviated syntax for JSON</p>
<p>I propose to add a ?? syntax. Like / is doubled for //, it doubles the ? lookup operator.</p>
<p>The syntax is basically the same as for ?:</p>
<p>[200]  UnaryLookupRecursion  ::=  "??"  KeySpecifier
[143]  LookupRecursion ::=  "??"  KeySpecifier
[144]  KeySpecifier |::=  NCName  |  IntegerLiteral  |  StringLiteral  |  VarRef  |  ParenthesizedExpr  |  "*"</p>
<p>For the semantic it can call map:find, except for * and varref:</p>
<p>Unary variant:</p>
<pre><code>??"string"    becomes map:find(. , "string")
??NCName      becomes map:find( ., "NCName")
??123         becomes map:find(., 123)

??*           Recursively every member/value of every array/map underneath .
              E.g. for `[{"a": {"x": 123}}, 456]`: `{"a": {"x": 123}}, {"x": 123}, 123, 456`

??$varref     calls ?$varref on every nested array/map.
              Like (.,??*)?$varref   (except for type errors)
</code></pre>
<p>Postfix variant:</p>
<p><code>E??S</code>   would be <code>E!??S</code> if it is atomic, or <code>let $s := data(S) return E!??$s</code> if S is parenthesized</p>
<p>This probably conflicts with #171</p>
</div></details></div>
<div class="toot" id="created-296"><h2>Issue #296 created<span class="toot-id"> #created-296</span></h2><div class="pubdate">22 Dec at 10:44:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/296">https://github.com/qt4cg/qtspecs/issues/296</a></div><details><summary>Default namespace for elements; especially in the context of HTML</summary><div class="markup"><p>There can be little doubt that the fact that an unprefixed name in XPath fails to select an unprefixed element in the source document is one of the major gotcha's, causing massive bewilderment to all newbie users.</p>
<p>The XPath 2.0 solution of using a default element namespace in the static context is a partial solution; its main drawback is that it doesn't help the newbies who didn't know about the problem or its solution.</p>
<p>The HTML "living standard" introduces a "wilful violation" of the XPath 1.0 spec to address the issue. Given that most elements in an HTML DOM will be in the XHTML namespace, it states:</p>
<blockquote>
<p>If the QName has no prefix and the principal node type of the axis is element, then the default element namespace is used. Otherwise if the QName has no prefix, the namespace URI is null. The default element namespace is a member of the context for the XPath expression. The value of the default element namespace when executing an XPath expression through the DOM3 XPath API is determined in the following way:</p>
</blockquote>
<blockquote>
<p>If the context node is from an HTML DOM, the default element namespace is "http://www.w3.org/1999/xhtml".
Otherwise, the default element namespace URI is null.</p>
</blockquote>
<p>It then adds a note which is blatantly untrue:</p>
<blockquote>
<p>This is equivalent to adding the default element namespace feature of XPath 2.0 to XPath 1.0, and using the HTML namespace as the default element namespace for HTML documents. It is motivated by the desire to have implementations be compatible with legacy HTML content while still supporting the changes that this specification introduces to HTML regarding the namespace used for HTML elements, and by the desire to use XPath 1.0 rather than XPath 2.0.</p>
</blockquote>
<p>Since the XPath 2.0 facility picks up the default namespace from the static context, while the HTML "wilful violation" picks it up dynamically from a property of the context node (namely "being from an HTML DOM") there is no way these can be considered equivalent.</p>
<p>(Note also, there's a significant ambiguity in the "wilful violation" rules: what exactly is the "context node" that determines this behaviour? I think they're suggesting it is the context node at the point of XPath API invocation, not the context node for the specific axis step. This makes it rather unclear how the rule is supposed to apply to XSLT. And: if an XSLT stylesheet creates a temporary tree with nodes in the XHTML namespaces, do we consider those nodes as being "from an HTML DOM"?)</p>
<p>Nevertheless, the intent of the "violation" is worthy, and it would be nice if we can find a solution to this problem that works both for HTML and for other vocabularies.</p>
<p>Our current proposal for fn:parse-html is that HTML elements should go in the XHTML namespace and this means that users familiar with XPath 1.0 implementations in the browser will trip over this problem. A lot.</p>
</div></details></div>
<div class="toot" id="closed-170"><h2>Issue #170 closed<span class="toot-id"> #closed-170</span></h2><div class="pubdate">21 Dec at 00:03:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/170">https://github.com/qt4cg/qtspecs/issues/170</a></div><p>XPath "otherwise" operator</p></div>
<div class="toot" id="closed-191"><h2>Issue #191 closed<span class="toot-id"> #closed-191</span></h2><div class="pubdate">21 Dec at 00:01:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/191">https://github.com/qt4cg/qtspecs/issues/191</a></div><p>Definition of "dynamic type"</p></div>
<div class="toot" id="closed-213"><h2>Issue #213 closed<span class="toot-id"> #closed-213</span></h2><div class="pubdate">20 Dec at 23:57:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/213">https://github.com/qt4cg/qtspecs/issues/213</a></div><p>Lookup/Indexing operator for sequences (supersedes #50)</p></div>
<div class="toot" id="created-295"><h2>Issue #295 created<span class="toot-id"> #created-295</span></h2><div class="pubdate">20 Dec at 23:43:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/295">https://github.com/qt4cg/qtspecs/issues/295</a></div><details><summary>Extend support for self-reference in record types</summary><div class="markup"><p>We currently allow a field in a record to have type "..", that is, the same type as the containing record definition.</p>
<p>This isn't good enough for the fn:random-number-generator, where we need something like:</p>
<pre><code>random-number-generator-record:
record(
   number as&nbsp;xs:double,
   next as&nbsp;function() as #random-number-generator-record,
   permute as&nbsp;function(item()*) as item()*,
   *,
)

</code></pre>
<p>There are two ways we could tackle this. We could extend the syntax to allow ".." here, so it becomes
<code>next as&nbsp;function() as ..</code> Or we could allow named item types to refer to themselves:</p>
<pre><code>&lt;xsl:item-type name="random-number-generator-record"
   as="record(
   number as&nbsp;xs:double,
   next as&nbsp;function() as type(random-number-generator-record),
   permute as&nbsp;function(item()*) as item()*,
   *,
)"&gt;

</code></pre>
<p>We haven't really reviewed the proposal for named item types. It's easy enough to declare them in XQuery and XSLT (and not really very difficult to define the rules under which self-referential definitions are allowed). Free-standing XPath is a bit more of a problem.</p>
</div></details></div>
<div class="toot" id="minutes-12-20"><h2>QT4 CG meeting 016 draft minutes<span class="toot-id"> #minutes-12-20</span></h2><div class="pubdate">20 Dec at 17:26:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/12-20">https://qt4cg.org/meeting/minutes/2022/12-20</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-294"><h2>Issue #294 created<span class="toot-id"> #created-294</span></h2><div class="pubdate">20 Dec at 15:48:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/294">https://github.com/qt4cg/qtspecs/issues/294</a></div><details><summary>fn:remove removing multiple items</summary><div class="markup"><p><code>map:remove</code> and <code>array:remove</code> take a list of keys/positions to be removed; fn:remove only accepts one. I propose changing <code>fn:remove</code> to bring it into line.</p>
<p>Without this, removing multiple items is tricky because removing one item changes the positions of the others.</p>
<p>Example use case:</p>
<pre><code>let $p := index-where($persons -&gt;{@status='retired'))
return $persons =&gt; remove($p)
</code></pre>
<p>(Of course, this could always be done with a filter. But removing a small number of items from a large sequence might be more efficient than a filter)</p>
</div></details></div>
<div class="toot" id="created-293"><h2>Issue #293 created<span class="toot-id"> #created-293</span></h2><div class="pubdate">19 Dec at 20:14:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/293">https://github.com/qt4cg/qtspecs/issues/293</a></div><details><summary>Error in fn:doc-available specification</summary><div class="markup"><p>Observed on the XML.com slack (Oct 6 2022):</p>
<p>A rule in the XQFO 3.1 specification seems to be inconsistent. In the error summary, it’s stated that:</p>
<blockquote>
<p><code>err:FODC0005</code>, Invalid argument to fn:doc or fn:doc-available. Raised (optionally) by <code>fn:doc</code> and <code>fn:doc-available</code> if the argument is not a valid URI reference.</p>
</blockquote>
<p>The rules for <code>fn:doc-available</code> say: “[…] In all other cases this function returns false. This includes the case where an invalid URI is supplied, and also the case where a valid relative URI reference is supplied, and cannot be resolved, for example because the static base URI is absent.”</p>
</div></details></div>
<div class="toot" id="created-292"><h2>Pull request #292 created<span class="toot-id"> #created-292</span></h2><div class="pubdate">19 Dec at 18:43:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/292">https://github.com/qt4cg/qtspecs/pull/292</a></div><details><summary>Merge signatures with optional params</summary><div class="markup"><p>This addresses issue #291, concerned with the validity of function-catalog.xml against its XSD schema, and the validity of the intermediate file xpath-functions-40.xml against the xmlspec DTD (as amended for QT).</p>
<p>It also fixes the trivial error raised in issue #288, and addresses issue #70 by making each function have a single prototype with default values where appropriate. (This is not purely an editorial change, it enables you for example to supply () as the $length argument of fn:substring).</p>
<p>There's more work on issue #257 (editorial improvements to handling of named record types).</p>
<p>This commit is mainly for technical review by NDW. It combines changes to the stylesheets, schema, and content, and may therefore require picking apart before it can be applied.</p>
</div></details></div>
<div class="toot" id="created-291"><h2>Issue #291 created<span class="toot-id"> #created-291</span></h2><div class="pubdate">19 Dec at 11:31:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/291">https://github.com/qt4cg/qtspecs/issues/291</a></div><details><summary>DTD validity of F&amp;O spec</summary><div class="markup"><p>Despite PR #228, I'm still seeing a lot of validation errors when (using Oxygen) I apply DTD validation to build/expanded/xpath-functions-40/xpath-functions-40.xml</p>
<p>Many of these relate to style attributes not being allowed on table, td, and code elements.</p>
<p>The merge-function-specs.xsl explicitly creates elements with these attributes:</p>
<p>See</p>
<ul>
<li><code>&lt;xsl:template match="fos:options"&gt;</code> line 382</li>
<li><code>&lt;xsl:template match="fos:option"&gt;</code> line 408</li>
<li><code>&lt;xsl:template match="processing-instruction('local-function-index')"&gt;</code> line 347</li>
</ul>
<p>It all works because xmlspec-2016.xsl handles these attributes even though the DTD doesn't allow them: see <code>&lt;xsl:template name="style-attributes"&gt;</code> at line 2096.</p>
<p>There seem to be three possible options:</p>
<ul>
<li>Extend the DTD to allow these attributes</li>
<li>Change merge-function-specs.xsl to not generate these attributes, instead perhaps generating a role attribute which gets picked up in the final styling</li>
<li>Sweep the issue under the carpet; avoid validating the intermediate file.</li>
</ul>
<p>The main problem with the third approach is that it allows other errors to go unnoticed, for example putting text directly within an <code>&lt;item&gt;</code> without a containing <code>&lt;p&gt;</code>.</p>
</div></details></div>
<div class="toot" id="created-290"><h2>Pull request #290 created<span class="toot-id"> #created-290</span></h2><div class="pubdate">17 Dec at 19:21:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/290">https://github.com/qt4cg/qtspecs/pull/290</a></div><details><summary>Fix issue #18 (function type hierarchy)</summary><div class="markup"><p>Editorial change to fix a technical error in the data model spec (issue #18). Does not change the specification.</p>
</div></details></div>
<div class="toot" id="created-289"><h2>Pull request #289 created<span class="toot-id"> #created-289</span></h2><div class="pubdate">17 Dec at 18:45:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/289">https://github.com/qt4cg/qtspecs/pull/289</a></div><details><summary>Proposal to add fallback behaviour to map:get and array:get</summary><div class="markup"><p>Note: I got a build failure trying to build this, it's doing DTD validation but there are invalidities, unrelated to the changes I made.</p>
</div></details></div>
<div class="toot" id="closed-100"><h2>Issue #100 closed<span class="toot-id"> #closed-100</span></h2><div class="pubdate">17 Dec at 18:35:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/100">https://github.com/qt4cg/qtspecs/issues/100</a></div><p>[FO] Typo in §17.5.3</p></div>
<div class="toot" id="closed-88"><h2>Issue #88 closed<span class="toot-id"> #closed-88</span></h2><div class="pubdate">17 Dec at 17:53:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/88">https://github.com/qt4cg/qtspecs/issues/88</a></div><p>[XPATH] breaking ancestor or descendant axes</p></div>
<div class="toot" id="closed-124"><h2>Issue #124 closed<span class="toot-id"> #closed-124</span></h2><div class="pubdate">17 Dec at 17:41:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/124">https://github.com/qt4cg/qtspecs/issues/124</a></div><p>[XPath] [XQuery] Incorrect subtype-itemtype rules for pure and local union types</p></div>
<div class="toot" id="closed-242"><h2>Issue #242 closed<span class="toot-id"> #closed-242</span></h2><div class="pubdate">16 Dec at 13:44:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/242">https://github.com/qt4cg/qtspecs/issues/242</a></div><p>Coercion rules used to convert function result to expected type</p></div>
<div class="toot" id="agenda-12-20"><h2>QT4 CG meeting 016 draft agenda<span class="toot-id"> #agenda-12-20</span></h2><div class="pubdate">16 Dec at 09:41:30 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/12-20">https://qt4cg.org/meeting/agenda/2022/12-20</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-288"><h2>Issue #288 created<span class="toot-id"> #created-288</span></h2><div class="pubdate">15 Dec at 14:49:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/288">https://github.com/qt4cg/qtspecs/issues/288</a></div><details><summary>Error in fn:path specification</summary><div class="markup"><p>On the XML.com slack, Phil Fearon observes:</p>
<blockquote>
<p>The XPath 3.1 specification has an error in the <a href="https://www.w3.org/TR/xpath-functions-31/#func-path">definition of fn:path</a></p>
<p>The properties section states:</p>
<p>The one-argument form of this function is <a href="https://www.w3.org/TR/xpath-functions-31/#dt-deterministic">·deterministic·</a>, <a href="https://www.w3.org/TR/xpath-functions-31/#dt-context-dependent">·context-dependent·</a>, and [·focus-dependent·] (https://www.w3.org/TR/xpath-functions-31/#dt-focus-dependent).
The two-argument form of this function is <a href="https://www.w3.org/TR/xpath-functions-31/#dt-deterministic">·deterministic·</a>, <a href="https://www.w3.org/TR/xpath-functions-31/#dt-context-independent">·context-independent·</a>, and <a href="https://www.w3.org/TR/xpath-functions-31/#dt-focus-independent">·focus-independent·</a>.</p>
<p>The term one-argument form should be zero-argument form and consequently, two-argument form should be one-argument form</p>
</blockquote>
</div></details></div>
<div class="toot" id="closed-277"><h2>Issue #277 closed<span class="toot-id"> #closed-277</span></h2><div class="pubdate">14 Dec at 14:13:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/277">https://github.com/qt4cg/qtspecs/issues/277</a></div><p>Overriding functions using xsl:import</p></div>
<div class="toot" id="closed-279"><h2>Issue #279 closed<span class="toot-id"> #closed-279</span></h2><div class="pubdate">14 Dec at 14:13:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/279">https://github.com/qt4cg/qtspecs/pull/279</a></div><p>Rewrite XSLT §10.3.4 (function overriding) for clarity</p></div>
<div class="toot" id="closed-287"><h2>Issue #287 closed<span class="toot-id"> #closed-287</span></h2><div class="pubdate">14 Dec at 14:13:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/287">https://github.com/qt4cg/qtspecs/pull/287</a></div><p>PR #279 with merge conflicts resolved</p></div>
<div class="toot" id="created-287"><h2>Pull request #287 created<span class="toot-id"> #created-287</span></h2><div class="pubdate">14 Dec at 13:57:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/287">https://github.com/qt4cg/qtspecs/pull/287</a></div><details><summary>PR #279 with merge conflicts resolved</summary><div class="markup"><p>Close #279
Close #277</p>
</div></details></div>
<div class="toot" id="closed-225"><h2>Issue #225 closed<span class="toot-id"> #closed-225</span></h2><div class="pubdate">14 Dec at 12:27:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/225">https://github.com/qt4cg/qtspecs/issues/225</a></div><p>[XDM] Terminology around "Atomic value" and "Type Annotation"</p></div>
<div class="toot" id="created-286"><h2>Pull request #286 created<span class="toot-id"> #created-286</span></h2><div class="pubdate">13 Dec at 21:06:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/286">https://github.com/qt4cg/qtspecs/pull/286</a></div><p>Spec changes to allow child::(a|b|c) - Issue 107</p></div>
<div class="toot" id="closed-114"><h2>Issue #114 closed<span class="toot-id"> #closed-114</span></h2><div class="pubdate">13 Dec at 20:09:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/114">https://github.com/qt4cg/qtspecs/issues/114</a></div><p>[fo] array:index-where</p></div>
<div class="toot" id="closed-258"><h2>Issue #258 closed<span class="toot-id"> #closed-258</span></h2><div class="pubdate">13 Dec at 20:08:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/258">https://github.com/qt4cg/qtspecs/pull/258</a></div><p>Issue #114 - add array:index-where() function</p></div>
<div class="toot" id="closed-265"><h2>Issue #265 closed<span class="toot-id"> #closed-265</span></h2><div class="pubdate">13 Dec at 17:58:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/265">https://github.com/qt4cg/qtspecs/issues/265</a></div><p>Type hierarchy tables/diagrams</p></div>
<div class="toot" id="closed-268"><h2>Issue #268 closed<span class="toot-id"> #closed-268</span></h2><div class="pubdate">13 Dec at 17:58:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/268">https://github.com/qt4cg/qtspecs/pull/268</a></div><p>New type-hierarchy images / descriptions</p></div>
<div class="toot" id="minutes-12-13"><h2>QT4 CG meeting 015 draft minutes<span class="toot-id"> #minutes-12-13</span></h2><div class="pubdate">13 Dec at 17:23:01 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/12-13">https://qt4cg.org/meeting/minutes/2022/12-13</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="agenda-12-13"><h2>QT4 CG meeting 015 draft agenda<span class="toot-id"> #agenda-12-13</span></h2><div class="pubdate">09 Dec at 07:44:30 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/12-13">https://qt4cg.org/meeting/agenda/2022/12-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-285"><h2>Issue #285 created<span class="toot-id"> #created-285</span></h2><div class="pubdate">08 Dec at 11:34:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/285">https://github.com/qt4cg/qtspecs/issues/285</a></div><details><summary>Stability of collections</summary><div class="markup"><p>The specification for fn:collection says:</p>
<blockquote>
<p>By default, this function is [·deterministic·]. This means that repeated calls on the function with the same argument will return the same result. However, for performance reasons, implementations may provide a user option to evaluate the function without a guarantee of determinism. The manner in which any such option is provided is [·implementation-defined·]. If the user has not selected such an option, a call to this function must either return a deterministic result or must raise a dynamic error [[err:FODC0003].</p>
</blockquote>
<p>I think this is unrealistic. The cost of making fn:collection deterministic is disproportionate to the benefits. It's very rare in practice for a query or stylesheet to process the same collection more than once, and retaining the information needed to deliver the identical results on these rare occasions is expensive (typically it means holding a long-term lock on the data, or keeping a copy of the entire collection in memory). It also inhibits techniques such as multi-threaded evaluation.</p>
<p>I would like to relax this requirement.</p>
</div></details></div>
<div class="toot" id="closed-1"><h2>Issue #1 closed<span class="toot-id"> #closed-1</span></h2><div class="pubdate">07 Dec at 13:00:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1">https://github.com/qt4cg/qtspecs/issues/1</a></div><p>[FO] Conversion between xs:QName and Q{uri}local format</p></div>
<div class="toot" id="closed-229"><h2>Issue #229 closed<span class="toot-id"> #closed-229</span></h2><div class="pubdate">07 Dec at 12:36:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/229">https://github.com/qt4cg/qtspecs/issues/229</a></div><p>Proposal: Add the missing functions for arrays: array:exists() and array:empty()</p></div>
<div class="toot" id="created-284"><h2>Pull request #284 created<span class="toot-id"> #created-284</span></h2><div class="pubdate">07 Dec at 11:55:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/284">https://github.com/qt4cg/qtspecs/pull/284</a></div><details><summary>Add grammar for "if (test) then {expr}" with no else</summary><div class="markup"><p>As discussed in issue #234. In reviewing this PR, I suggest we consider it together with the existing proposals for ternary conditionals (x ?? y !! z) and the "otherwise" operator.</p>
</div></details></div>
<div class="toot" id="closed-97"><h2>Issue #97 closed<span class="toot-id"> #closed-97</span></h2><div class="pubdate">07 Dec at 10:05:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/97">https://github.com/qt4cg/qtspecs/issues/97</a></div><p>[XPath] Functions symmetric to `head()` and `tail()` for sequences and arrays</p></div>
<div class="toot" id="closed-250"><h2>Issue #250 closed<span class="toot-id"> #closed-250</span></h2><div class="pubdate">07 Dec at 10:04:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/250">https://github.com/qt4cg/qtspecs/pull/250</a></div><p>97 New functions fn:foot, fn:trunk, array:foot, array:trunk</p></div>
<div class="toot" id="minutes-12-06"><h2>QT4 CG meeting 014 draft minutes<span class="toot-id"> #minutes-12-06</span></h2><div class="pubdate">06 Dec at 17:21:01 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/12-06">https://qt4cg.org/meeting/minutes/2022/12-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-283"><h2>Issue #283 created<span class="toot-id"> #created-283</span></h2><div class="pubdate">05 Dec at 11:23:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/283">https://github.com/qt4cg/qtspecs/issues/283</a></div><details><summary>Enumeration types</summary><div class="markup"><p>The draft specification includes a proposal to provide enumeration types. The proposal is incomplete, for example it does not include all the rules for conversions and casting. This issue is raised in order to outline where we are, what needs to be done, and to elicit consensus on whether we want to proceed with this.</p>
<p>What's the motivation? Primarily, making function signatures more expressive.</p>
<p><em>Q0: do we really need this?</em></p>
<p>The essence of the proposal is an ItemType that matches an enumerated set of xs:string values:</p>
<p><code>[131] | EnumerationType | ::= | "enum" "("&nbsp;&nbsp;StringLiteral&nbsp;(","&nbsp;&nbsp;StringLiteral)* ")"  </code>
For example, the type enum("red", "green", "blue") matches the string "green".</p>
<p><em>Q1: why restrict it to strings? I think my main reason was that the syntax gets complicated if we try to do it for data types that have no literal representation.</em></p>
<p>Subtyping is based on the value space. An enumeration type E is a subtype of another enumeration type F if the set of strings in E is a subset of those in F. All enumeration types are subtypes of xs:string.</p>
<p>Strings are not "labelled" as belonging to an enumeration type, matching is purely based on the value ("datum"). This doesn't provide very strong typing. If "violet" and "pink" are allowed by both the enumeration types <code>colour</code> and <code>flower</code>, then it's not intrinsically an error to use a variable of type <code>flower</code> where a <code>colour</code> is expected. Equally, a variable of type <code>xs:string</code> can be used where a <code>colour</code> is expected.</p>
<p><em>Q2: should enumerations be more strongly typed?</em></p>
<p>I would expect that an enumeration type can be used as the target of "cast" or "castable", but this is not currently in the spec.</p>
<p>The coercion rules as currently written say that if the expected type is an enumeration type, then the rules are largely the same as for any other subtype of <code>xs:string</code>:  casting from <code>xs:untypedAtomic</code> applies, promotion from <code>xs:anyURI</code> does not apply, 1.0 compatibility mode rules do not apply.</p>
<p>Operators and functions on enumeration types are the same as for <code>xs:string</code>. This means, for example, that there are no special rules for comparison: values are ordered as strings and are compared using the default collation.</p>
</div></details></div>
<div class="toot" id="closed-271"><h2>Issue #271 closed<span class="toot-id"> #closed-271</span></h2><div class="pubdate">05 Dec at 10:26:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/271">https://github.com/qt4cg/qtspecs/pull/271</a></div><p>Amendments to data model spec as per minutes of 2022-11-22</p></div>
<div class="toot" id="agenda-12-06"><h2>QT4 CG meeting 014 draft agenda<span class="toot-id"> #agenda-12-06</span></h2><div class="pubdate">05 Dec at 10:20:13 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/12-06">https://qt4cg.org/meeting/agenda/2022/12-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-40"><h2>Issue #40 closed<span class="toot-id"> #closed-40</span></h2><div class="pubdate">05 Dec at 10:16:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/40">https://github.com/qt4cg/qtspecs/issues/40</a></div><p>[XPath] [XQuery] The modified SingleType EBNF symbol is redundant.</p></div>
<div class="toot" id="closed-167"><h2>Issue #167 closed<span class="toot-id"> #closed-167</span></h2><div class="pubdate">05 Dec at 10:08:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/167">https://github.com/qt4cg/qtspecs/issues/167</a></div><p>XSLT Conditional Instructions</p></div>
<div class="toot" id="closed-247"><h2>Issue #247 closed<span class="toot-id"> #closed-247</span></h2><div class="pubdate">05 Dec at 09:51:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/247">https://github.com/qt4cg/qtspecs/pull/247</a></div><p>Actions QT4CG-011-01 and QT4CG-011-03. </p></div>
<div class="toot" id="closed-282"><h2>Issue #282 closed<span class="toot-id"> #closed-282</span></h2><div class="pubdate">05 Dec at 09:51:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/282">https://github.com/qt4cg/qtspecs/pull/282</a></div><p>Copy of MK actions-2022-11-15 branch by NW</p></div>
<div class="toot" id="closed-249"><h2>Issue #249 closed<span class="toot-id"> #closed-249</span></h2><div class="pubdate">05 Dec at 09:49:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/249">https://github.com/qt4cg/qtspecs/pull/249</a></div><p>Issue 213: new function fn:items-at</p></div>
<div class="toot" id="created-282"><h2>Pull request #282 created<span class="toot-id"> #created-282</span></h2><div class="pubdate">05 Dec at 09:46:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/282">https://github.com/qt4cg/qtspecs/pull/282</a></div><details><summary>Copy of MK actions-2022-11-15 branch by NW</summary><div class="markup"><p>Resolves merge conflicts in #247</p>
</div></details></div>
<div class="toot" id="closed-155"><h2>Issue #155 closed<span class="toot-id"> #closed-155</span></h2><div class="pubdate">04 Dec at 00:17:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/155">https://github.com/qt4cg/qtspecs/issues/155</a></div><p>Proposal to support optional parameter values on static functions.</p></div>
<div class="toot" id="closed-157"><h2>Issue #157 closed<span class="toot-id"> #closed-157</span></h2><div class="pubdate">04 Dec at 00:16:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/157">https://github.com/qt4cg/qtspecs/issues/157</a></div><p>Proposal to support optional parameters that bind to the context item.</p></div>
<div class="toot" id="created-281"><h2>Issue #281 created<span class="toot-id"> #created-281</span></h2><div class="pubdate">03 Dec at 22:12:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/281">https://github.com/qt4cg/qtspecs/issues/281</a></div><details><summary>XPath: Short-circuiting Functions and Lazy Evaluation Hints</summary><div class="markup"><h1>Short-circuiting Functions and Lazy Evaluation Hints</h1>
<h1><br>1. Introduction</h1>
<p>As shown in <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation#Support_in_common_programming_and_scripting_languages">Wikipedia</a>, most contemporary programming languages offer reasonable support for <a href="https://en.wikipedia.org/wiki/Short-circuit_evaluation#Definition">short-circuit evaluation</a>
(also known as <em>minimal</em> or <em>McCarthy evaluation</em>), including several standard language short-circuit operators.</p>
<p>Short-circuiting, as we will call the above in this document, is commonly used to achieve:</p>
<ol>
<li><em>Avoiding undesired side effects of evaluating the second argument</em>, such as
excessive evaluation time or throwing an error</li>
</ol>
<p>Usual example, using a&nbsp;<a href="https://en.wikipedia.org/wiki/C_(programming_language)">C-based</a>&nbsp;language:</p>
<pre><code class="language-c">   int denom = 0;
   if (denom != 0 &amp;&amp; num / denom)
   {
   ...//ensures that calculating num/denom never results in divide-by-zero error
   }
</code></pre>
<p>Consider the following example:</p>
<pre><code class="language-c">   int a = 0;
   if (a != 0 &amp;&amp; myfunc(b))
   {
     do_something();
   }
</code></pre>
<p>In this example, short-circuit evaluation guarantees that&nbsp;<code>myfunc(b)</code>&nbsp;is never called. This is because&nbsp;<code>a&nbsp;!= 0</code>&nbsp;evaluates to&nbsp;<em><code>false</code></em>. This feature permits two useful programming constructs.</p>
<ol>
<li>
<p>If the first sub-expression checks whether an expensive computation is needed and the check evaluates to&nbsp;<em>false</em>, one can eliminate expensive computation in the second argument.</p>
</li>
<li>
<p>It permits a construct where the first expression guarantees a condition without which the second expression may cause a&nbsp;<a href="https://en.wikipedia.org/wiki/Run-time_error">run-time error</a>.</p>
</li>
<li>
<p><em>Idiomatic conditional construct</em></p>
</li>
</ol>
<p><a href="https://en.wikipedia.org/wiki/Perl">Perl</a>&nbsp;idioms:</p>
<pre><code>   some_condition or die; # Abort execution if some_condition is false

   some_condition and die; # Abort execution if some_condition is true
</code></pre>
<h1><br>2. Short-circuiting in XPath</h1>
<p>In short (pun intended) there is no such thing mentioned in any officially-published W3C version (&lt;= 3.1) of XPath.</p>
<p>This topic was briefly mentioned in the discussion of <a href="https://github.com/qt4cg/qtspecs/issues/78">another proposal</a>: that of providing the capability to specify strictly the order of evaluation.</p>
<p>Aspects of incorporating hints for <a href="https://en.wikipedia.org/wiki/Lazy_evaluation">lazy evaluation</a> (a topic related to short-cutting) were discussed also in the thread to <a href="https://app.slack.com/client/T011VK9115Z/C01GVC3JLHE/thread/C01GVC3JLHE-1665542903.180989">this question</a> on the Xml.com Slack.</p>
<p>The situation at present is that the XPath processor that is being used decides whether or not to perform shortcutting, even in obvious cases. Thus, varying from one XPath processor to another, the differences in performance evaluation could be dramatic. For example, the following XPath expression is evaluated on BaseX (ver. &gt;= 10.3) for 0 seconds, and the same expression is evaluated by Saxon ver. 11 for about 100 seconds.</p>
<pre><code class="language-xq">
let $fnAnd := function($x)
   {
     function($y)
     {
      if(not($x)) then false()
                  else $y
     }
   }
   return
      $fnAnd(false())(some $b in ( ((1 to 1000000000000000000) !true()) )  satisfies not($b)   )
</code></pre>
<h2><br>3. Analysis</h2>
<p>We can define the term “<em>function with shortcutting</em>” (just for a 2-argument function, but this can be extended for <code>N</code>-argument function where <code>N &gt;= 2</code>) in the  following way:</p>
<p>Given a function <code>$f($x, $y)</code>, we denote in XPath its partial application for a given value of $x (say <code>let $x := $t</code>) as:</p>
<p><code>$f($t, ?)</code></p>
<p>The above is a function of one argument. By definition:</p>
<p><code>$f($x, $y)</code> is equivalent to <code>$f($x, ?) ($y)</code>, for every pair <code>$x</code> and <code>$y</code>.</p>
<p>That is, the partial application of the 2-argument function <code>$f</code> with fixed 1st argument is another function <code>$g</code> which when applied on the 2nd argument (<code>$y</code>) of <code>$f($x, $y)</code> produces the same value as <code>$f($x, $y)</code>:</p>
<p>If <code>$g</code> is defined as <code>$f($x, ?)</code>, then <code>$g($y)</code> produces the same value as <code>$f($x, $y)</code> for every pair <code>$x</code> and <code>$y</code>.</p>
<p>Let us take a specific function:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
                     { $x and $y}
</code></pre>
<p>Then one equivalent way of defining <code>$fAnd</code> is:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
                     {
                       let $partial := function($x as xs:boolean) as function(xs:boolean) as xs:boolean
                                               {
                                                  if(not($x)) then -&gt;(){false()}
                                                              else -&gt;($t) {$t}
                                               }
                         return $partial($x)($y)
                    }
   return
       $fAnd(false(), true())
</code></pre>
<p>The <strong><em><code>$partial</code></em></strong> function is the result of the partial application <code>$fAnd($x, ?)</code> and by definition this is a function of arity 1, which when applied on the 2nd argument of <code>$fAnd</code>, produces the same result as <code>$fAnd($x, $y)</code></p>
<p>From the code above we see that actually there exists a value of <code>$x</code> (the value <code>false()</code> ) for which <code>$fAnd($x, ?)</code> is not a function of one argument, but a constant function (of <strong>0</strong> arguments) – that produces the value <code>false()</code>.</p>
<p><strong>Definition</strong>:</p>
<p>We say that a function <code>f(x, y)</code> <em><strong>allows shortcutting</strong></em> if there exists at least one value <code>t</code> such that</p>
<p><code>f(t, ?)</code> is a constant.</p>
<h1><br>4. Solution</h1>
<p><strong>How can an XPath processor treat a function with shortcutting?</strong></p>
<p>Obviously, if the XPath processor knows that <code>f(x, y)</code> allows shortcutting, then it becomes possible to delay the evaluation of the 2nd argument <code>y</code> and only perform this evaluation if the arity of the function returned by <code>f(t, ?)</code> is <code>1</code>, and not <code>0</code>.</p>
<p><strong>How can an XPath processor know that a given function allows shortcutting?</strong></p>
<ul>
<li>
<p>One way to obtain this knowledge is to evaluate <code>f(t, ?)</code> and get the arity of the resulting function. XPath 3.1 allows getting the arity of any function item with the function <a href="https://www.w3.org/TR/xpath-functions-31/#func-function-arity">fn:function-arity()</a>.      However, doing this on every function call could be expensive and deteriorate performance.</p>
</li>
<li>
<p>Another way of informing the XPath processor that a given function <code>f(x, y)</code> allows shortcutting is if the language provides <em><strong>hints for lazy evaluation</strong></em>:
<br>let $fAnd := function($x as xs:boolean, <em><strong>lazy</strong></em> $y as xs:boolean) as xs:boolean<br>
<br>Only in the case when there is a <em><strong>lazy</strong></em> hint specified the XPath processor will check the arity of <code>f(x, ?)</code> and will not need to evaluate the <code>y</code> argument if this arity is <code>0</code>.</p>
</li>
</ul>
<p>Let us return to the original example:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, $y as xs:boolean) as xs:boolean
                     {
                       let $partial := function($x as xs:boolean) as function(xs:boolean) as xs:boolean
                                               {
                                                  if(not($x)) then -&gt;(){false()}
                                                              else -&gt;($t) {$t}
                                               }
                         return $partial($x)($y)
                    }
   return
       $fAnd(false(), true())
</code></pre>
<p>Executing this with an Xpath 3.1 processor, an error is raised: “<em>1 argument supplied, 0 expected: function() as xs:boolean { false() }.</em>”</p>
<p><img src="https://user-images.githubusercontent.com/10605892/205463393-3b4558ac-66d9-453f-81fc-f83ec0499425.png" alt="image"></p>
<p>But according to the updated “<a href="https://qt4cg.org/pr/279/xquery-40/xpath-40.html#id-coercion-rules">Coercion Rules / Function Coercion</a>” in Xpath 4.0, no error will occur:</p>
<blockquote>
<p>“<em>If&nbsp;<em>F</em>&nbsp;has lower arity than the expected type, then&nbsp;<em>F</em>&nbsp;is wrapped in a new function that declares and ignores the additional argument; the following steps are then applied to this new function.</em></p>
</blockquote>
<blockquote>
<p><em>For example, if the expected type is&nbsp;<code>function(node(), xs:boolean) as  xs:string</code>, and the supplied function is&nbsp;<code>fn:name#1</code>, then the supplied function is effectively replaced by&nbsp;<code>function($n as node(), $b as xs:boolean) as xs:string {fn:name($n)}</code></em>”</p>
</blockquote>
<p>This is exactly the place where the XPath processor will call the lower-arity function without providing to it the ignored, and not needed to be evaluated, additional argument.</p>
<p>Thus, according to this rule, an XPath 4.0 processor will successfully evaluate the above expression and will not issue the error shown above.</p>
<p>Finally, we can put the <em>lazy</em> hint on a function declaration or on a function call, or on both places:</p>
<pre><code class="language-xq">let $fAnd := function($x as xs:boolean, lazy $y as xs:boolean) as  xs:boolean
   {
     let $partial := function($x as xs:boolean) as function(lazy xs:boolean) as xs:boolean
                           {
                              if(not($x)) then -&gt;(){false()}
                                          else -&gt;($t) {$t}
                           }
      return $partial($x)( lazy $y)
   }
   return
       $fAnd(false(), lazy true())
</code></pre>
<p><strong><em>How to write short-circuiting functions?</em></strong></p>
<p>The code above is a good example how one can write a short-circuiting function evaluating which the XPath processor would be aware that a short-circuit is happening but instead of signaling arity error as an XPath 3.1 processor does, will logically ignore the unneeded 2nd argument.</p>
</div></details></div>
<div class="toot" id="created-280"><h2>Issue #280 created<span class="toot-id"> #created-280</span></h2><div class="pubdate">01 Dec at 15:14:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/280">https://github.com/qt4cg/qtspecs/issues/280</a></div><details><summary>Why is resolve-uri forbidden from resolving against a URI that contains a fragment identifier?</summary><div class="markup"><p>The 3.1 F&amp;O spec says, of <code>fn:resolve-uri()</code>:</p>
<blockquote>
<p>A dynamic error is raised [<a href="https://www.w3.org/XML/Group/qtspecs/specifications/xpath-functions-31/html/Overview.html#ERRFORG0002">err:FORG0002</a>] if $base is not a valid IRI according to the rules of RFC3987, extended with an implementation-defined subset of the extensions permitted in LEIRI, or if it is not a suitable IRI to use as input to the chosen resolution algorithm (for example, if it is a relative IRI reference, if it is a non-hierarchic URI, or <strong>if it contains a fragment identifier</strong>).</p>
</blockquote>
<p>(emphasis added by me)</p>
<p>What in the name of all things is that about? I've never noticed that before, and I haven't seen any other API (the URL API in Node and the browser for example) that cares.</p>
<p><code>resolve-uri('test.xml', 'http://example.com/path/file.xml#foo')</code> === <code>http://example.com/path/test.xml</code></p>
<p>I don't see why the presence of a fragment identifier should matter in the least.</p>
<p>e.g.</p>
<pre><code>&gt;&gt; let url = new URL("http://example.com/path/file.xml#foo")
&gt;&gt; console.log(url.href)
http://example.com/path/file.xml#foo
&gt;&gt; let resolved = new URL("test.xml", url);
&gt;&gt; console.log(resolved.href)
http://example.com/path/test.xml
</code></pre>
</div></details></div>
<div class="toot" id="closed-270"><h2>Issue #270 closed<span class="toot-id"> #closed-270</span></h2><div class="pubdate">30 Nov at 10:57:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/270">https://github.com/qt4cg/qtspecs/issues/270</a></div><p>Incorrect statement about named modes</p></div>
<div class="toot" id="closed-273"><h2>Issue #273 closed<span class="toot-id"> #closed-273</span></h2><div class="pubdate">30 Nov at 10:56:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/273">https://github.com/qt4cg/qtspecs/pull/273</a></div><p>Issue270 xslt mode visibility</p></div>
<div class="toot" id="created-279"><h2>Pull request #279 created<span class="toot-id"> #created-279</span></h2><div class="pubdate">29 Nov at 21:59:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/279">https://github.com/qt4cg/qtspecs/pull/279</a></div><details><summary>Rewrite XSLT §10.3.4 (function overriding) for clarity</summary><div class="markup"><p>Essentially editorial - clarifies the existing rules, as described in issue #277</p>
</div></details></div>
<div class="toot" id="closed-254"><h2>Issue #254 closed<span class="toot-id"> #closed-254</span></h2><div class="pubdate">29 Nov at 17:29:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/254">https://github.com/qt4cg/qtspecs/pull/254</a></div><p>Improvements/fixes for the coercion rules</p></div>
<div class="toot" id="created-278"><h2>Issue #278 created<span class="toot-id"> #created-278</span></h2><div class="pubdate">29 Nov at 17:16:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/278">https://github.com/qt4cg/qtspecs/issues/278</a></div><details><summary>array bound checking</summary><div class="markup"><p>Similar functions on arrays and sequences have different behaviour as regards bound checking. For example, fn:head() returns an empty sequence if the input is empty, while array:head() throws an error.</p>
<p>Sometimes we want the error, sometimes we don't, but this should be orthogonal to whether we are using sequences or arrays.</p>
<p>Is there a way we can adapt the sequence functions to throw an error, or adapt the array functions so they don't?</p>
<p>Various ideas have been put forward, including:</p>
<ul>
<li>add extra optional parameters to functions to select the behaviour</li>
<li>mirror the relevant functions (e.g. into a different namespace) to create an alternative version with different behaviour</li>
<li>add options to the static context (array-bound-checking=yes|no, sequence-bound-checking=yes|no) to switch the behaviour (with appropriate mechanisms in XQuery and XSLT -- and perhaps XPath -- to set these options)</li>
<li>do nothing, let users solve the problem for themselves by writing user-defined functions.</li>
</ul>
<p>Note 1: the difference in behaviour affects operators as well as functions: contrast <code>$seq[0]</code> (which returns ()) with <code>$array(0)</code> (throws error). Making <code>$seq[0]</code> throw an error would mean we have to define it in a different way, since the formulation <code>$seq[position()=$N]</code> is intrinsically error-free.</p>
<p>Note 2: if <code>$array(0)</code> doesn't throw an error, it's not immediately obvious what it should do. Returning an empty sequence isn't ideal because the empty sequence is a valid entry in an array. For maps we have the same problem, which is why we have two functions <code>map:get()</code> and <code>map:contains()</code>.</p>
</div></details></div>
<div class="toot" id="created-277"><h2>Issue #277 created<span class="toot-id"> #created-277</span></h2><div class="pubdate">29 Nov at 12:50:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/277">https://github.com/qt4cg/qtspecs/issues/277</a></div><details><summary>Overriding functions using xsl:import</summary><div class="markup"><p>In XSLT 3.0, you can have a module M that contains an xsl:function F#2, and in another module you can import M, and declare another xsl:function F#3.</p>
<p>In the 4.0 spec we appear to disallow this with the paragraph (in §10.3.4):</p>
<blockquote>
<p>A stylesheet function may be overridden by another stylesheet function with the same name that has higher [import precedence]. This is only allowed, however, if the [arity range] of the overriding function includes the totality of the arity range of the overridden function.</p>
</blockquote>
<p>In fact, the error conditions we go on to define (XTSE0769 and XTSE0770) are more carefully worded and do not make the above situation an error. XTSE0769 says that if F has higher import precedence than G, then either the arity ranges of F and G must be disjoint, or the arity range of F must include the totality of G. XTSE0770 says that if F and G have the same import precedence, then their arity ranges must be disjoint.</p>
<p>The paragraph cited should be replaced with:</p>
<blockquote>
<p>A stylesheet function may be overridden by another stylesheet function with the same name that has higher [import precedence]. This is only allowed, however, if either (a) the [arity range] of the overriding function includes the totality of the arity range of the overridden function, or (b) the two arity ranges are non-overlapping.</p>
</blockquote>
<p>There is also scope for editorial improvement to §10.3.4. It describes three separate scenarios:</p>
<p>(a) overriding functions using xsl:import and import precedence</p>
<p>(b) overriding functions using xsl:use-package and xsl:override</p>
<p>(c) overriding extension/external functions using xsl:function (or vice versa)</p>
<p>and it would be much easier to read the section if these were clearly distinguished.</p>
</div></details></div>
<div class="toot" id="closed-276"><h2>Issue #276 closed<span class="toot-id"> #closed-276</span></h2><div class="pubdate">27 Nov at 17:42:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/276">https://github.com/qt4cg/qtspecs/pull/276</a></div><p>Make './gradlew publish' work on Windows #255</p></div>
<div class="toot" id="closed-255"><h2>Issue #255 closed<span class="toot-id"> #closed-255</span></h2><div class="pubdate">27 Nov at 17:42:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/255">https://github.com/qt4cg/qtspecs/issues/255</a></div><p>Build error running gradlew publish on Windows</p></div>
<div class="toot" id="created-276"><h2>Pull request #276 created<span class="toot-id"> #created-276</span></h2><div class="pubdate">27 Nov at 17:37:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/276">https://github.com/qt4cg/qtspecs/pull/276</a></div><details><summary>Make './gradlew publish' work on Windows #255</summary><div class="markup"><p>Fix #255</p>
<p>Repeat after me, "filenames are not URIs." Not on some platforms, anyway.</p>
<p>I still get a warning about "correctness" because of the interaction between a couple of tasks. That doesn't happen on a *nix platform so I don't know if it's related to the difference between forward and backward slashes or if it's a consequence of the build changes I made to support the new SVG (that might be) in data model. They seem harmless for the moment.</p>
</div></details></div>
<div class="toot" id="created-275"><h2>Issue #275 created<span class="toot-id"> #created-275</span></h2><div class="pubdate">26 Nov at 22:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/275">https://github.com/qt4cg/qtspecs/issues/275</a></div><details><summary>Problems with nt/xnt links to grammar terms</summary><div class="markup"><p>I'm trying to work out why we're getting linking errors during the build when linking to grammatical terms.</p>
<p>In etc/XT40.xml (after changing extract.xsl to produce tidier namespace declarations, I'm seeing entries like:</p>
<pre><code>   &lt;nt def="doc-xpath40-SequenceType" xlink:type="simple"&gt;SequenceType&lt;/nt&gt;
   &lt;nt def="doc-xpath40-ItemType" xlink:type="simple"&gt;ItemType&lt;/nt&gt;
   &lt;nt def="doc-xpath40-OccurrenceIndicator" xlink:type="simple"&gt;OccurrenceIndicator&lt;/nt&gt;
   &lt;nt def="prod-xpath40-AnyItemTest" xlink:type="simple"&gt;AnyItemTest&lt;/nt&gt;
   &lt;nt def="doc-xpath40-TypeName" xlink:type="simple"&gt;TypeName&lt;/nt&gt;
   &lt;nt def="doc-xpath40-KindTest" xlink:type="simple"&gt;KindTest&lt;/nt&gt;
</code></pre>
<p>and the problem entries seem to be the ones prefixed "prod-" rather than "doc-".</p>
<p>The <code>extract.xsl</code> stylesheet simply copies what it finds in <code>xpath-assembled.xml</code>.</p>
<p>The decision seems to be made in <code>grammar2spec.xsl</code>, for example line 523 reads</p>
<p><code>&lt;xsl:param name="result_id_docprod_part"/&gt; &lt;!-- 'doc-' or 'prod-' --&gt;</code></p>
<p>The parameter is set to "prod-" in <code>add-non-terminals</code> (line 473) and in <code>add-terminals</code> (line 488), and is set to "doc-" in <code>show-prod</code> (line 513).</p>
<p>Looking more carefully, all productions listed in XT40.xml have a "prod-" entry (at least one...) and most of them also have a "doc-" entry. The problem cases are those that do not have a "doc-" entry. Which suggests that <code>show-prod</code> is not selecting them.</p>
<p>In a small number of cases, when processing the XSLT specification, the show-prod template is outputting the message</p>
<p><code>WARNING!! production with name="MapTest" not found</code></p>
<p>This is produced for MapTest, ArrayTest, EnumerationType, and NamedItemType. The problem here appears to be that the production is referenced in the XSLT spec but in the grammar file it is not shown with <code>if="xslt40-patterns"</code>, so it is not present in the pattern grammar.</p>
<p>For productions like AnyItemTest, the problem is different. It looks to me as if <code>show-prod</code> is not being called for these terms.</p>
<p><code>show-prod</code> is called from one place only: <code>assemble-spec.xsl</code> line 208. This is in a template rule with <code>match="prodrecap"</code></p>
<p>Sure enough, <code>AnyItemTest</code> does not appear to have a <code>prodrecap</code> in the XPath spec.</p>
</div></details></div>
<div class="toot" id="created-274"><h2>Issue #274 created<span class="toot-id"> #created-274</span></h2><div class="pubdate">26 Nov at 10:47:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/274">https://github.com/qt4cg/qtspecs/issues/274</a></div><details><summary>What would it take/would it be possible to build a module repository for QT?</summary><div class="markup"><p>We have an ever growing list of proposed convienence functions. I am not opposed, in principle, to adding convenience functions, but we don’t have any principled criteria (AFAICT) for which ones to add and which ones to reject. That’s not surprising, and I’m also not opposed to that. But I’m sure there are hundreds, perhaps thousands, of such functions. At some point, we’re going to start to resist adding more simply because we’ve added so many. Some of us may already be nearing that point.</p>
<p>It seems to me that the alternative is to do what TeX, Perl, Python, Node, etc. do: make it easy for users to download, install, and use libraries. (I’m carefully using the term “library” here where I might prefer to use “package” or “module” because we already have “package” and “module” which mean other things.)</p>
<p>What would it take to make that possible?</p>
<p>One problem we have is that there are two (perhaps three, or more, depending on how you count) different QT languages and they aren’t all mutually interoperable. My XSLT implementation of <code>fn:parse-uri</code> for example, isn’t directly usable by an XQuery product that doesn’t implement XSLT or some other product that only uses XPath.</p>
<p>Suppose we added an <code>import library</code> declaration to XPath, similar to the <code>import module</code> declaration in XQuery</p>
<pre><code>LibraryImport := "import" "library"
                   ("namespace" NCName "=")?
                   "at" URILiteral
</code></pre>
<p>and a corresponding <code>&lt;xsl:library&gt;</code> instruction to XSLT.</p>
<pre><code>&lt;xsl:library
  namespace = uri
  href = uri /&gt;
</code></pre>
<p>The semantics of each is that it searches an implementation-defined set of locations for a module that matches the URI. If it finds one, it loads the functions declared in that library. If a namespace is given, it loads only the functions in the namespace provided.</p>
<p>We’d expect all implementations to be able to load libraries that only used XPath constructions. An XSLT processor might also be able to load XSLT constructions. An XQuery processor might also be able to load XQuery constructions.</p>
<p>We could define a library file format that allowed an implementor to provide several different implementations of a function, where the processor could choose the best one (in some implementation-dependent way). This would also give us a place to hang version numbers and other relevant metadata.</p>
<p>With that much in place, would it be more practical to use XPath extension modules?</p>
<p>Consider the following scenario. I want to use a URI relativization function (as requested in #269). Dimitre provided a pure XPath implementation, so we don’t actually <em>have</em> to implement it as a native function, we just have to make it easy to use. Imagine that EXPath.org (for example) provided a machine readable list of of libraries.</p>
<p>I run a hypothetical “expath” command to search the machine readlabe directory.</p>
<pre><code>$ expath search relative
xpath uri-relativize -- returns the relative location between two URIs
xslt  doc-relative -- convenience functions for accessing “uncles”, “aunts”, etc.
xpath relative-rank -- funtions to score XML documents
</code></pre>
<p>It found three libraries that matched “relative”. That first one sounds promising.</p>
<pre><code>$ expath show uri-relativize
The uri-relativize library provides uri-relativize(), an XPath
function that resolves one absolute URI relative to another.
</code></pre>
<p>That sounds like what I want, so I install it.</p>
<pre><code>$ expath install uri-relativize
Downloading uri-relativize … installing … done.
</code></pre>
<p>Then in my stylesheet I simply add</p>
<pre><code>&lt;xsl:library href="uri-relativize"/&gt;
</code></pre>
<p>Or in a language that only uses XPath, I add</p>
<pre><code>import library at "uri-relativize"
</code></pre>
<p>and I can use the <code>uri-relativize()</code> function.</p>
<p>I think the important parts are that the implementation searches for libraries so that I don’t have to identify precisly where they were installed and that we somehow make it practical to use them without, though it pains me to say this, explicit namespace bindings.</p>
<p>Perhaps we could allow libraries to “inject” functions into the default function namespace, or we could have a function namespace search list and maybe libraries could extend that.</p>
<p>The format of the library might be something like this:</p>
<pre><code>&lt;library xmlns="xpath-library" name="uri-relativize" version="1.0.3"
         namespace="http://example.com/my/namespace"&gt;
&lt;provides&gt;
function uri-relativize($path1 as xs:anyURI, $path2 as xs:anyURI) as xs:anyURI
&lt;/provides&gt;
&lt;xpath version="3.0"&gt;
…xpath implementation…
&lt;/xpath&gt;
&lt;xslt version="4.0"&gt;
…xslt 4.0 implementation…
&lt;/xslt&gt;
&lt;xslt version="3.0"&gt;
…xslt 3.0 implementation…
&lt;/xslt&gt;
&lt;library&gt;
</code></pre>
<p>But I’m sure if we looked closely at the metadata provided in other system’s packages, we’d see I’ve left a bunch of stuff out. You’d probably, for example, want some way of saying one package depends on another and having the processor load those automatically.</p>
</div></details></div>
<div class="toot" id="created-273"><h2>Pull request #273 created<span class="toot-id"> #created-273</span></h2><div class="pubdate">25 Nov at 18:09:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/273">https://github.com/qt4cg/qtspecs/pull/273</a></div><details><summary>Issue270 xslt mode visibility</summary><div class="markup"><p>This PR fixes issue #270 concerning the visibility of XSLT modes.</p>
<p>It also deals with a lot of editorial issues, some highlighted in issue #275.</p>
<p>It changes the manual change markup in the XSLT spec to use <code>at-"date"</code> format rather than <code>at="draft-number"</code> (dates are more useful for the incremental development process we are following). And it fixes some cross-spec-reference issues, and some violations of hyphenation diktats.</p>
<p>Also bundled with this bug fix are other editorial changes to fix cross-spec linking errors; for details see the individual commit messages.</p>
</div></details></div>
<div class="toot" id="agenda-11-29"><h2>QT4 CG meeting 013 draft agenda<span class="toot-id"> #agenda-11-29</span></h2><div class="pubdate">25 Nov at 14:32:27 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/11-29">https://qt4cg.org/meeting/agenda/2022/11-29</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-253"><h2>Issue #253 closed<span class="toot-id"> #closed-253</span></h2><div class="pubdate">25 Nov at 12:19:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/253">https://github.com/qt4cg/qtspecs/pull/253</a></div><p>Fix xnt references</p></div>
<div class="toot" id="closed-237"><h2>Issue #237 closed<span class="toot-id"> #closed-237</span></h2><div class="pubdate">25 Nov at 11:53:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/237">https://github.com/qt4cg/qtspecs/pull/237</a></div><p>Issue167 xsl conditionals</p></div>
<div class="toot" id="created-272"><h2>Issue #272 created<span class="toot-id"> #created-272</span></h2><div class="pubdate">25 Nov at 10:14:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/272">https://github.com/qt4cg/qtspecs/issues/272</a></div><details><summary>Setting parameter values in xsl:use-package</summary><div class="markup"><p>It's possible for two different components of an application to use the same library package (via <code>xsl:use-package</code>) and in principle each of them should be able to configure that package (by setting its global parameters) in different ways. Currently though it's not at all clear how the global parameters of a used package should be set (and there are some inconsistencies in the spec concerning how the <code>visibility</code> attribute on such parameters is supposed to work).</p>
<p>I think that it's fairly straightforward to plug this gap by allowing xsl:use-package to have xsl:with-param children, naming the stylesheet parameters in the used package and assigning them values. For static parameters the values must be assigned using static expressions; for non-static parameters any expression can be used: because of the scoping rules and the syntactic constraints on <code>xsl:use-package</code>, the value of the expression can only depend on global variable and parameters in the using stylesheet package.</p>
</div></details></div>
<div class="toot" id="created-271"><h2>Pull request #271 created<span class="toot-id"> #created-271</span></h2><div class="pubdate">24 Nov at 16:10:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/271">https://github.com/qt4cg/qtspecs/pull/271</a></div><details><summary>Amendments to data model spec as per minutes of 2022-11-22</summary><div class="markup"><p>Changes to data model spec, see actions QT4CG-012-01, -02, -03, -04, -06.</p>
</div></details></div>
<div class="toot" id="created-270"><h2>Issue #270 created<span class="toot-id"> #created-270</span></h2><div class="pubdate">24 Nov at 13:56:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/270">https://github.com/qt4cg/qtspecs/issues/270</a></div><details><summary>Incorrect statement about named modes</summary><div class="markup"><p>On the description of the 'visibility' attribute <a href="https://qt4cg.org/specifications/xslt-40/Overview-diff.html#declaring-modes">here</a> it says:</p>
<blockquote>
<p>A named mode is not eligible to be used as the <a href="https://qt4cg.org/specifications/xslt-40/Overview-diff.html#dt-initial-mode">initial mode</a> if its visibility is private.</p>
</blockquote>
<p>But, if the mode is designated as default mode of the implicit or explicit <code>xsl:package</code> then it's eligible as an initial mode. Having a private visibility does not affect it's initial status. Furthermore, the unnamed mode is always private, and always initial.</p>
</div></details></div>
<div class="toot" id="created-269"><h2>Issue #269 created<span class="toot-id"> #created-269</span></h2><div class="pubdate">24 Nov at 13:20:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/269">https://github.com/qt4cg/qtspecs/issues/269</a></div><details><summary>Function for URI relativization</summary><div class="markup"><p>Signature:</p>
<pre><code class="language-xq">relativize($uri as xs:anyURI, $base as xs:anyURI) as xs:anyURI
</code></pre>
<p>Example: <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/net/URI.html#relativize(java.net.URI)">URI::relativize</a> in Java</p>
</div></details></div>
<div class="toot" id="created-268"><h2>Pull request #268 created<span class="toot-id"> #created-268</span></h2><div class="pubdate">24 Nov at 10:28:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/268">https://github.com/qt4cg/qtspecs/pull/268</a></div><details><summary>New type-hierarchy images / descriptions</summary><div class="markup"><p>Close #265</p>
<p>This is my attempt to improve the type-hierarchy images.</p>
<ol>
<li>There <em>were</em> graphics already, but they were accidentally not being copied into the right place.</li>
<li>But, they're for 3.1 and they're in some format I don't recognize, so</li>
<li>I created new SVG ones anyway, that folks may or may not like</li>
<li>I replaced the big, ugly yellow tables with prose. I concluded that accessibility was the only reason they were present.</li>
<li>The colors are a little different, and a little "off", but they're explicitly chosen from a pallet that offers unambiguously differenty colors for the three most common forms of color-blindness.</li>
<li>One of the SVG images is too wide, I'm not sure what to do about that</li>
<li>The labels are text, so you can search for them, and xs:anyAtomicType is a link. We could make more links.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-267"><h2>Issue #267 closed<span class="toot-id"> #closed-267</span></h2><div class="pubdate">24 Nov at 10:16:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/267">https://github.com/qt4cg/qtspecs/pull/267</a></div><p>Stylesheet updates for inline-SVG in the data model</p></div>
<div class="toot" id="created-267"><h2>Pull request #267 created<span class="toot-id"> #created-267</span></h2><div class="pubdate">24 Nov at 10:08:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/267">https://github.com/qt4cg/qtspecs/pull/267</a></div><details><summary>Stylesheet updates for inline-SVG in the data model</summary><div class="markup"><p>I need to commit this first, and separately, so that the build will be correct.</p>
<p>Also fixed an obvious CSS typo.</p>
</div></details></div>
<div class="toot" id="created-266"><h2>Issue #266 created<span class="toot-id"> #created-266</span></h2><div class="pubdate">23 Nov at 18:49:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/266">https://github.com/qt4cg/qtspecs/issues/266</a></div><details><summary>Add an option on xsl:copy-of to copy a subtree with a change of namespace</summary><div class="markup"><p>It's a common requirement to copy a subtree with a change of namespace.</p>
<p>It can be done easily enough in XSLT with apply-templates in a custom mode, but an option on xsl:copy-of could make it a lot easier. It could also potentially be a lot more efficient.</p>
<p>Alternatively, this could be provided as a function, or an option on the copy-of function.</p>
<p>Or it could be a new higher order function <code>copy-renaming($node, function($name){ xs:QName('new uri', local-name-from-QName($name) })</code>.</p>
<p>There's a danger of course of packing in too much functionality and making it just as complex/inefficient as using a custom mode.</p>
</div></details></div>
<div class="toot" id="created-265"><h2>Issue #265 created<span class="toot-id"> #created-265</span></h2><div class="pubdate">23 Nov at 12:46:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/265">https://github.com/qt4cg/qtspecs/issues/265</a></div><details><summary>Type hierarchy tables/diagrams</summary><div class="markup"><p>On 22 November, we mentioned in passing that the type hierarchy tables in the Data Model spec are hard to read. They're a garish yellow for no obvious reason and the font size is very small. Would replacing them with diagrams like this be an improvement?</p>
<p><img src="https://user-images.githubusercontent.com/36793/203549753-a970038e-4b8b-44cb-97cb-8d52d2fc736f.png" alt="out"></p>
<p>(This is the largest and most difficult to represent, I think. I've grouped some of the atomic types together to make the drawing more aesthetically pleasing. I don't think that interferes with comprehension, though might need to be explained.)</p>
<p>There's no particular rhyme or reason to the order of the items in the "second column" except to leave room for the longer hierarchies further to the right.</p>
</div></details></div>
<div class="toot" id="closed-232"><h2>Issue #232 closed<span class="toot-id"> #closed-232</span></h2><div class="pubdate">23 Nov at 09:52:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/232">https://github.com/qt4cg/qtspecs/pull/232</a></div><p>Issue 225 - Data model clarifications</p></div>
<div class="toot" id="closed-264"><h2>Issue #264 closed<span class="toot-id"> #closed-264</span></h2><div class="pubdate">23 Nov at 09:36:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/264">https://github.com/qt4cg/qtspecs/pull/264</a></div><p>THIS IS JUST A TEST IGNORE THIS</p></div>
<div class="toot" id="created-264"><h2>Pull request #264 created<span class="toot-id"> #created-264</span></h2><div class="pubdate">23 Nov at 09:29:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/264">https://github.com/qt4cg/qtspecs/pull/264</a></div><p>THIS IS JUST A TEST IGNORE THIS</p></div>
<div class="toot" id="minutes-11-22"><h2>QT4 CG meeting 012 draft minutes<span class="toot-id"> #minutes-11-22</span></h2><div class="pubdate">22 Nov at 17:33:38 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/11-22">https://qt4cg.org/meeting/minutes/2022/11-22</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-263"><h2>Issue #263 closed<span class="toot-id"> #closed-263</span></h2><div class="pubdate">22 Nov at 12:29:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/263">https://github.com/qt4cg/qtspecs/pull/263</a></div><p>Exclude spec XSL from PRs</p></div>
<div class="toot" id="created-263"><h2>Pull request #263 created<span class="toot-id"> #created-263</span></h2><div class="pubdate">22 Nov at 12:22:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/263">https://github.com/qt4cg/qtspecs/pull/263</a></div><details><summary>Exclude spec XSL from PRs</summary><div class="markup"><p>Letting the specification-specific XSL through means you can get a mismatch with the common XSL. So don't do that.</p>
</div></details></div>
<div class="toot" id="agenda-11-22"><h2>QT4 CG meeting 012 draft agenda<span class="toot-id"> #agenda-11-22</span></h2><div class="pubdate">21 Nov at 11:34:37 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/11-22">https://qt4cg.org/meeting/agenda/2022/11-22</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-251"><h2>Issue #251 closed<span class="toot-id"> #closed-251</span></h2><div class="pubdate">21 Nov at 10:02:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/251">https://github.com/qt4cg/qtspecs/pull/251</a></div><p>Use external CSS for styling</p></div>
<div class="toot" id="closed-248"><h2>Issue #248 closed<span class="toot-id"> #closed-248</span></h2><div class="pubdate">21 Nov at 09:49:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/248">https://github.com/qt4cg/qtspecs/pull/248</a></div><p>Editorial: update change logs and status</p></div>
<div class="toot" id="created-262"><h2>Issue #262 created<span class="toot-id"> #created-262</span></h2><div class="pubdate">20 Nov at 23:10:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/262">https://github.com/qt4cg/qtspecs/issues/262</a></div><details><summary>Navigation in deep-structured arrays</summary><div class="markup"><p>At present there is no convenient way to navigate down a deep-structured array (whose members are themselves arrays and maybe even (recursively) deep-structured arrays themselves).</p>
<p>For example, given the array:</p>
<pre><code class="language-xq"> [1, [2, 3], [4, [5, 6]], (7, 8, 9) ]
</code></pre>
<p>we cannot navigate to <code>6</code> with a single function call, nor do we have a convenient search mechanism that will give us all index(es)-paths that navigate to <code>6</code>, in this case just the single index-path (3, 2, 2).</p>
<p><strong>This proposal is to extend the <strong><em><a href="https://qt4cg.org/pr/258/xpath-functions-40/autodiff.html#func-array-get"><code>array:get()</code></a></em></strong> function and the <a href="https://qt4cg.org/specifications/xquery-40/xpath-40-diff.html#id-array-lookup"><strong><em>array lookup using function call syntax</em></strong></a> to accept as their last argument not just a single integer position, but a sequence of integers.</strong></p>
<p>The sequence of integer position is called <strong>"item-navigation-path"</strong>, or simply: <strong>"navigation-path"</strong>.</p>
<p>For the array defined above, the navigation path to the contained item <code>6</code> is:</p>
<p><strong><code>(3, 2, 2)</code></strong></p>
<p><strong>XPath implementation</strong>:</p>
<pre><code class="language-xq">let $ar := [1, [2, 3], [4, [5, 6]], (7, 8, 9) ],
    $get := -&gt; ($input as array(*), $indices as xs:integer*)
            {
              let $getHelper := -&gt; ($input as array(*), $indices as xs:integer*, $self as function(*))
              {
                let $headIndex := head($indices), $restindices := tail($indices)
                  return
                    if(exists($restindices))
                      then $self($input($headIndex),$restindices, $self)
                      else if(exists($headIndex))
                             then $input($headIndex)
                             else $input
               }
              return $getHelper($input, $indices, $getHelper)
            }
  return
    $ar =&gt; $get((3, 2, 2))
     (: (: Or alternatively : :) $get($ar, (3, 2, 2)) :)
</code></pre>
<p>When the above expression is evaluated, the expected, correct result is produced:</p>
<p><code>6</code></p>
<p><strong>Goals</strong></p>
<ol>
<li>
<p>To allow a simple and intuitive deep-indexing navigation with a single function call.</p>
</li>
<li>
<p>To allow for sophisticated deep-searching functionality (like the current <code>array:index-where()</code> and <code>array:index-of()</code>, but not just scratching the surface) to return the navigation paths to wanted items of interest, which then could be stored, passed to other functions and easily retrieved.</p>
</li>
</ol>
<p><strong>Other examples</strong>:</p>
<pre><code class="language-xq">let $ar := [1, [2, 3], [4, [5, 6]], (7, 8, 9) ],
    $get := -&gt; ($input as array(*), $indices as xs:integer*)
            {
              let $getHelper := -&gt; ($input as array(*), $indices as xs:integer*, $self as function(*))
              {
                let $headIndex := head($indices), $restindices := tail($indices)
                  return
                    if(exists($restindices))
                      then $self($input($headIndex),$restindices, $self)
                      else if(exists($headIndex))
                             then $input($headIndex)
                             else $input
               }
              return $getHelper($input, $indices, $getHelper)
            }
  return
     ( $get($ar, (3, 2, 2)), $get($ar, 2), $get($ar, (3,1)),   $get($ar, (3,2)), $get($ar, ())  )
</code></pre>
<p>When the above expression is evaluated, all the expected, correct results are produced:</p>
<pre><code class="language-xq">6
[2,3]
4
[5,6]
[1,[2,3],[4,[5,6]],(7,8,9)]
</code></pre>
<p><img src="https://user-images.githubusercontent.com/10605892/202931815-9fd429f4-55e1-4a79-bd0a-fc6c98990393.png" alt="image"></p>
</div></details></div>
<div class="toot" id="created-261"><h2>Pull request #261 created<span class="toot-id"> #created-261</span></h2><div class="pubdate">20 Nov at 09:48:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/261">https://github.com/qt4cg/qtspecs/pull/261</a></div><details><summary>Proposed fn:char function - see issue 121</summary><div class="markup"><p>Although discussion on issue #121 did not converge on a consensus, this PR proposes a new function which I believe meets the requirements expressed.</p>
</div></details></div>
<div class="toot" id="created-260"><h2>Issue #260 created<span class="toot-id"> #created-260</span></h2><div class="pubdate">19 Nov at 23:54:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/260">https://github.com/qt4cg/qtspecs/issues/260</a></div><details><summary>array:index-of</summary><div class="markup"><p>Seems we are missing the corresponding array function to the standard (on sequences) <strong><em>fn:index-of(</em></strong>).</p>
<h3>Summary</h3>
<p>Returns a sequence of positive integers giving the positions within the array <code>$input</code> of items that are equal to the <code>$search-member</code>.</p>
<h3>Signature</h3>
<pre><code class="language-xq">array:index-of(
               $input  as array(*),	
               $searched-member as item()*,
               $compare($x as item()*, $y as item()*) as xs:boolean := fn:deep-equal#2
                 ) as xs:integer*
</code></pre>
<h3>Properties</h3>
<p>This function is deterministic, context-independent, and focus-independent</p>
<h3>Rules</h3>
<p>The result of the function is a sequence of integers, in monotonic ascending order, representing the <code>1</code>-based positions in the input array of those members <code>$mem</code> for whom <code>$compare($mem, $searched-member)</code> is <code>true()</code> .</p>
<p>More formally, the function returns the result of the XPath expression:</p>
<pre><code class="language-xq">  (1 to array:size($input)) ! (-&gt; {  .[$compare($input(.), $searched-member)] }) (.)
</code></pre>
<h3>Examples</h3>
<p><img src="https://user-images.githubusercontent.com/10605892/202876246-0256f0e7-c736-48b5-b862-7ebbe142d9ce.png" alt="image"></p>
<p>And also this:</p>
<p><img src="https://user-images.githubusercontent.com/10605892/202876368-9dd18c8c-888f-41e2-991d-b0779bc6dcd9.png" alt="image"></p>
</div></details></div>
<div class="toot" id="created-259"><h2>Pull request #259 created<span class="toot-id"> #created-259</span></h2><div class="pubdate">18 Nov at 23:24:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/259">https://github.com/qt4cg/qtspecs/pull/259</a></div><details><summary>Issue #74 - add the fn:parse-html function</summary><div class="markup"><p>This PR makes the following changes:</p>
<ol>
<li>Add an <code>.editorconfig</code> file to allow editors and IDEs to indent the XML source documents consistently.</li>
<li>Group the XML and JSON parsing and serialization functions into a common top-level section.</li>
<li>Update the html5 bibref to the WHATWG specification -- the old HTML5 link redirects there.</li>
<li>Add a new fn:parse-html function specification.</li>
<li>Define a mapping between the HTML DOM and the XDM nodes.</li>
</ol>
<p>The function specification itself is complete. The HTML DOM to XDM node mapping currently only contains the overview. I'm going to write that for this PR, this is just to start the ball rolling in specifying this function.</p>
</div></details></div>
<div class="toot" id="created-258"><h2>Pull request #258 created<span class="toot-id"> #created-258</span></h2><div class="pubdate">18 Nov at 19:25:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/258">https://github.com/qt4cg/qtspecs/pull/258</a></div><details><summary>Issue #114 - add array:index-where() function</summary><div class="markup"><p>The function is symmetric with fn:index-where.</p>
</div></details></div>
<div class="toot" id="created-257"><h2>Issue #257 created<span class="toot-id"> #created-257</span></h2><div class="pubdate">18 Nov at 18:02:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/257">https://github.com/qt4cg/qtspecs/issues/257</a></div><details><summary>Improving the styling/presentation/prepresentation of the record types in the F&amp;O spec</summary><div class="markup"><p>I'm not keen on the † symbol being used to indicate and link record types. This is not used elsewhere, and when a record type is used as a type, there is a link to the record type definition. I think that that link is sufficient.</p>
<p>The presentation of the record type definition has the following format:</p>
<pre><code>†type-name:
record(
    ...
)
</code></pre>
<p>The record part is fine, but I find the <code>†type-name:</code> part clunky. For functions, omiting the <code>declare function</code> part from the XQuery syntax makes sense as the function signature is readable without that.</p>
<p>The XQuery 4.0 draft spec has the following (as of yet unapproved) syntax for defining type aliases: https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-item-type-declaration. I would suggest using something similar, e.g.:</p>
<pre><code>type-name as record(
    ...
)
</code></pre>
<p>That is in line with the way function declarations are specified and looks more readable to me.</p>
<p>Finally, ommitting the id from the <code>record</code> element results in <code>†:</code> before the record. -- It would be nice if instead of:</p>
<pre><code>        &lt;div3 id="html-parser-options"&gt;
           &lt;head&gt;HTML parser options&lt;/head&gt;
           &lt;example role="record"&gt;
              &lt;record id="parse-html-options"&gt;
                 &lt;arg name="method" type="union(enum(&amp;quot;html5&amp;quot;), xs:string)"/&gt;
                 &lt;arg name="*"/&gt;
              &lt;/record&gt;
           &lt;/example&gt;
</code></pre>
<p>you could write something like:</p>
<pre><code>        &lt;div3 id="parse-html-options"&gt;
           &lt;head&gt;HTML parser options&lt;/head&gt;
           &lt;example role="record"&gt;
              &lt;record type-name="parse-html-options"&gt;
                 &lt;arg name="method" type="union(enum(&amp;quot;html5&amp;quot;), xs:string)"/&gt;
                 &lt;arg name="*"/&gt;
              &lt;/record&gt;
           &lt;/example&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-256"><h2>Issue #256 created<span class="toot-id"> #created-256</span></h2><div class="pubdate">18 Nov at 16:52:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/256">https://github.com/qt4cg/qtspecs/issues/256</a></div><details><summary>Function declarations: static and dynamic context for default parameter values</summary><div class="markup"><p>In the new text for default values on parameters in XQuery function declarations, we don't say clearly what the static context for the default value expression is. In particular we don't say that it excludes the other parameters of the function. The XSLT spec has similar (though slightly different) shortcomings.</p>
<p>There's a slight complication in that we say the dynamic context for the default value expression is the dynamic context of the function call. But what if the default value is a variable reference <code>$x</code>? Statically, this will be (presumably, though we don't currently say) be bound to a global variable <code>$x</code>. Now, we say (under "dynamic context") that the dynamic "variable values" contains the same [expanded QNames] as the [in-scope variables] in the [static context] for the expression. But, the static context for the default value expression and the static context for the function call have different in-scope variables and they must therefore have different variable values in the dynamic context, so it's wrong to say that the dynamic context for the default value expression is the same as that of the function call.</p>
<p>My first instinct would be to restrict the default value to being what XSLT calls a "static expression" (this isn't defined in XQuery, but it could be defined easily enough). However, that would disallow using "." as the default value expression, which is something we wanted to permit.</p>
<p>The next option would be to say that the dynamic context for a default value expression is the same as the dynamic context of the function call except that "variable values" contains bindings for global variables only. This feels rather kludgey, but it's workable in principle. (It's worth noting, and might be worth noting in the spec, that in XQuery all components of the dynamic context except the focus and the variable values are typically immutable within an execution scope. The same isn't true in XSLT, where we have additional dynamic context components like regex-group() and current-output-uri() to worry about.).</p>
</div></details></div>
<div class="toot" id="closed-41"><h2>Issue #41 closed<span class="toot-id"> #closed-41</span></h2><div class="pubdate">18 Nov at 16:44:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/41">https://github.com/qt4cg/qtspecs/issues/41</a></div><p>[XQuery] The TypeswitchExpr and CaseClause symbols have repeated VarNames</p></div>
<div class="toot" id="closed-5"><h2>Issue #5 closed<span class="toot-id"> #closed-5</span></h2><div class="pubdate">18 Nov at 16:41:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/5">https://github.com/qt4cg/qtspecs/issues/5</a></div><p>[FO] The math:atan2 notes incorrectly defines its behaviour.</p></div>
<div class="toot" id="created-255"><h2>Issue #255 created<span class="toot-id"> #created-255</span></h2><div class="pubdate">18 Nov at 12:01:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/255">https://github.com/qt4cg/qtspecs/issues/255</a></div><details><summary>Build error running gradlew publish on Windows</summary><div class="markup"><p>When running <code>./gradlew publish</code> in Windows (via Git Bash) or running the publish gradle task in an IntelliJ Run/Debug configuration, I get the following error:</p>
<pre><code>&gt; Task :xquery_assemble_xpath
Transforming specifications/xquery-40/src/xpath.xml...
Error at char 9 in expression in xsl:variable/@select on line 168 column 60 of assemble-spec.xsl:
  FODC0005  Invalid URI
  file:/D:/Projects/xquery-xslt/qtspecs/build/xquery-40/src/xpath-preprocessed.xml/../D:\Projects\xquery-xslt\qtspecs\build/xquery-40/temp-xpath-grammar.xml. Caused by java.net.URISyntaxException: Illegal character in opaque part at index 2: D:\Projects\xquery-xslt\qtspecs\build/xquery-40/temp-xpath-grammar.xml
  In template rule with match="prodrecap" on line 152 of assemble-spec.xsl
     invoked by xsl:apply-templates at file:/D:/Projects/xquery-xslt/qtspecs/style/assemble-spec.xsl#51
  In template rule with match="node()[fn:empty(...)]" on line 48 of assemble-spec.xsl
     invoked by xsl:apply-templates at file:/D:/Projects/xquery-xslt/qtspecs/style/assemble-spec.xsl#51
  In template rule with match="node()[fn:empty(...)]" on line 48 of assemble-spec.xsl
     invoked by xsl:apply-templates at file:/D:/Projects/xquery-xslt/qtspecs/style/assemble-spec.xsl#51
  In template rule with match="node()[fn:empty(...)]" on line 48 of assemble-spec.xsl
     invoked by xsl:apply-templates at file:/D:/Projects/xquery-xslt/qtspecs/style/assemble-spec.xsl#51
  In template rule with match="node()[fn:empty(...)]" on line 48 of assemble-spec.xsl
     invoked by xsl:apply-templates at file:/D:/Projects/xquery-xslt/qtspecs/specifications/xquery-40/style/assemble-xquery.xsl#26
  In template rule with match="/" on line 13 of assemble-xquery.xsl
Invalid URI file:/D:/Projects/xquery-xslt/qtspecs/build/xquery-40/src/xpath-preprocessed.xml/../D:\Projects\xquery-xslt\qtspecs\build/xquery-40/temp-xpath-grammar.xml
</code></pre>
<p>I've tracked this down to the <code>grammar-file</code> option passed to the XSLT in the <code>build.gradle</code> file, but I'm not currently sure what the fix should be.</p>
<p>Note: running this within Linux via WSL works, so the issue looks like it is due to handling Windows paths as file URIs.</p>
</div></details></div>
<div class="toot" id="created-254"><h2>Pull request #254 created<span class="toot-id"> #created-254</span></h2><div class="pubdate">17 Nov at 23:35:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/254">https://github.com/qt4cg/qtspecs/pull/254</a></div><details><summary>Improvements/fixes for the coercion rules</summary><div class="markup"><p>This PR is concerned with the coercion rules (formerly known as function conversion rules).</p>
<p>It fixes issue #242, a minor omission where we failed to say that coercion rules are used to convert the result of a static function call to the required return type.</p>
<p>It implements the proposal in issue #189, to apply the coercion rules to variable declarations/bindings as well as to function arguments and results. This brings XQuery into line with XSLT, and thus paves the way to allowing type declarations on "let" clauses in XPath.</p>
<p>It does some further editorial tidying up of the rules, such as improvng the definition of the term "coercion rules", adding clarifying notes, etc.</p>
<p>In approving this PR, I am requesting approval of the change (which was already in the draft, but has not been discussed) to introduce "down-casting" or "relabelling". This allows a function to declare a parameter with required type <code>xs:positiveInteger</code>, and for a caller to supply the value 42 without explicitly casting it to <code>xs:positiveInteger</code>.</p>
</div></details></div>
<div class="toot" id="closed-149"><h2>Issue #149 closed<span class="toot-id"> #closed-149</span></h2><div class="pubdate">17 Nov at 11:12:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/149">https://github.com/qt4cg/qtspecs/issues/149</a></div><p>Functions for splitting a sequence (or array) based on predicate matching </p></div>
<div class="toot" id="created-253"><h2>Pull request #253 created<span class="toot-id"> #created-253</span></h2><div class="pubdate">17 Nov at 10:07:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/253">https://github.com/qt4cg/qtspecs/pull/253</a></div><details><summary>Fix xnt references</summary><div class="markup"><p>This PR doesn't make any technical changes[*]. It fixes some bugs in how cross-spec references are resolved. I failed to delete some out-of-date index files when I updated the code to generate them automatically. That lead to weird URIs. And I failed to update the stylesheets to correct for a change from <code>doc-xpath-</code> to <code>doc-xpath40</code> in the targets. Thanks to @michaelhkay for a detailed bug report.</p>
<p>[*] That's not 100% true, I did change to <code>&lt;xterm&gt;</code> references to <code>BracedURILiteral</code> into <code>&lt;xnt&gt;</code> references in <code>function-catalog.xml</code>.</p>
</div></details></div>
<div class="toot" id="closed-252"><h2>Issue #252 closed<span class="toot-id"> #closed-252</span></h2><div class="pubdate">17 Nov at 09:45:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/252">https://github.com/qt4cg/qtspecs/pull/252</a></div><p>Fix typo in CODEOWNERS</p></div>
<div class="toot" id="created-252"><h2>Pull request #252 created<span class="toot-id"> #created-252</span></h2><div class="pubdate">17 Nov at 09:38:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/252">https://github.com/qt4cg/qtspecs/pull/252</a></div><p>Fix typo in CODEOWNERS</p></div>
<div class="toot" id="created-251"><h2>Pull request #251 created<span class="toot-id"> #created-251</span></h2><div class="pubdate">17 Nov at 09:37:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/251">https://github.com/qt4cg/qtspecs/pull/251</a></div><details><summary>Use external CSS for styling</summary><div class="markup"><p>This PR doesn't change anything technically, it moves around some big inline-blobs of CSS into external files so that we can have more consistency more easily. Every spec includes <code>qtspecs.css</code> and another spec-specific CSS if it needs one. The diff markup is also in a separate CSS that's included in the diff versions.</p>
<p>I don't think I've broken the styling anywhere, but if you look around and find something that looks odd, please let me know.</p>
</div></details></div>
<div class="toot" id="created-250"><h2>Pull request #250 created<span class="toot-id"> #created-250</span></h2><div class="pubdate">16 Nov at 23:07:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/250">https://github.com/qt4cg/qtspecs/pull/250</a></div><details><summary>97 New functions fn:foot, fn:trunk, array:foot, array:trunk</summary><div class="markup"><p>New functions fn:foot, fn:truncate, array:foot, array:truncate, as proposed in issue #97. Note that not everyone was happy with the name "truncate".</p>
</div></details></div>
<div class="toot" id="created-249"><h2>Pull request #249 created<span class="toot-id"> #created-249</span></h2><div class="pubdate">16 Nov at 22:26:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/249">https://github.com/qt4cg/qtspecs/pull/249</a></div><details><summary>Issue 213: new function fn:items-at</summary><div class="markup"><p>Add new function fn:items-at in response to issue 213</p>
</div></details></div>
<div class="toot" id="created-248"><h2>Pull request #248 created<span class="toot-id"> #created-248</span></h2><div class="pubdate">16 Nov at 18:43:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/248">https://github.com/qt4cg/qtspecs/pull/248</a></div><details><summary>Editorial: update change logs and status</summary><div class="markup"><p>This PR is purely editorial: it updates change logs and status information to reflect the current state of play. In particular, the change logs in appendices now attempt to distinguish changes approved by the WG from changes that were in the baseline draft prepared by the editor, but which have not yet been reviewed or approved.</p>
</div></details></div>
<div class="toot" id="created-247"><h2>Pull request #247 created<span class="toot-id"> #created-247</span></h2><div class="pubdate">16 Nov at 17:06:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/247">https://github.com/qt4cg/qtspecs/pull/247</a></div><details><summary>Actions QT4CG-011-01 and QT4CG-011-03. </summary><div class="markup"><p>Actions QT4CG-011-01 and QT4CG-011-03. (Note, there are still some infrastructure problems with xnt references)</p>
</div></details></div>
<div class="toot" id="closed-246"><h2>Issue #246 closed<span class="toot-id"> #closed-246</span></h2><div class="pubdate">16 Nov at 17:02:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/246">https://github.com/qt4cg/qtspecs/pull/246</a></div><p>Give ednote a distinctive appearance</p></div>
<div class="toot" id="created-246"><h2>Pull request #246 created<span class="toot-id"> #created-246</span></h2><div class="pubdate">16 Nov at 16:52:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/246">https://github.com/qt4cg/qtspecs/pull/246</a></div><details><summary>Give ednote a distinctive appearance</summary><div class="markup"><p>Next, move all the CSS into a common location</p>
</div></details></div>
<div class="toot" id="closed-245"><h2>Issue #245 closed<span class="toot-id"> #closed-245</span></h2><div class="pubdate">16 Nov at 16:49:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/245">https://github.com/qt4cg/qtspecs/pull/245</a></div><p>Updates to parse-uri and build-uri functions</p></div>
<div class="toot" id="created-245"><h2>Pull request #245 created<span class="toot-id"> #created-245</span></h2><div class="pubdate">16 Nov at 16:29:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/245">https://github.com/qt4cg/qtspecs/pull/245</a></div><details><summary>Updates to parse-uri and build-uri functions</summary><div class="markup"><p>Complete <a href="https://qt4cg.org/meeting/minutes/2022/11-15.html#new-actions">actions</a> QT4CG-011-04 and QT4CG-011-05.</p>
</div></details></div>
<div class="toot" id="closed-222"><h2>Issue #222 closed<span class="toot-id"> #closed-222</span></h2><div class="pubdate">16 Nov at 11:52:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/222">https://github.com/qt4cg/qtspecs/pull/222</a></div><p>Sequence comparison (starts, ends, contains) - issues 94, 96</p></div>
<div class="toot" id="closed-244"><h2>Issue #244 closed<span class="toot-id"> #closed-244</span></h2><div class="pubdate">16 Nov at 11:52:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/244">https://github.com/qt4cg/qtspecs/pull/244</a></div><p>Sequence comparison (starts, ends, contains) - issues 94, 96 (fix 222)</p></div>
<div class="toot" id="closed-80"><h2>Issue #80 closed<span class="toot-id"> #closed-80</span></h2><div class="pubdate">16 Nov at 11:50:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/80">https://github.com/qt4cg/qtspecs/issues/80</a></div><p>[FO] fn:while (before: fn:until)</p></div>
<div class="toot" id="created-244"><h2>Pull request #244 created<span class="toot-id"> #created-244</span></h2><div class="pubdate">16 Nov at 11:35:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/244">https://github.com/qt4cg/qtspecs/pull/244</a></div><details><summary>Sequence comparison (starts, ends, contains) - issues 94, 96 (fix 222)</summary><div class="markup"><p>This is another attempt to fix the merge conflicts in #222</p>
</div></details></div>
<div class="toot" id="closed-243"><h2>Issue #243 closed<span class="toot-id"> #closed-243</span></h2><div class="pubdate">16 Nov at 11:29:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/243">https://github.com/qt4cg/qtspecs/pull/243</a></div><p>Sequence comparison (starts, ends, contains) - issues 94, 96 with merge conflicts resolved</p></div>
<div class="toot" id="created-243"><h2>Pull request #243 created<span class="toot-id"> #created-243</span></h2><div class="pubdate">16 Nov at 11:12:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/243">https://github.com/qt4cg/qtspecs/pull/243</a></div><details><summary>Sequence comparison (starts, ends, contains) - issues 94, 96 with merge conflicts resolved</summary><div class="markup"><p>I believe this is PR #222 with merge conflicts against the current master branch resolved.</p>
</div></details></div>
<div class="toot" id="closed-228"><h2>Issue #228 closed<span class="toot-id"> #closed-228</span></h2><div class="pubdate">16 Nov at 10:56:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/228">https://github.com/qt4cg/qtspecs/pull/228</a></div><p>Updates to make FO valid</p></div>
<div class="toot" id="closed-202"><h2>Issue #202 closed<span class="toot-id"> #closed-202</span></h2><div class="pubdate">16 Nov at 10:02:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/202">https://github.com/qt4cg/qtspecs/pull/202</a></div><p>NW for MK: subtyping (196)</p></div>
<div class="toot" id="created-242"><h2>Issue #242 created<span class="toot-id"> #created-242</span></h2><div class="pubdate">16 Nov at 00:57:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/242">https://github.com/qt4cg/qtspecs/issues/242</a></div><details><summary>Coercion rules used to convert function result to expected type</summary><div class="markup"><p>We have separated the rules for static and dynamic function calls, which was necessary because static calls can now use keywords, whereas dynamic calls can't.</p>
<p>The new rules say that the coercion rules are used to convert the result to the expected result type in a dynamic call, but they fail to say that this also happens on a static call.</p>
<p>It would be nicer (and less error prone) if we could combine the rules. Ideally we should define that a static function call <code>F(A, B, C)</code> is equivalent to the dynamic call <code>F#3(A, B, C)</code>. This in turn would be easier if we can find a way to extend function items to have optional parameters and to permit keyword arguments.</p>
<p>Note also that the definition of the term "coercion rules" is deficient. It doesn't say what the rules are, it just gives an example of one situation where they are used.</p>
</div></details></div>
<div class="toot" id="closed-153"><h2>Issue #153 closed<span class="toot-id"> #closed-153</span></h2><div class="pubdate">15 Nov at 20:48:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/153">https://github.com/qt4cg/qtspecs/pull/153</a></div><p>Explicitly mention subtypes for arrays and maps</p></div>
<div class="toot" id="minutes-11-15"><h2>QT4 CG meeting 011 draft minutes<span class="toot-id"> #minutes-11-15</span></h2><div class="pubdate">15 Nov at 18:00:42 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/11-15">https://qt4cg.org/meeting/minutes/2022/11-15</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-230"><h2>Issue #230 closed<span class="toot-id"> #closed-230</span></h2><div class="pubdate">15 Nov at 17:52:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/230">https://github.com/qt4cg/qtspecs/pull/230</a></div><p>New proposed text resolving issue 71 (Guarded expressions)</p></div>
<div class="toot" id="closed-72"><h2>Issue #72 closed<span class="toot-id"> #closed-72</span></h2><div class="pubdate">15 Nov at 17:52:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/72">https://github.com/qt4cg/qtspecs/issues/72</a></div><p>[FO] Provide better support for URI processing within an expression</p></div>
<div class="toot" id="closed-215"><h2>Issue #215 closed<span class="toot-id"> #closed-215</span></h2><div class="pubdate">15 Nov at 17:52:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/215">https://github.com/qt4cg/qtspecs/pull/215</a></div><p>First attempt at parse-uri and build-uri functions</p></div>
<div class="toot" id="closed-207"><h2>Issue #207 closed<span class="toot-id"> #closed-207</span></h2><div class="pubdate">15 Nov at 17:50:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/207">https://github.com/qt4cg/qtspecs/pull/207</a></div><p>Issue 1. New expanded-QName function; new fn:QName#1 variant</p></div>
<div class="toot" id="closed-210"><h2>Issue #210 closed<span class="toot-id"> #closed-210</span></h2><div class="pubdate">15 Nov at 17:30:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/210">https://github.com/qt4cg/qtspecs/pull/210</a></div><p>Issue 80: fn:iterate-while (before: fn:while)</p></div>
<div class="toot" id="closed-197"><h2>Issue #197 closed<span class="toot-id"> #closed-197</span></h2><div class="pubdate">15 Nov at 17:29:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/197">https://github.com/qt4cg/qtspecs/pull/197</a></div><p>NW for MK: Variadicity (166)</p></div>
<div class="toot" id="created-241"><h2>Issue #241 created<span class="toot-id"> #created-241</span></h2><div class="pubdate">15 Nov at 11:23:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/241">https://github.com/qt4cg/qtspecs/issues/241</a></div><details><summary>Functions integer-to-string and string-to-integer with radix</summary><div class="markup"><p>I propose (in response to a suggestion from Joel Kalvesmaki on the XML Slack) two functions</p>
<pre><code>fn:integer-to-string($value as xs:integer, $radix as xs:integer := 10) as xs:string

fn:string-to-integer($value as xs:string, $radix as xs:integer := 10) as xs:integer
</code></pre>
<p>that produce/accept string representations of signed integers in a base other than 10. Proposed range for $radix is 2 to 32.</p>
<p>Note:  I considered extending <code>fn:format-integer()</code>, but the result looked clumsy.</p>
</div></details></div>
<div class="toot" id="closed-240"><h2>Issue #240 closed<span class="toot-id"> #closed-240</span></h2><div class="pubdate">14 Nov at 10:17:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/240">https://github.com/qt4cg/qtspecs/pull/240</a></div><p>Subtyping</p></div>
<div class="toot" id="created-240"><h2>Pull request #240 created<span class="toot-id"> #created-240</span></h2><div class="pubdate">13 Nov at 22:41:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/240">https://github.com/qt4cg/qtspecs/pull/240</a></div><p>Subtyping</p></div>
<div class="toot" id="created-239"><h2>Issue #239 created<span class="toot-id"> #created-239</span></h2><div class="pubdate">13 Nov at 11:50:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/239">https://github.com/qt4cg/qtspecs/issues/239</a></div><details><summary>Terminology concerning function items and their access to static and dynamic context</summary><div class="markup"><p>See this StackOverflow question: https://stackoverflow.com/questions/74408887</p>
<p>The language describing how the static and dynamic context are bound in function items delivered by expressions such as <code>xs:QName#1</code> or <code>xs:QName(?)</code> is pretty impenetrable, and I don't think it is very accurate. For example, for the latter case, the relevant rule asks "If [the implementation of F] is not an XPath 3.1 expression..." which seems to suggest that the behaviour varies depending on whether the implementation of <code>xs:QName()</code> is written in XPath or in some other language, which cannot be right.</p>
<p>For named function references, the spec talks of " if the function is context dependent, then the returned function is associated with the static context of the named function reference and the dynamic context in which it is evaluated. " but what exactly does it mean for the function to be context dependent?</p>
<p>The behaviour of partial function application is said to depend on whether "F's implementation is already associated with contexts", and if F was the result of a named function reference, then this seems to depend on whether the [static] function that's the target of the reference is context dependent, but how is that determined?</p>
<p>This issue is raised essentially to take note that there's a lot of flakiness in the specification in this area. It's not obvious what the solution is, but there is surely scope for making things much clearer than they are currently.</p>
</div></details></div>
<div class="toot" id="created-238"><h2>Issue #238 created<span class="toot-id"> #created-238</span></h2><div class="pubdate">12 Nov at 08:30:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/238">https://github.com/qt4cg/qtspecs/issues/238</a></div><details><summary>Support Invisible XML</summary><div class="markup"><p>I propose that we support Invisible XML by means of a function</p>
<p><code>fn:invisible-xml($grammar as xs:string) as (function($string) as document-node())</code></p>
<p>The function takes as input a string defining an invisible XML grammar in ixml format, and returns as output a function that can be used to parse strings conforming to that grammar, converting them into XDM document nodes.</p>
<p>As a "dog-food" use case, we could use this for rendering function signatures in the F&amp;O specification. Rather than using manual markup to define the signature of each function, we could define an IXML grammar for function signatures, and use this as the basis for formatting the representation in the spec. This would be particularly beneficial as we start to introduce more complex signatures involving record types.</p>
</div></details></div>
<div class="toot" id="created-237"><h2>Pull request #237 created<span class="toot-id"> #created-237</span></h2><div class="pubdate">11 Nov at 22:28:24 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/237">https://github.com/qt4cg/qtspecs/pull/237</a></div><details><summary>Issue167 xsl conditionals</summary><div class="markup"><p>Update following CG review on 8 November; improvements to notes and examples, no substantive change.</p>
</div></details></div>
<div class="toot" id="created-236"><h2>Issue #236 created<span class="toot-id"> #created-236</span></h2><div class="pubdate">11 Nov at 12:37:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/236">https://github.com/qt4cg/qtspecs/issues/236</a></div><details><summary>map:build: sequence of keys</summary><div class="markup"><p>In resolving PR #203 to address issue #151, the group decided not to immediately address all of the concerns raised by Martin Honnen in <a href="https://lists.w3.org/Archives/Public/public-xslt-40/2022Oct/0035.html">an email discussion</a> where he wrote:</p>
<pre><code>When map:group-by was introduced I found the restriction of a single key
instead of a sequence of keys unnecessarily restrictive (some people on
Slack agreed), the same appears in my view to be the case for the new
map:build, I think it could be easily adapted to handle a sequence of
keys by using e.g.

  fold-left($input, map{}, -&gt;($map, $next) {

   fold-left($key($next), $map, -&gt;($map, $key) {
    let $nextValue := $value($next) return
    if (map:contains($map, $key))
    then map:put($map, $key, $combine($map($key), $nextValue))
    else map:put($map, $key, $nextValue)})
  }
)

as the implementation body/definition of the result of

map:build(
$input    as item()*,
$key    as function(item()) as xs:anyAtomicType*    := fn:identity#1,
$value    as function(item()) as item()*    := fn:identity#1,
$combine    as function(item()*, item()*) as item()*    := fn:op(',')
) as map(*)


Use case in my view is the classical example of the XSLT 3 spec where in
e.g.

&lt;titles&gt;
     &lt;title&gt;A Beginner's Guide to &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;
     &lt;title&gt;Learning &lt;ix&gt;XML&lt;/ix&gt;&lt;/title&gt;
     &lt;title&gt;Using &lt;ix&gt;XML&lt;/ix&gt; with &lt;ix&gt;Java&lt;/ix&gt;&lt;/title&gt;
&lt;/titles&gt;

you want to group the "title" elements by the "ix" child elements, with
the proposed change above that would give e.g.

map {
   "Java": (&lt;title&gt;A Beginner's Guide to &lt;ix&gt;Java&lt;/ix&gt;
&lt;/title&gt;, &lt;title&gt;Using &lt;ix&gt;XML&lt;/ix&gt; with &lt;ix&gt;Java&lt;/ix&gt;
&lt;/title&gt;),
   "XML": (&lt;title&gt;Learning &lt;ix&gt;XML&lt;/ix&gt;
&lt;/title&gt;, &lt;title&gt;Using &lt;ix&gt;XML&lt;/ix&gt; with &lt;ix&gt;Java&lt;/ix&gt;
&lt;/title&gt;)
}
</code></pre>
<p>We'll come back to this later.</p>
<p>Creating this issue satisfies <a href="https://qt4cg.org/meeting/minutes/2022/10-18.html#pr-map-build">action QT4CG-008-05 on NW</a>.</p>
</div></details></div>
<div class="toot" id="agenda-11-15"><h2>QT4 CG meeting 011 draft agenda<span class="toot-id"> #agenda-11-15</span></h2><div class="pubdate">11 Nov at 12:30:12 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/11-15">https://qt4cg.org/meeting/agenda/2022/11-15</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-177"><h2>Issue #177 closed<span class="toot-id"> #closed-177</span></h2><div class="pubdate">11 Nov at 12:00:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/177">https://github.com/qt4cg/qtspecs/pull/177</a></div><p>Items before etc</p></div>
<div class="toot" id="closed-166"><h2>Issue #166 closed<span class="toot-id"> #closed-166</span></h2><div class="pubdate">11 Nov at 11:56:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/166">https://github.com/qt4cg/qtspecs/pull/166</a></div><p>Variadicity</p></div>
<div class="toot" id="closed-196"><h2>Issue #196 closed<span class="toot-id"> #closed-196</span></h2><div class="pubdate">11 Nov at 11:55:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/196">https://github.com/qt4cg/qtspecs/pull/196</a></div><p>Subtyping</p></div>
<div class="toot" id="closed-199"><h2>Issue #199 closed<span class="toot-id"> #closed-199</span></h2><div class="pubdate">11 Nov at 10:03:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/199">https://github.com/qt4cg/qtspecs/pull/199</a></div><p>NW for MK: Items before, etc. (177)</p></div>
<div class="toot" id="closed-96"><h2>Issue #96 closed<span class="toot-id"> #closed-96</span></h2><div class="pubdate">10 Nov at 21:41:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/96">https://github.com/qt4cg/qtspecs/issues/96</a></div><p>[XPath] Functions that determine if a given sequence starts with another sequence or ends with another sequence</p></div>
<div class="toot" id="minutes-11-08"><h2>QT4 CG meeting 010 draft minutes<span class="toot-id"> #minutes-11-08</span></h2><div class="pubdate">10 Nov at 17:37:37 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/11-08">https://qt4cg.org/meeting/minutes/2022/11-08</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-235"><h2>Issue #235 created<span class="toot-id"> #created-235</span></h2><div class="pubdate">10 Nov at 09:36:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/235">https://github.com/qt4cg/qtspecs/issues/235</a></div><details><summary>Add multiple=true() option to fn:parse-json and fn:json-doc</summary><div class="markup"><p>It is common practice (though not, I believe, covered by any standard) to have files that contain multiple JSON objects. Often these will be arranged one per line, as in our own qt3tests use case R31 at https://github.com/w3c/qt3tests/blob/master/app/UseCaseR31/sales.json . In that example, the file can be parsed using <code>unparsed-text-lines()!parse-json()</code>. But in the more general case, where each object may itself be multi-line, there's no easy way of handling this.</p>
<p>I propose an option multiple=true() on <code>fn:parse-json</code> and <code>fn:json-doc</code> that enables parsing of an input containing multiple (zero or more) concatenated JSON texts. When this option is present, the result will always be delivered as an array, containing one member for each JSON text in the input. The wrapper array will be present even if the number of JSON texts in the input is zero or one.</p>
<p>If a JSON text ends with a letter or digit and the next JSON text starts with a letter or digit then they must be separated by whitespace.</p>
</div></details></div>
<div class="toot" id="closed-182"><h2>Issue #182 closed<span class="toot-id"> #closed-182</span></h2><div class="pubdate">09 Nov at 18:20:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/182">https://github.com/qt4cg/qtspecs/issues/182</a></div><p>Should we allow vendor-defined optional parameters on built-in functions?</p></div>
<div class="toot" id="created-234"><h2>Issue #234 created<span class="toot-id"> #created-234</span></h2><div class="pubdate">08 Nov at 20:56:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/234">https://github.com/qt4cg/qtspecs/issues/234</a></div><details><summary>If Without Else</summary><div class="markup"><p>This is based on the discussions in today's QT4CG meeting, as suggested by @dnovatchev.</p>
<h2>Use Case</h2>
<p>It is common to have an if condition where the <code>else</code> branch does nothing (i.e. yields the empty sequence). In BaseX, this requirement has lead to them making the else branch optional.</p>
<p>It can also be conceivable to want to elide the <code>then</code> branch as a way of not negating the if condition expression.</p>
<p>In the XSLT 4.0 draft, both of these are possible in the changes to support optional <code>@then</code> (or possibly <code>@select</code>) and <code>@else</code> attributes. Part of this is due to requiring backward compatibility with XSLT 3.0 that only allows the then branch within child elements. It would be nice to be able to support this in XPath and XQuery for parity between the languages.</p>
<h2>Design</h2>
<p>The rationale for not allowing an optional <code>else</code> is to avoid the dangling else problem from C and other languages that have optional else statements. That is:</p>
<pre><code>if ($c) then
    if ($d)
    then 1
    else 2
</code></pre>
<p>is ambiguous as the else could be part of the <code>$d</code> if statement or the <code>$c</code> if statement. This would require parenthesis around the if statement to resolve the ambiguity, but the syntax should not require that. -- That is, it should be clear to the reader what the if statement will do.</p>
<p>As such, I propose the following variants:</p>
<p>(1) An if statement with a then and else expression -- currently supported:</p>
<pre><code>if ($c) then 1 else 2
</code></pre>
<p>(2) An if statement with an else expression, but not a then expression -- new, should be unambiguous:</p>
<pre><code>if ($c) else 2
</code></pre>
<p>(3) An if statement with a then expression, but not an else expression -- to resolve the dangling else, I propose to use <code>return</code> instead of <code>then</code>:</p>
<pre><code>if ($c) return 1
</code></pre>
<p>This works analogously to the existing FLWOR, switch, typeswitch and other expressions that use <code>return</code> to denote the return/result expression.</p>
<p>For the dangling else, both cases are clear:</p>
<p>(a) when the <code>$c</code> (outer) if has the elided else expression:</p>
<pre><code>if ($c) return
    if ($d)
    then 1
    else 2
</code></pre>
<p>(b) when the <code>$d</code> (inner) if has the elided else expression:</p>
<pre><code>if ($c)
then if ($d) return 1
else 2
</code></pre>
<h2>Syntax</h2>
<p>Replace:</p>
<pre><code>IfExpr ::= "if"  "("  Expr  ")"  "then"  ExprSingle  "else"  ExprSingle
</code></pre>
<p>with:</p>
<pre><code>IfExpr ::= IfClause (( ThenClause? ElseCause ) | ReturnClause)
IfClause ::= "if"  "("  Expr  ")"
ThenClause ::= "then"  ExprSingle
ElseClause ::= "else"  ExprSingle
</code></pre>
<p><em>Design note:</em> There is a <code>ReturnClause</code> symbol that is defined as <code>"return"  ExprSingle</code>. Because of this, and to indicate that the <code>then</code> and <code>else</code> parts are not expressions, I've opted for the term clause. -- This matches the use in FLWORExpr, SwitchExpr, TypeswitchExpr, etc. that all use the term clause. I've also separated them out to make the <code>IfExpr</code> more readable now that it has optional parts.</p>
<h2>Semantics</h2>
<p>Replace:</p>
<blockquote>
<p>The expression following the if keyword is called the test expression, and the expressions following the then and else keywords are called the then-expression and else-expression, respectively.</p>
</blockquote>
<p>with:</p>
<blockquote>
<p>The expression between the parenthesis after the <code>if</code> keyword is called the <em>test expression</em>.</p>
<p>The expression after the <code>then</code> or <code>return</code> keyword is called the <em>then-expression</em>. If this is missing, it defaults to the empty sequence.</p>
<p>The expression after the <code>else</code> keyword is called the <em>else-expression</em>. If this is missing, it defaults to the empty sequence.</p>
</blockquote>
<p>Those should be the only required changes.</p>
</div></details></div>
<div class="toot" id="created-233"><h2>Issue #233 created<span class="toot-id"> #created-233</span></h2><div class="pubdate">08 Nov at 14:25:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/233">https://github.com/qt4cg/qtspecs/issues/233</a></div><details><summary>Declare the result type of a mode, via @as</summary><div class="markup"><p>Initial message to support discussion on the proposal for the introduction of <code>@as</code> in <code>&lt;xsl:mode&gt;</code> to define the output of a particular mode. Current: https://qt4cg.org/specifications/xslt-40/Overview-diff.html#mode-result-type</p>
</div></details></div>
<div class="toot" id="agenda-11-08"><h2>QT4 CG meeting 010 draft agenda<span class="toot-id"> #agenda-11-08</span></h2><div class="pubdate">07 Nov at 17:20:10 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/11-08">https://qt4cg.org/meeting/agenda/2022/11-08</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-232"><h2>Pull request #232 created<span class="toot-id"> #created-232</span></h2><div class="pubdate">05 Nov at 19:29:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/232">https://github.com/qt4cg/qtspecs/pull/232</a></div><details><summary>Issue 225 - Data model clarifications</summary><div class="markup"><p>This PR attempts to clean up some of the definitions of concepts in the data model spec, including fixing some minor errors.</p>
</div></details></div>
<div class="toot" id="created-231"><h2>Issue #231 created<span class="toot-id"> #created-231</span></h2><div class="pubdate">05 Nov at 18:42:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/231">https://github.com/qt4cg/qtspecs/issues/231</a></div><details><summary>for expression: "at" keyword</summary><div class="markup"><p>In a the <strong><em><a href="https://github.com/qt4cg/qtspecs/issues/181#issuecomment-1304604772">comment thread</a></em></strong> to #181 it was noticed that to be in line with that proposal, we also need to be able to access the index of any member variable within a <strong><em><a href="https://qt4cg.org/pr/230/xquery-40/xpath-40-autodiff.html#id-for-expressions">"for expression"</a></em></strong>.</p>
<p>This can be done in various ways, such as with an <strong><em><code>index()</code></em></strong> function, as in the code example below:</p>
<pre><code class="language-xq">for $x in (1,  3, 5, 7, 9, 11),
    $y in (1,  3, 5, 7, 9, 11)
 return
     if(index($x) le index($y)) then [$x, $y]
       else ()
</code></pre>
<p>But fortunately, in XQuery there is already the <strong><em><a href="https://qt4cg.org/pr/230/xquery-40/xpath-40-autodiff.html#id-for-expressions">"at"</a></em></strong> keyword serving exactly the same purpose. Thus the above expression can be written as:</p>
<pre><code class="language-xq">for $x at $ind-x in (1,  3, 5, 7, 9, 11),
    $y at $ind-y in (1,  3, 5, 7, 9, 11)
 return
     if($ind-x le $ind-y) then [$x, $y]
       else ()
</code></pre>
<p>Thus, I am proposing just to allow the <strong>"at"</strong> keyword in XPath <strong><em><a href="https://qt4cg.org/pr/230/xquery-40/xpath-40-autodiff.html#id-for-expressions">for-expressions</a></em></strong>.</p>
</div></details></div>
<div class="toot" id="created-230"><h2>Pull request #230 created<span class="toot-id"> #created-230</span></h2><div class="pubdate">03 Nov at 11:33:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/230">https://github.com/qt4cg/qtspecs/pull/230</a></div><details><summary>New proposed text resolving issue 71 (Guarded expressions)</summary><div class="markup"><p>The discussion on issue 71 was very wide-ranging and went off into a number of tangents. This PR attempts to resolve the issue initially raised (order of evaluation of predicates) in a general way by introducing the notion of guarded expressions. This also provides a proposed solution to the question of "short-cutting" and/or expressions - essentially, an optimiser can change the order of evaluation, but doing so must not introduce dynamic errors that would not occur in a short-cutted evaluation.</p>
</div></details></div>
<div class="toot" id="minutes-11-01"><h2>QT4 CG meeting 009 draft minutes<span class="toot-id"> #minutes-11-01</span></h2><div class="pubdate">01 Nov at 17:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/11-01">https://qt4cg.org/meeting/minutes/2022/11-01</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-214"><h2>Issue #214 closed<span class="toot-id"> #closed-214</span></h2><div class="pubdate">01 Nov at 15:20:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/214">https://github.com/qt4cg/qtspecs/issues/214</a></div><p>FLWOR without FL</p></div>
<div class="toot" id="created-229"><h2>Issue #229 created<span class="toot-id"> #created-229</span></h2><div class="pubdate">31 Oct at 19:02:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/229">https://github.com/qt4cg/qtspecs/issues/229</a></div><details><summary>Proposal: Add the missing functions for arrays: array:exists() and array:empty()</summary><div class="markup"><p>The functions over sequences: <code>fn:exists</code> and <code>fn:empty</code> are amongst the most useful and well-understood sequence functions.</p>
<p>In case we need to know whether or not an array has at least one member, or none, these function cannot help us:</p>
<p><img src="https://user-images.githubusercontent.com/10605892/199085022-c5466814-95e9-484e-8315-82159c8724dc.png" alt="image"></p>
<hr>
<p>To fill this gap, these two functions are proposed:</p>
<h3><strong><em><code>array:exists</code></em></strong>:</h3>
<p><strong>Signature</strong></p>
<pre><code class="language-xq">array:exists($arg as array(*)) as xs:boolean
</code></pre>
<p><strong>Properties</strong></p>
<p>This function is <a href="https://www.w3.org/TR/xpath-functions-31/#dt-deterministic">·deterministic·</a>, <a href="https://www.w3.org/TR/xpath-functions-31/#dt-context-independent">·context-independent·</a>, and <a href="https://www.w3.org/TR/xpath-functions-31/#dt-focus-independent">·focus-independent·</a>.</p>
<p><strong>Rules</strong></p>
<p>If the value of <code>$arg</code> is a non-empty array, the function returns <code>true()</code>; otherwise, the function returns <code>false()</code>.</p>
<p><strong>Examples</strong></p>
<p>The expression <code>array:exists(array:remove(["hello"], 1)</code> returns <code>false()</code>.</p>
<p>The expression <code>aray:exists(array:remove(["hello", "world"], 1)</code> returns <code>true()</code>.</p>
<p>The expression <code>aray:exists([])</code> returns <code>false()</code>.</p>
<p>The expression <code>aray:exists([ () ])</code> returns <code>true()</code>.</p>
<h3><strong><em><code>array:empty</code></em></strong>:</h3>
<p><strong>Signature</strong></p>
<pre><code class="language-xq">
array:empty($arg as array(*)) as xs:boolean
</code></pre>
<p><strong>Properties</strong></p>
<p>This function is <a href="https://www.w3.org/TR/xpath-functions-31/#dt-deterministic">·deterministic·</a>, <a href="https://www.w3.org/TR/xpath-functions-31/#dt-context-independent">·context-independent·</a>, and <a href="https://www.w3.org/TR/xpath-functions-31/#dt-focus-independent">·focus-independent·</a>.</p>
<p><strong>Rules</strong></p>
<p>If the value of <code>$arg</code> is the empty array, the function returns <code>true()</code>; otherwise, the function returns <code>false()</code>.</p>
<p><strong>Examples</strong></p>
<p>The expression <code>array:empty(array:remove(["hello"], 1)</code> returns <code>true()</code>.</p>
<p>The expression <code>aray:empty(array:remove(["hello", "world"], 1)</code> returns <code>false()</code>.</p>
<p>The expression <code>aray:empty([])</code> returns <code>true()</code>.</p>
<p>The expression <code>aray:empty([ () ])</code> returns <code>false()</code>.</p>
</div></details></div>
<div class="toot" id="created-228"><h2>Pull request #228 created<span class="toot-id"> #created-228</span></h2><div class="pubdate">31 Oct at 17:07:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/228">https://github.com/qt4cg/qtspecs/pull/228</a></div><details><summary>Updates to make FO valid</summary><div class="markup"><p>This PR doesn't (intentionally) make any substantive changes, it simply fixes the FO spec and the tools that build it so that they produce valid markup. We have accidentally been running without validation and an unpleasantly large number of errors have crept in.</p>
<p>I made some ad hoc changes to the DTDs (already committed to the<code>master branch</code>) where it seemed like it would be better to allow the new markup (<code>var</code> in <code>code</code>, <code>p</code> in <code>td</code>, etc.) than attempt to redraft the specification in some new way.</p>
<p>But that left a bunch of places where <code>p</code> or other wrappers were left out, a number of places where HTML markup instead of <code>xmlspec</code> was inserted, some broken links, etc.</p>
<p>Merging this into the repository while we have active PRs in flight for F&amp;O is going to be <em>ugly</em> so I'm not proposing to merge this right away.</p>
<p>We should probably pause new PRs against FO until this has been sorted out.</p>
</div></details></div>
<div class="toot" id="closed-227"><h2>Issue #227 closed<span class="toot-id"> #closed-227</span></h2><div class="pubdate">31 Oct at 16:22:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/227">https://github.com/qt4cg/qtspecs/pull/227</a></div><p>Add the Data Model specification; rename Serialization</p></div>
<div class="toot" id="created-227"><h2>Pull request #227 created<span class="toot-id"> #created-227</span></h2><div class="pubdate">31 Oct at 16:16:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/227">https://github.com/qt4cg/qtspecs/pull/227</a></div><details><summary>Add the Data Model specification; rename Serialization</summary><div class="markup"><ol>
<li>Added the Data Model specification</li>
<li>Renamed the Serialization specification from 3.1 to 4.0</li>
<li>Reworked the way the cross reference index files (the /etc/ directory) are handled. The 4.0 versions are now generated every time, and should not be committed to the repository. (I haven't removed the old ones yet because this PR build will fail if I do. They're coming out next.)</li>
</ol>
<p>I expect that the old ant build scripts will no longer work. I'm probably going to pull all that infrastructure out Real Soon Now™ as we've been working successfully with the new system.</p>
</div></details></div>
<div class="toot" id="closed-226"><h2>Issue #226 closed<span class="toot-id"> #closed-226</span></h2><div class="pubdate">31 Oct at 15:24:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/226">https://github.com/qt4cg/qtspecs/pull/226</a></div><p>Add the Data Model specification; rename Serialization</p></div>
<div class="toot" id="created-226"><h2>Pull request #226 created<span class="toot-id"> #created-226</span></h2><div class="pubdate">31 Oct at 15:13:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/226">https://github.com/qt4cg/qtspecs/pull/226</a></div><details><summary>Add the Data Model specification; rename Serialization</summary><div class="markup"><p><strong>ATTENTION</strong></p>
<p>There are a <em>whole</em> bunch of markup errors in the F&amp;O specification. The build system has not been validating it before publication 😞 😢 😭 . I have fixed them in this PR. I fixed the markup where it was clear how to do that. I hacked at the DTDs to allow some new markup patterns. It's kind of a mess and if you've got an open PR on the F&amp;O spec, I'm afraid it's going to be painful.</p>
<p>Aside from that horror show (hey, it's Halloween, maybe it's appropriate), I:</p>
<ol>
<li>Added the Data Model specification</li>
<li>Renamed the Serialization specification from 3.1 to 4.0</li>
<li>Reworked the way the cross reference index files (the <code>/etc/</code> directory) are handled. The 4.0 versions are now generated every time, and should not be committed to the repository.</li>
</ol>
<p>I expect that the old ant build scripts will no longer work. I'm probably going to pull all that infrastructure out Real Soon Now™ as we've been working successfully with the new system.</p>
</div></details></div>
<div class="toot" id="created-225"><h2>Issue #225 created<span class="toot-id"> #created-225</span></h2><div class="pubdate">30 Oct at 07:40:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/225">https://github.com/qt4cg/qtspecs/issues/225</a></div><details><summary>[XDM] Terminology around "Atomic value" and "Type Annotation"</summary><div class="markup"><p>In response to the comments (see https://github.com/qt4cg/qtspecs/pull/202) against issue 196, I propose that we tighten up the terminology associated with atomic values.</p>
<p>In XDM, §2.7.5 says:</p>
<blockquote>
<p>An atomic value can be constructed from a lexical representation. Given a string and an atomic type, the atomic value is constructed in such a way as to be [consistent with schema validation]. If the string does not represent a valid value of the type, an error is raised. When xs:untypedAtomic is specified as the type, no validation takes place. The details of the construction are described in [Section 18 Constructor functions ] and the related [Section 19 Casting ] section of [[XQuery and XPath Functions and Operators 3.1]].</p>
</blockquote>
<p>The actual definition of "atomic value" is found in 2.1 Terminology and reads:</p>
<blockquote>
<p>[Definition: An atomic value is a value in the value space of an [atomic type] and is labeled with the name of that atomic type.]</p>
</blockquote>
<p>(Oddly, this isn't linked from 2.7.5)</p>
<p>There's another little issue here, which is that an atomic value created by atomizing a schema-validated node may end up having an anonymous type, in which case its most specific type is inexpressible using XPath ItemType syntax. Is the type annotation in this case an atomic type, or is it the name of an atomic type. And should we avoid assuming that the concept of "item type" is something synonymous with the <code>ItemType</code> construct in the XPath grammar? As a start, I would prefer to say that the type annotation is a type, rather than a name.</p>
<p>In a non-normative note in §2.7, XDM also says:</p>
<blockquote>
<p>Values including element and attribute nodes, and atomic values, have a property called a type annotation whose value is a type: this is a reference to a type definition in the Schema Component Model.</p>
</blockquote>
<p>It goes on to say (normatively, but rather informally):</p>
<blockquote>
<p>Every [item] in the data model has both a value and a type. In addition to nodes, the data model can represent atomic values like the number 5 or the string “Hello World.” For each of these atomic values, the data model contains both the value of the item (such as 5 or “Hello World”) and its type. The property that holds the type is sometimes referred to as the type annotation: its value is a type definition component as defined in the Schema Component Model. This may be a built-in type (a type with a name such as xs:integer or xs:string), or a user-defined type.</p>
</blockquote>
<p>This statement is misleading in a number of ways. Firstly, some items such as empty maps and arrays conform to many types, but they do not have a single defining type that trumps all the others. Secondly, the way the term "type annotation" is introduced fails to make clear that the type annotation of a node is something quite different from the type annotation of an atomic value; if an element named N has a type annotation of <code>my:part-number</code>, then its (most specific) type is <code>element(N, my:part-number)</code>, while if an atomic value has a type annotation of <code>my:part-number</code>, then its most specific type is <code>my:part-number</code>. It also fails to make it clear that items like maps and arrays do not have a type annotation; their type is inferred from their content.</p>
<p>The fuzziness of some of these definitions makes it very difficult to be sufficiently formal elsewhere in the language. For example in 4.0 we're proposing to allow "down-casting" (or "relabelling") of atomic values in the coercion rules, and it's very hard to describe this operation formally without a better model.</p>
<p>I would like to start by changing the definition to</p>
<blockquote>
<p>An atomic item (also known as an atomic value) is a pair (T, D) where T (the "type annotation") is an atomic type, and D (the "datum") is a point in the value space of T.</p>
</blockquote>
<p>followed by references to atomic types and value spaces as concepts defined in XSD.</p>
<p>I don't expect we will want to use the term "datum" very often, but it's useful to have a name for the concept when we need it. We currently tend to call it the "value" which is very confusing, because if the (T, D) pair is a value, then D can't also be a value.</p>
</div></details></div>
<div class="toot" id="agenda-11-01"><h2>QT4 CG meeting 009 draft agenda<span class="toot-id"> #agenda-11-01</span></h2><div class="pubdate">28 Oct at 08:21:36 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/11-01">https://qt4cg.org/meeting/agenda/2022/11-01</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-224"><h2>Issue #224 created<span class="toot-id"> #created-224</span></h2><div class="pubdate">28 Oct at 09:01:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/224">https://github.com/qt4cg/qtspecs/issues/224</a></div><p>Infrastructure changes/improvements</p></div>
<div class="toot" id="closed-223"><h2>Issue #223 closed<span class="toot-id"> #closed-223</span></h2><div class="pubdate">27 Oct at 16:04:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/223">https://github.com/qt4cg/qtspecs/pull/223</a></div><p>Allow eg in fos:expression and fos:result</p></div>
<div class="toot" id="created-223"><h2>Pull request #223 created<span class="toot-id"> #created-223</span></h2><div class="pubdate">27 Oct at 15:59:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/223">https://github.com/qt4cg/qtspecs/pull/223</a></div><details><summary>Allow eg in fos:expression and fos:result</summary><div class="markup"><p>This PR formats <code>eg</code> in <code>fos:expression</code> and <code>fos:result</code> as a block. I don't think this will have any detrimental effects as it's done during the "merging" process.</p>
</div></details></div>
<div class="toot" id="closed-217"><h2>Issue #217 closed<span class="toot-id"> #closed-217</span></h2><div class="pubdate">26 Oct at 08:32:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/217">https://github.com/qt4cg/qtspecs/pull/217</a></div><p>Fix issue 41 (grammar bug in Typeswitch)</p></div>
<div class="toot" id="created-222"><h2>Pull request #222 created<span class="toot-id"> #created-222</span></h2><div class="pubdate">25 Oct at 21:56:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/222">https://github.com/qt4cg/qtspecs/pull/222</a></div><details><summary>Sequence comparison (starts, ends, contains) - issues 94, 96</summary><div class="markup"><p>Add 3 functions starts-with-sequence, ends-with-sequence, contains-sequence as per issues #96 and part of #94</p>
</div></details></div>
<div class="toot" id="created-221"><h2>Issue #221 created<span class="toot-id"> #created-221</span></h2><div class="pubdate">25 Oct at 20:35:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/221">https://github.com/qt4cg/qtspecs/issues/221</a></div><details><summary>Expose op:same-key() as a user-visible function</summary><div class="markup"><p>In issues #94, #96, and #99 a set of functions for comparing sequences are proposed; all of them are parameterized with a function for comparing items.</p>
<p>A useful function for comparing items is op:same-key() (useful because it is error-free, context-free, and transitive). For this and other reason, it would be useful to expose op:same-key() as a user-visible function.</p>
<p>The only tricky question is what to call it. I suggest "atomic-equal".</p>
<p>Alternatively, we could overload the "is" operator to compare atomic values using <code>op:same-key()</code>, and use op("is") as the argument to the sequence comparison functions.</p>
</div></details></div>
<div class="toot" id="minutes-10-25"><h2>QT4 CG meeting 008 draft minutes<span class="toot-id"> #minutes-10-25</span></h2><div class="pubdate">25 Oct at 16:47:40 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/10-25">https://qt4cg.org/meeting/minutes/2022/10-25</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-219"><h2>Issue #219 closed<span class="toot-id"> #closed-219</span></h2><div class="pubdate">25 Oct at 11:45:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/219">https://github.com/qt4cg/qtspecs/issues/219</a></div><p>Options on fn:deep-equal</p></div>
<div class="toot" id="created-220"><h2>Issue #220 created<span class="toot-id"> #created-220</span></h2><div class="pubdate">25 Oct at 09:09:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/220">https://github.com/qt4cg/qtspecs/issues/220</a></div><details><summary>Encapsulation</summary><div class="markup"><p>Let's suppose that I want to provide a library to do complex number arithmetic, and I want to hide how complex numbers are actually implemented (it could be an array of two doubles, or a map containing two doubles, it could be in polar coordinates, etc).</p>
<p>How might I go about doing this? One approach is like this (please be patient):</p>
<pre><code>module namespace complex...;

declare %public type alias complex:number as function(*);

declare %private variable SECRET := &lt;e/&gt;;

declare $private function complex:wrap($content as record(re as xs:double, im as xs:double)) as complex:number {
    function($key as node()) {if ($key is $SECRET then $content else error());
};

declare $private function complex:unwrap($cx as complex:number) as record(re as xs:double, im as xs:double) {
   $cx($SECRET);
};

declare %public function complex:new($re as xs:double, $im as xs:double) as complex:number {
  complex:wrap(map{'re':$re, 'im':$im})
}

declare %public function complex:real($x as complex:number) as xs:double {
  complex:unwrap($x)?re
}

declare %public function complex:add($x as complex:number, $y as complex:number) {
  etc;
}

</code></pre>
<p>What's going on here? We're representing a complex number as an arity-1 function; the function "unlocks" the complex number to reveal its internal implementation, but it can only be called if you know the secret argument to pass, and this is encapsulated within the library module that implements the functionality. So we've successfully encapsulated the implementation, and we've done it without any data model changes. Within the provider module, the functions wrap() and unwrap() are available to convert from the internal representation to the external representation; these functions are not available to the caller.</p>
<p>It works, but it's hardly elegant.</p>
<p>From the point of view of the user of the library, it's quite usable: they just import the library and call the functions. They probably don't care that the type complex:number is actually a function, and if they do care, there's not much they can do with the knowledge.</p>
<p>From the point of view of the author of the library, there's a lot of boilerplate. One thing we could do to improve matters would be to provide some syntactic sugar. Instead of a module declaration, use a class declaration:</p>
<pre><code>class complex:number wraps record(re as xs:double, im as xs:double);

declare %public function complex:real($x as complex:number) as xs:double {
  complex:unwrap($x)?re
}

declare %public function complex:add($x as complex:number, $y as complex:number) {
  etc;
}
</code></pre>
<p>The boilerplate, especially the wrap and unwrap functions, is now implicitly declared.</p>
<p>And we could provide "import class" for the caller as an alternative to "import module".</p>
<p>We could go further and give the magic function used to represent an encapsulated value some kind of special status in the data model. But do we need to?</p>
</div></details></div>
<div class="toot" id="created-219"><h2>Issue #219 created<span class="toot-id"> #created-219</span></h2><div class="pubdate">24 Oct at 14:11:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/219">https://github.com/qt4cg/qtspecs/issues/219</a></div><details><summary>Options on fn:deep-equal</summary><div class="markup"><p>The function <code>fn:deep-equal</code> makes some arbitrary decisions about how values are compared, and many applications need slightly different comparison semantics. This issue proposes adding an options parameter to customise the comparison rules.</p>
<p>The following options are proposed (detailed syntax TBA):</p>
<ul>
<li>For comparing atomic values, use op:same-key rather than eq. Note this implies ignoring the collation.</li>
<li>When comparing children of a node, don't ignore comments</li>
<li>When comparing children of a node, don't ignore processing instructions</li>
<li>When comparing children of an element, ignore whitespace text nodes (except where the element node has a simple type)</li>
<li>When ignoring comments and processing instructions, merge adjacent text nodes</li>
<li>When comparing strings (etc), perform Unicode normalization</li>
<li>When comparing strings (etc), perform whitespace normalization</li>
<li>Compare as if untyped (ignore type annotations and typed value)</li>
<li>Compare as typed (type annotation must match)</li>
<li>Require the same in-scope namespace bindings on every element</li>
<li>Require elements and attributes to have matching prefixes</li>
<li>Compare the is-ID and is-IDREF properties on elements and attributes</li>
</ul>
</div></details></div>
<div class="toot" id="agenda-10-25"><h2>QT4 CG meeting 008 draft agenda<span class="toot-id"> #agenda-10-25</span></h2><div class="pubdate">22 Oct at 09:49:46 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/10-25">https://qt4cg.org/meeting/agenda/2022/10-25</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-218"><h2>Issue #218 created<span class="toot-id"> #created-218</span></h2><div class="pubdate">19 Oct at 09:11:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/218">https://github.com/qt4cg/qtspecs/issues/218</a></div><details><summary>Function library for maps with composite keys: and thoughts on encapsulation</summary><div class="markup"><p>I propose creating a function library that handles maps with composite keys. I'll start by defining a set of functions, then we'll consider how to package these, in particular issues of encapsulation and types. Even it we don't want to implement this particular feature, it might help to generate infrastructure that makes it easier to create such function libraries.</p>
<p>For the sake of a name, I'll call the data structure we are manipulating an <strong>atlas</strong>. (Like a map, but generalized.) An atlas is a mapping from sequences of atomic values to values. Two sequences of atomic values are equal if they are the same length and their constituent atoms are pairwise equal according to op:same-key(). Note that keys are variable length and it's permitted to have both ("a") and ("a, b") as entries in the atlas.</p>
<p>We'll start by defining the API we want to offer. The semantics for these functions are essentially the same as the corresponding functions for maps. The type of $key is always xs:anyAtomicType*. We'll discuss the type of $atlas later.</p>
<ul>
<li>
<p>atlas:build($input, $keyFunction, $valueFunction, $onDuplicates) =&gt; atlas</p>
</li>
<li>
<p>atlas:get($atlas, $key) =&gt; value</p>
</li>
<li>
<p>atlas:contains($atlas, $key) =&gt; value</p>
</li>
<li>
<p>atlas:put($atlas, $key, $value) =&gt; atlas</p>
</li>
<li>
<p>atlas:keys($atlas) =&gt; array(key)</p>
</li>
<li>
<p>atlas:for-each($atlas, function(key, value)) =&gt; value</p>
</li>
<li>
<p>atlas:size($atlas) =&gt; integer</p>
</li>
</ul>
<p>plus some more specific functions:</p>
<ul>
<li>atlas:get-branch($atlas, $partial-key) =&gt; atlas</li>
</ul>
<p>returns an atlas containing all those entries in the supplied atlas whose keys start with the supplied partial-key; the returned atlas contains the remaining parts of the keys.</p>
<ul>
<li>atlas:put-branch($atlas, $partial-key, $atlas branch) =&gt; atlas</li>
</ul>
<p>Similarly, grafts one atlas as a subtree into another.</p>
<p>It's not too hard to come up with an implementation of this API that uses nested maps. For example: An atlas-node is a map from atomic-values to <code>record(leaf? as value, branch? as atlas-node)</code>, where leaf contains the value if the atlas contains the relevant key in full, while branch contains a nested atlas if the atlas contains nodes starting with the relevant prefix; either or both may be present.</p>
<p>Now the tricky part: how to handle encapsulation. There are two parts to this: (a) defining a type that can be used to represent an "atlas" in the API, and (b) preventing users subverting the API by accessing the implementation objects (atlas-nodes) directly.</p>
<p>There are features we can build on: the proposal for named item type aliases, and the sketchy definition of "external objects" in XSLT.</p>
<p>We could handle the first part by allowing the declaration of a named item type (or alias) to specify something like visibility=closed. So the function library comes with an item type whose name is atlas:atlas, and this type name is available for use by anyone who imports the function library, but they never get to know exactly what an atlas:atlas is other than the fact that it's an item, so they can never know what other functions they might be able to call on it.</p>
<p>But that doesn't stop them guessing (or asking, using <code>if ($atlas instance of map(*)</code> interrogatives).</p>
<p>To deal with that, we could consider expanding the existing half-defined concept of an "external object". XSLT 3.0 §24.1.3 sketches out the idea:</p>
<blockquote>
<p>An implementation may allow an extension function to return an object that does not have any natural representation in the XDM data model, whether as an atomic value, a node, or a function item. For example, an extension function sql:connect might return an object that represents a connection to a relational database; the resulting connection object might be passed as an argument to calls on other extension functions such as sql:insert and sql:select.</p>
<p>The way in which such objects are represented in the type system is <a href="https://www.w3.org/TR/xslt-30/#dt-implementation-defined">implementation-defined</a>. They might be represented by a completely new datatype, or they might be mapped to existing datatypes such as integer, string, or anyURI.</p>
</blockquote>
<p>So <code>atlas</code> could be an external object type. The module that implements the function library could contain private methods that wrap a map as an atlas, or that unwrap an atlas to reveal the underlying map. I think the only additional support needed is a construct to wrap a value as an encapsulated object of a given type, and to unwrap an encapsulated object to return the original value.</p>
<p>Note: I can imagine the same mechanism being useful to handle "parcels", and no doubt we will find many other applications for it.</p>
</div></details></div>
<div class="toot" id="created-217"><h2>Pull request #217 created<span class="toot-id"> #created-217</span></h2><div class="pubdate">19 Oct at 00:00:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/217">https://github.com/qt4cg/qtspecs/pull/217</a></div><details><summary>Fix issue 41 (grammar bug in Typeswitch)</summary><div class="markup"><p>Fixes the broken typeswitch grammar pointed out in issue #41</p>
</div></details></div>
<div class="toot" id="closed-83"><h2>Issue #83 closed<span class="toot-id"> #closed-83</span></h2><div class="pubdate">18 Oct at 23:35:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/83">https://github.com/qt4cg/qtspecs/issues/83</a></div><p>[XPath]Proposal: Notation for using an operator as a function</p></div>
<div class="toot" id="minutes-10-18"><h2>QT4 CG meeting 007 draft minutes<span class="toot-id"> #minutes-10-18</span></h2><div class="pubdate">18 Oct at 17:01:35 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/10-18">https://qt4cg.org/meeting/minutes/2022/10-18</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-206"><h2>Issue #206 closed<span class="toot-id"> #closed-206</span></h2><div class="pubdate">18 Oct at 17:10:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/206">https://github.com/qt4cg/qtspecs/pull/206</a></div><p>Corrections to math:atan2 identified in issue 5.</p></div>
<div class="toot" id="closed-151"><h2>Issue #151 closed<span class="toot-id"> #closed-151</span></h2><div class="pubdate">18 Oct at 17:09:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/151">https://github.com/qt4cg/qtspecs/issues/151</a></div><p>map:build() function</p></div>
<div class="toot" id="closed-203"><h2>Issue #203 closed<span class="toot-id"> #closed-203</span></h2><div class="pubdate">18 Oct at 17:09:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/203">https://github.com/qt4cg/qtspecs/pull/203</a></div><p>Issue 151: map:build</p></div>
<div class="toot" id="closed-200"><h2>Issue #200 closed<span class="toot-id"> #closed-200</span></h2><div class="pubdate">18 Oct at 17:06:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/200">https://github.com/qt4cg/qtspecs/pull/200</a></div><p>NW for MK: Drop xsl:match instruction (185)</p></div>
<div class="toot" id="closed-185"><h2>Issue #185 closed<span class="toot-id"> #closed-185</span></h2><div class="pubdate">18 Oct at 16:04:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/185">https://github.com/qt4cg/qtspecs/pull/185</a></div><p>Issue118 drop xsl match</p></div>
<div class="toot" id="closed-165"><h2>Issue #165 closed<span class="toot-id"> #closed-165</span></h2><div class="pubdate">18 Oct at 15:26:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/165">https://github.com/qt4cg/qtspecs/issues/165</a></div><p>Keyword arguments: ":=" or ":"?</p></div>
<div class="toot" id="closed-212"><h2>Issue #212 closed<span class="toot-id"> #closed-212</span></h2><div class="pubdate">18 Oct at 10:52:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/212">https://github.com/qt4cg/qtspecs/issues/212</a></div><p>Loss of OS-specific line breaks</p></div>
<div class="toot" id="created-216"><h2>Issue #216 created<span class="toot-id"> #created-216</span></h2><div class="pubdate">18 Oct at 10:48:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/216">https://github.com/qt4cg/qtspecs/issues/216</a></div><details><summary>fn:unparsed-text: End-of-line characters</summary><div class="markup"><p><strong>UPDATED PROPOSAL (2023-10-31):</strong></p>
<p>Change the default behavior and normalize the input as known from XML (https://www.w3.org/TR/xml/#sec-line-ends). Even though backward-incompatible, the change should be noninvasive enough, and it allows us to dispense with adding options to this and other functions.</p>
<hr>
<p><strong>ORIGINAL PROPOSAL:</strong></p>
<h3>Motivation</h3>
<p><code>fn:unparsed-text</code> can only be used if the input is valid. Next, the result may contain OS-specific newlines that may need to be normalized in a subsequent step. Two additional parameters might simplify things:</p>
<ul>
<li><code>normalize</code>: normalizes line endings in the input, as done by <code>fn:doc</code>, <code>fn:parse-xml</code> and <code>fn:parse-xml-fragments</code> and as defined in https://www.w3.org/TR/xml/#sec-line-ends (inspired by the discussion in #212).</li>
<li><code>fallback</code>: Process characters that are not valid in the version of XML supported by the implementation (inspired by <code>fn:parse-json</code>)</li>
</ul>
<h3>Signature</h3>
<pre><code class="language-xquery">fn:unparsed-text(
  $href    as xs:string?,
  $options as&nbsp;map(*)
) as xs:string?
</code></pre>
<h3>Rules</h3>
<p>The entries that may appear in the <code>$options</code> map are as follows:</p>
<p>Key | Meaning
-- | --
<code>encoding</code> | The name of an encoding … (see existing rules)
<code>normalize-newlines</code> |  <code>false</code> by default. If set to <code>true</code>, two-character sequences <code>#xD#xA</code> and any <code>#xD</code> that are not followed by <code>#xA</code> are translated to single <code>#xA</code> characters.
<code>fallback</code> | A function which is called when the input contains an escape sequence that represents a character that is not valid […] (see <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview-diff.html#func-parse-json"><code>fn:parse-json</code></a>).</p>
</div></details></div>
<div class="toot" id="created-215"><h2>Pull request #215 created<span class="toot-id"> #created-215</span></h2><div class="pubdate">17 Oct at 16:00:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/215">https://github.com/qt4cg/qtspecs/pull/215</a></div><details><summary>First attempt at parse-uri and build-uri functions</summary><div class="markup"><p>Close #72</p>
<p>This is a first attempt to resolve issue 72 by describing <code>parse-uri</code> and <code>build-uri</code> functions.</p>
<p>I decided to try an approach that leverages the ABNF defined in RFC 3986. Attempting to redefine the rules just opens up the possibility that the rules we write will differ from the rules in RFC 3986 which would be wrong.</p>
<p>I added an options map and specified a "details" option that will further parse the path and query components. This gives the caller easy access to the percent-decoded forms of those elements without making the parse function irreversable.</p>
<p>Notes:</p>
<ol>
<li>More examples are needed</li>
<li>I tried to use <code>eg</code> in the results so that they'd be formatted nicely, but it didn't work. Is there any markup for verbatim text in examples?</li>
<li>There's an open question about whether non-hierarchical URIs can have fragment identifiers or queries. I think not, but I need to review the RFC a little more carefully.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-50"><h2>Issue #50 closed<span class="toot-id"> #closed-50</span></h2><div class="pubdate">17 Oct at 09:20:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/50">https://github.com/qt4cg/qtspecs/issues/50</a></div><p>[XPath] Introduce the lookup operator for sequences</p></div>
<div class="toot" id="created-214"><h2>Issue #214 created<span class="toot-id"> #created-214</span></h2><div class="pubdate">16 Oct at 19:48:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/214">https://github.com/qt4cg/qtspecs/issues/214</a></div><details><summary>FLWOR without FL</summary><div class="markup"><p>Resulting from thoughts in https://github.com/qt4cg/qtspecs/pull/210: Do we want to make <code>let</code> and <code>for</code> optional?</p>
<p>From the query optimization perspective, this seems reasonable as especially <code>let</code> clauses may become obsolete after inlining variables.</p>
<p>From a user point of view, I’m not convinced that the resulting syntax would be intuitive:</p>
<pre><code class="language-xquery">return 123
</code></pre>
<p>…could indicate that the <code>return</code> keyword has some special meaning, or people might be confused that/why it's equivalent to <code>123</code>, or night start using the keyword esp. in function bodies.</p>
<pre><code class="language-xquery">where test()
return 'ok'
</code></pre>
<p>…could be used as alternative for an <code>if</code> expression with any empty <code>else</code> branch; but people might be confused why <code>if</code> cannot be used without <code>else</code>.</p>
<p>What do others think?</p>
</div></details></div>
<div class="toot" id="created-213"><h2>Issue #213 created<span class="toot-id"> #created-213</span></h2><div class="pubdate">16 Oct at 18:50:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/213">https://github.com/qt4cg/qtspecs/issues/213</a></div><details><summary>Lookup/Indexing operator for sequences (supersedes #50)</summary><div class="markup"><p>This proposal attempts to take over where issue #50 left off: that issue contains a lengthy discussion and many alternative suggestions, and seemed to end with a concrete proposal which I summarise here. I propose that issue #50 now be closed.</p>
<p>The proposal is for an expression which I will call a subscript-expression, taking the form</p>
<p><code>SubscriptExpression ::= ExprSingle "[#" Expr "]"</code></p>
<p>The first operand evaluates to an arbitrary sequence. The second operand evaluates to a sequence of integers (or is coerced to a sequence of integers using the coercion rules). Both operands are evaluated in the context of the containing expression (despite the similarity to filter expressions, the predicate does not have its own focus).</p>
<p>The result of the expression <code>A [# B]</code> (assuming B is indeed a sequence of integers) is <code>for $i in B return A[$i]</code>.</p>
<p><strong>Examples</strong></p>
<p><code>$input[#1]</code> - this is synonymous with <code>$input[1]</code></p>
<p><code>$input[#1 to 5]</code> - equivalent to <code>$input[position() = (1 to 5)]</code></p>
<p><code>$input[#reverse(1 to 5)]</code> - returns the first 5 items in reverse order</p>
<p><strong>The main differences from the existing A[B] syntax are:</strong></p>
<p>(a) there is no overloading, the semantics do not depend on the dynamic type of B.</p>
<p>(b) the value of the predicate can be a sequence of integers, not just a single integer</p>
<p>(c) the focus for the predicate is the same as the outer focus, so expressions such as <code>*[#1 to count(*) idiv 2]</code> make sense.</p>
<p>Alternative 1: use the syntax <code>A #[ B ]</code>.</p>
<p>Alternative 2: use a function <code>items-at(A, B)</code></p>
</div></details></div>
<div class="toot" id="created-212"><h2>Issue #212 created<span class="toot-id"> #created-212</span></h2><div class="pubdate">16 Oct at 18:25:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/212">https://github.com/qt4cg/qtspecs/issues/212</a></div><details><summary>Loss of OS-specific line breaks</summary><div class="markup"><p>When an XML document is parsed, <code>CR</code> is discarded and replaced by <code>LF</code>. The serialized result won’t have <code>CR</code> either:</p>
<pre><code class="language-xquery">let $CR := '&amp;#xd;', $LF := '&amp;#xa;'
let $input := '&lt;a&gt;' || $CR || '&lt;/a&gt;'
let $xml := parse-xml($input)
let $output := serialize($xml)
return (
  contains($xml, $CR), contains($output, $CR),
  contains($xml, $LF), contains($output, $LF)
)
</code></pre>
<p>This is no proposal, but something we should keep in mind when discussing #101 and #121: Do we want to pursue and motivate an asymmetric approach by focusing on the processed and output data (i.e. insertion of <code>CR</code> characters in strings; new serialization parameter for custom newline strings), or should we rather strive for a solultion that also takes care of the input/import? Which could be:</p>
<ol>
<li>Provide newline parameters for <code>fn:parse-xml</code>, <code>fn:doc</code>, <code>fn:collection</code>, possibly others; or</li>
<li>Use OS-specific newline strings</li>
</ol>
<p>Interestingly, <code>CR</code> is preserved if <code>fn:unparsed-text</code> is used.</p>
</div></details></div>
<div class="toot" id="agenda-10-18"><h2>QT4 CG meeting 007 draft agenda<span class="toot-id"> #agenda-10-18</span></h2><div class="pubdate">14 Oct at 16:44:32 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/10-18">https://qt4cg.org/meeting/agenda/2022/10-18</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-209"><h2>Issue #209 closed<span class="toot-id"> #closed-209</span></h2><div class="pubdate">14 Oct at 16:29:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/209">https://github.com/qt4cg/qtspecs/pull/209</a></div><p>Modify test generator to reference a real source file</p></div>
<div class="toot" id="created-211"><h2>Issue #211 created<span class="toot-id"> #created-211</span></h2><div class="pubdate">14 Oct at 10:20:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/211">https://github.com/qt4cg/qtspecs/issues/211</a></div><details><summary>XSLT streaming: capturing accumulators</summary><div class="markup"><p>A Saxon extension to XSLT streaming that has proved very convenient is the notion of a capturing accumulator, indicated by setting xsl:accumulator/@capture = yes.</p>
<p>From the Saxon documentation:</p>
<blockquote>
<p>This attribute may be set on an xsl:accumulator-rule element. It has no effect unless the accumulator is declared streamable and the rule has phase="end". It is intended for use when the accumulator rule matches an element node. The value is a boolean with the default "no".</p>
<p>The effect of setting this attribute is that the code for computing the new accumulator value when the element end tag is encountered now has access to a snapshot copy of the matched element (as if taken using the fn:snapshot function), and is no longer required to be motionless.</p>
<p>This means that if you want access to the typed value or string value of an element, you can now get this directly with a rule that matches the element, rather than having to write rules that match the element's text node children.</p>
<p>It also opens up additional possibilities. For example:</p>
<p>If a large document has a short header section containing metadata, you can capture a copy of the header in an accumulator, and the header then becomes available throughout the rest of the document processing using the accumulator-after() function.
If you want to produce a sorted index of terms that are marked up using glossary elements scattered throughout the document, you can define an accumulator that retains snapshot copies of all the glossary entries (use select="($value, .)" in the accumulator rule). At the end of processing, you can sort and group these glossary entries, and because they are snapshot copies retaining all the attributes of ancestors, you can link them to the id anchors of the containing sections.
Note: the snapshot captured as a result of the use of saxon:capture differs from the result of the fn:snapshot() function in that accumulator values associated with the copied nodes are not retained in the snapshot.</p>
</blockquote>
<p>We could consider making this the default, since its effect is essentially to remove an unnecessary restriction.</p>
</div></details></div>
<div class="toot" id="created-210"><h2>Pull request #210 created<span class="toot-id"> #created-210</span></h2><div class="pubdate">13 Oct at 11:42:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/210">https://github.com/qt4cg/qtspecs/pull/210</a></div><p>Issue 80: fn:iterate-while (before: fn:while)</p></div>
<div class="toot" id="created-209"><h2>Pull request #209 created<span class="toot-id"> #created-209</span></h2><div class="pubdate">13 Oct at 11:28:41 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/209">https://github.com/qt4cg/qtspecs/pull/209</a></div><details><summary>Modify test generator to reference a real source file</summary><div class="markup"><p>Modify the generated test set to use a real source file. The source/content construct for inline documents works in the XSLT test suite but not in QT4.</p>
</div></details></div>
<div class="toot" id="closed-208"><h2>Issue #208 closed<span class="toot-id"> #closed-208</span></h2><div class="pubdate">13 Oct at 09:41:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/208">https://github.com/qt4cg/qtspecs/pull/208</a></div><p>Fix the function finder</p></div>
<div class="toot" id="created-208"><h2>Pull request #208 created<span class="toot-id"> #created-208</span></h2><div class="pubdate">13 Oct at 09:35:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/208">https://github.com/qt4cg/qtspecs/pull/208</a></div><details><summary>Fix the function finder</summary><div class="markup"><p>Per MK's request. :-)</p>
<p>I also fixed the thing where the function names are too long and there was no space between the select elements!</p>
</div></details></div>
<div class="toot" id="created-207"><h2>Pull request #207 created<span class="toot-id"> #created-207</span></h2><div class="pubdate">12 Oct at 23:22:54 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/207">https://github.com/qt4cg/qtspecs/pull/207</a></div><p>Issue 1. New expanded-QName function; new fn:QName#1 variant</p></div>
<div class="toot" id="created-206"><h2>Pull request #206 created<span class="toot-id"> #created-206</span></h2><div class="pubdate">12 Oct at 22:04:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/206">https://github.com/qt4cg/qtspecs/pull/206</a></div><p>Corrections to math:atan2 identified in issue 5.</p></div>
<div class="toot" id="created-205"><h2>Issue #205 created<span class="toot-id"> #created-205</span></h2><div class="pubdate">12 Oct at 12:15:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/205">https://github.com/qt4cg/qtspecs/issues/205</a></div><details><summary>Make higher-order-function support mandatory</summary><div class="markup"><p>I think higher-order-functions are becoming a core part of XQuery and XSLT; we shouldn't encourage the mindset that they should be avoided because not all implementations will support them. I therefore propose dropping this as an optional feature; the relevant capabilities should become a core part of the language in 4.0, supported by all conformant implementations.</p>
</div></details></div>
<div class="toot" id="closed-126"><h2>Issue #126 closed<span class="toot-id"> #closed-126</span></h2><div class="pubdate">12 Oct at 10:33:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/126">https://github.com/qt4cg/qtspecs/issues/126</a></div><p>Mathematical Operator Unicode Symbols</p></div>
<div class="toot" id="created-204"><h2>Issue #204 created<span class="toot-id"> #created-204</span></h2><div class="pubdate">12 Oct at 10:07:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/204">https://github.com/qt4cg/qtspecs/issues/204</a></div><details><summary>Non-ascii alternative operator symbols</summary><div class="markup"><p>Appendix B.3 of the draft specification proposes that we provide non-ASCII synonyms for many of the operator symbols:</p>
<p>Operator | Symbol | Codepoint
-- | -- | --
and | ∧ | x2227
or | ∨ | x2228
eq | ≐ | x2250
ne | ≠ | x2260
lt | ⋖ | x22D6
gt | ⋗ | x22D7
le | ≤ | x2264
ge | ≥ | x2265
div | ÷ | xF7
mod | &nbsp; | &nbsp;
idiv | ⨸ | x2A38
union (|) | ∪ | x222A
intersect | ∩ | x2229
except | ∖ | x2216
is | ≡ | x2261
&lt;&lt; (precedes) | ≪ | x226A
&nbsp;&gt;&gt; (follows) | ≫ | x226B
otherwise | ⊩ | x22A9
some | ∃ | x2203
every | ∀ | x2200
satisfies | ⧴ | x29F4</p>
<p>This issue is raised to enable discussion of this proposal.</p>
<p>I have to confess I'm going rather cool on the idea. Some of the proposed symbols are rather obscure, and they aren't always rendered very clearly on display; some can easily be confused with other symbols. It's going to take a lot of WG time to agree the details, and it will probably cause more usability problems than it solves.</p>
<p>I've always felt that it was high time for programming to break loose from ASCII, but there are probably good reasons it hasn't done so.</p>
<p>The fact that we have two sets of comparison operators (and that some of the symbols clash with XML reserved characters) doesn't help. Providing alternative ways of writing them can only add to the confusion.</p>
<p>I'm going to propose dropping this unless someone else wants to champion it.</p>
</div></details></div>
<div class="toot" id="created-203"><h2>Pull request #203 created<span class="toot-id"> #created-203</span></h2><div class="pubdate">12 Oct at 06:30:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/203">https://github.com/qt4cg/qtspecs/pull/203</a></div><details><summary>Issue 151: map:build</summary><div class="markup"><p>Drops the proposed map:group-by function, replacing it with the more powerful map:build.</p>
</div></details></div>
<div class="toot" id="minutes-10-11"><h2>QT4 CG meeting 006 draft minutes<span class="toot-id"> #minutes-10-11</span></h2><div class="pubdate">11 Oct at 16:47:33 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/10-11">https://qt4cg.org/meeting/minutes/2022/10-11</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-173"><h2>Issue #173 closed<span class="toot-id"> #closed-173</span></h2><div class="pubdate">11 Oct at 16:56:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/173">https://github.com/qt4cg/qtspecs/pull/173</a></div><p>Add specification for fn:op() (issue #83)</p></div>
<div class="toot" id="closed-188"><h2>Issue #188 closed<span class="toot-id"> #closed-188</span></h2><div class="pubdate">11 Oct at 16:56:00 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/188">https://github.com/qt4cg/qtspecs/pull/188</a></div><p>Editorial</p></div>
<div class="toot" id="closed-198"><h2>Issue #198 closed<span class="toot-id"> #closed-198</span></h2><div class="pubdate">11 Oct at 16:40:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/198">https://github.com/qt4cg/qtspecs/pull/198</a></div><p>NW for MK: fn:op (173)</p></div>
<div class="toot" id="closed-201"><h2>Issue #201 closed<span class="toot-id"> #closed-201</span></h2><div class="pubdate">11 Oct at 16:31:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/201">https://github.com/qt4cg/qtspecs/pull/201</a></div><p>NW for MK: editorial (188)</p></div>
<div class="toot" id="created-202"><h2>Pull request #202 created<span class="toot-id"> #created-202</span></h2><div class="pubdate">10 Oct at 09:11:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/202">https://github.com/qt4cg/qtspecs/pull/202</a></div><details><summary>NW for MK: subtyping (196)</summary><div class="markup"><p>MK: improve pres of XPath §3.7 (subtyping) and clarify notion of dynamic type</p>
<p>This PR is intended to be technically equivalent to #196.</p>
<p>I've reworked a series of MK commits so that they are independent; I fear we would wind up with merge conflicts otherwise and cleaning up the merge conflicts, without accidentally making some other change, seemed riskier than just teasing them apart and making them independent before we accept and merge them.</p>
</div></details></div>
<div class="toot" id="created-201"><h2>Pull request #201 created<span class="toot-id"> #created-201</span></h2><div class="pubdate">10 Oct at 09:09:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/201">https://github.com/qt4cg/qtspecs/pull/201</a></div><details><summary>NW for MK: editorial (188)</summary><div class="markup"><p>This PR is intended to be technically equivalent to #188.</p>
<p>I've reworked a series of MK commits so that they are independent; I fear we would wind up with merge conflicts otherwise and cleaning up the merge conflicts, without accidentally making some other change, seemed riskier than just teasing them apart and making them independent before we accept and merge them.</p>
</div></details></div>
<div class="toot" id="created-200"><h2>Pull request #200 created<span class="toot-id"> #created-200</span></h2><div class="pubdate">10 Oct at 09:08:40 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/200">https://github.com/qt4cg/qtspecs/pull/200</a></div><details><summary>NW for MK: Drop xsl:match instruction (185)</summary><div class="markup"><p>This PR is intended to be technically equivalent to #185.</p>
<p>I've reworked a series of MK commits so that they are independent; I fear we would wind up with merge conflicts otherwise and cleaning up the merge conflicts, without accidentally making some other change, seemed riskier than just teasing them apart and making them independent before we accept and merge them.</p>
<p>Close #119</p>
</div></details></div>
<div class="toot" id="created-199"><h2>Pull request #199 created<span class="toot-id"> #created-199</span></h2><div class="pubdate">10 Oct at 09:07:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/199">https://github.com/qt4cg/qtspecs/pull/199</a></div><details><summary>NW for MK: Items before, etc. (177)</summary><div class="markup"><p>This PR is intended to be technically equivalent to #177.</p>
<p>I've reworked a series of MK commits so that they are independent; I fear we would wind up with merge conflicts otherwise and cleaning up the merge conflicts, without accidentally making some other change, seemed riskier than just teasing them apart and making them independent before we accept and merge them.</p>
</div></details></div>
<div class="toot" id="created-198"><h2>Pull request #198 created<span class="toot-id"> #created-198</span></h2><div class="pubdate">10 Oct at 09:05:55 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/198">https://github.com/qt4cg/qtspecs/pull/198</a></div><details><summary>NW for MK: fn:op (173)</summary><div class="markup"><p>This PR is intended to be technically equivalent to #173.</p>
<p>I've reworked a series of MK commits so that they are independent; I fear we would wind up with merge conflicts otherwise and cleaning up the merge conflicts, without accidentally making some other change, seemed riskier than just teasing them apart and making them independent before we accept and merge them.</p>
</div></details></div>
<div class="toot" id="created-197"><h2>Pull request #197 created<span class="toot-id"> #created-197</span></h2><div class="pubdate">10 Oct at 08:55:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/197">https://github.com/qt4cg/qtspecs/pull/197</a></div><details><summary>NW for MK: Variadicity (166)</summary><div class="markup"><p>This PR is intended to be technically equivalent to #166.</p>
<p>I've reworked a series of MK commits so that they are independent; I fear we would wind up with merge conflicts otherwise and cleaning up the merge conflicts, without accidentally making some other change, seemed riskier than just teasing them apart and making them independent before we accept and merge them.</p>
</div></details></div>
<div class="toot" id="created-196"><h2>Pull request #196 created<span class="toot-id"> #created-196</span></h2><div class="pubdate">09 Oct at 19:08:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/196">https://github.com/qt4cg/qtspecs/pull/196</a></div><details><summary>Subtyping</summary><div class="markup"><p>Editorial. Improve the presentation of XPath section §3.7 on subtype relationships, including supplying some rules that were previously marked TODO. To enable this, migrate some DTD and stylesheet extensions for <code>var</code> elements previously used for the xslt spec only. Add some clarifications concerning dynamic type, see issue #191</p>
</div></details></div>
<div class="toot" id="closed-195"><h2>Issue #195 closed<span class="toot-id"> #closed-195</span></h2><div class="pubdate">09 Oct at 14:10:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/195">https://github.com/qt4cg/qtspecs/pull/195</a></div><p>Added a CODEOWNERS file</p></div>
<div class="toot" id="created-195"><h2>Pull request #195 created<span class="toot-id"> #created-195</span></h2><div class="pubdate">09 Oct at 12:36:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/195">https://github.com/qt4cg/qtspecs/pull/195</a></div><details><summary>Added a CODEOWNERS file</summary><div class="markup"><p>This should have the effect that the Contributors team will automatically be added as reviewers to new PRs. Plus a few odds and ends where I should be notified (changes to build stuff).</p>
</div></details></div>
<div class="toot" id="closed-194"><h2>Issue #194 closed<span class="toot-id"> #closed-194</span></h2><div class="pubdate">09 Oct at 09:50:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/194">https://github.com/qt4cg/qtspecs/pull/194</a></div><p>More norm testing</p></div>
<div class="toot" id="created-194"><h2>Pull request #194 created<span class="toot-id"> #created-194</span></h2><div class="pubdate">09 Oct at 09:18:56 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/194">https://github.com/qt4cg/qtspecs/pull/194</a></div><details><summary>More norm testing</summary><div class="markup"><p>Ignore this too.</p>
</div></details></div>
<div class="toot" id="closed-193"><h2>Issue #193 closed<span class="toot-id"> #closed-193</span></h2><div class="pubdate">09 Oct at 09:16:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/193">https://github.com/qt4cg/qtspecs/pull/193</a></div><p>Moved these changes into the DeltaXML pipeline; just serialize to HTML 5</p></div>
<div class="toot" id="created-193"><h2>Pull request #193 created<span class="toot-id"> #created-193</span></h2><div class="pubdate">09 Oct at 09:16:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/193">https://github.com/qt4cg/qtspecs/pull/193</a></div><p>Moved these changes into the DeltaXML pipeline; just serialize to HTML 5</p></div>
<div class="toot" id="closed-192"><h2>Issue #192 closed<span class="toot-id"> #closed-192</span></h2><div class="pubdate">08 Oct at 18:07:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/192">https://github.com/qt4cg/qtspecs/pull/192</a></div><p>This is a test. This is only a test.</p></div>
<div class="toot" id="created-192"><h2>Pull request #192 created<span class="toot-id"> #created-192</span></h2><div class="pubdate">08 Oct at 17:00:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/192">https://github.com/qt4cg/qtspecs/pull/192</a></div><details><summary>This is a test. This is only a test.</summary><div class="markup"><p>Had this been a real emergency, we would have fled in terror and you would not have been informed.</p>
</div></details></div>
<div class="toot" id="created-191"><h2>Issue #191 created<span class="toot-id"> #created-191</span></h2><div class="pubdate">08 Oct at 16:57:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/191">https://github.com/qt4cg/qtspecs/issues/191</a></div><details><summary>Definition of "dynamic type"</summary><div class="markup"><p>The term "dynamic type" is defined in §2.2.3.2 as</p>
<blockquote>
<p>[Definition: A dynamic type is associated with each value as it is computed. The dynamic type of a value may be more specific than the [static type] of the expression that computed it (for example, the static type of an expression might be xs:integer*, denoting a sequence of zero or more integers, but at evaluation time its value may have the dynamic type xs:integer, denoting exactly one integer.)]</p>
</blockquote>
<p>Now, for a start, this is a pretty poor definition. It gives some properties of a dynamic type, but it doesn't say what it actually is: for example, what range of values it can take. Is it always a SequenceType that is expressible using the SequenceType grammar? We should be told.</p>
<p>It's also wrong. When you construct a sequence using the <code>","</code> operator, or a map using the <code>map:put()</code> function, there's nothing in the specification of those operations that tells you what the dynamic type of the result is. For example, there's nothing in the specification that says what the dynamic type of the sequence <code>(23, &lt;e/&gt;)</code> is.</p>
<p>In §4.4.2.1 the error is compounded where it says "the converted argument value retains its most specific <strong>dynamic type</strong>". At least this recognizes that a value actually conforms to more than one type. But it's wrong in suggesting that one of those types is necessarily the "most specific" (presumably meaning that it's a subtype of all the others). For example, the empty map (<code>map{}</code>) belongs to every map type, but there is no map type that is a subtype of all other map types (unless we conjecture that the dynamic type may be one that is inexpressible using SequenceType syntax).</p>
<p>With the introduction of record tests the map <code>map{"a":12, "b":14, 1:19}</code> conforms both to <code>record(a as xs:integer, b as xs:integer, *)</code> and to <code>map{xs:anyAtomicType, xs:integer}</code>, neither of which is more specific than the other, and there is no type expressible using the SequenceType grammar that is a subtype of both of these. So the introduction of record tests increases the importance of getting rid of this error.</p>
<p>It's not easy to fix issues like this, but it's important we should try, because errors in the description of the fundamentals can easily turn into bugs in the specification of concrete language constructs. We certainly need to fix it if we're going to add features like that proposed in issue #148, or to make changes to the type system to allow variadic dynamic function calls.</p>
<p>See also https://github.com/w3c/qtspecs/issues/14</p>
</div></details></div>
<div class="toot" id="closed-190"><h2>Issue #190 closed<span class="toot-id"> #closed-190</span></h2><div class="pubdate">08 Oct at 16:31:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/190">https://github.com/qt4cg/qtspecs/pull/190</a></div><p>Make DeltaXML diffs if possible</p></div>
<div class="toot" id="created-190"><h2>Pull request #190 created<span class="toot-id"> #created-190</span></h2><div class="pubdate">08 Oct at 16:25:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/190">https://github.com/qt4cg/qtspecs/pull/190</a></div><details><summary>Make DeltaXML diffs if possible</summary><div class="markup"><p>This PR adds the ability to generate mechanical diffs with Delta XML.</p>
</div></details></div>
<div class="toot" id="created-189"><h2>Issue #189 created<span class="toot-id"> #created-189</span></h2><div class="pubdate">07 Oct at 18:07:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/189">https://github.com/qt4cg/qtspecs/issues/189</a></div><details><summary>Adopt the coercion rules for variables in XQuery</summary><div class="markup"><p>Currently XSLT applies the coercion rules (formerly the function conversion rules) both when supplying values to arguments of a function declaring a required type, and when binding values to variables declaring a required type. This is pretty much essential because it allows xsl:variable and xsl:param to have the same semantics.</p>
<p>XQuery applies the coercion rules only for function arguments, and not for variable bindings. For variables, the supplied value must already be a value of the required type. For example, you can't write <code>let $x as xs:decimal := @version</code>, you have to write <code>let $x as xs:decimal := xs:decimal(@version)</code>. (Or if you find that annoying, you can write <code>let $x as xs:decimal := +@version</code>, because unary plus invokes coercion).</p>
<p>This is the main reason declared types are not allowed in XPath: the XSLT community felt that if they were allowed, the rules had to be the same as the rules for XSLT variable bindings. We could eliminate this objection if XQuery adopted the coercion rules for variable bindings.</p>
<p>I have some hesitation in proposing this, because when I proposed it before, it was quite strongly opposed by some of the original XQuery designers, whose views I respect. But although they argued their case strongly, I confess I did not understand their position. I simply see no reason why assignments to function parameters and assignments to variables should be handled differently. It works in XSLT, and makes the language more usable, and I see no reason why it should not work in XQuery.</p>
<p>It's not uncommon for languages to impose different rules for the two cases. Java, for example has a variety of invocation contexts (strict and loose), and variable assignment allows conversions such as narrowing of integer constants that are not allowed on method calls (interestingly, Java allows <em>more</em> conversions on variable assignment than on method calling). In XQuery, however, I can see no rationale for the rules being different.</p>
<p>We're proposing syntax for XQuery (function calls with keyword parameters) that make parameter assignment look more like variable assignment. I think we should match this by making them semantically more similar.</p>
</div></details></div>
<div class="toot" id="created-188"><h2>Pull request #188 created<span class="toot-id"> #created-188</span></h2><div class="pubdate">07 Oct at 16:41:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/188">https://github.com/qt4cg/qtspecs/pull/188</a></div><p>Editorial</p></div>
<div class="toot" id="created-187"><h2>Issue #187 created<span class="toot-id"> #created-187</span></h2><div class="pubdate">07 Oct at 11:34:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/187">https://github.com/qt4cg/qtspecs/issues/187</a></div><details><summary>Add a 'while' clause to FLWOR expressions</summary><div class="markup"><p>This proposal adds a new clause, the <strong>while</strong> clause, to FLWOR expressions. I'll start with the proposal, and then give some rationale.</p>
<p><strong>Proposal</strong></p>
<p>We add a new WhileClause which can appear anywhere a WhereClause can appear. The semantics are deliberately almost identical to the WhereClause.</p>
<p>3.12.x While Clause</p>
<p>[60]   	WhileClause	   ::=   	"while" ExprSingle	
A while clause serves as a filter for the tuples in its input tuple stream. The expression in the while clause, called the while-expression, is evaluated once for each of these tuples. If the effective boolean value of the while-expression is true, the tuple is retained in the output tuple stream; otherwise the tuple <strong>and all subsequent tuples in the stream</strong> are discarded.</p>
<p>Examples:</p>
<p>This example illustrates the effect of a while clause on a tuple stream:
Input tuple stream:</p>
<pre><code>($a = 13, $b = 11)
($a = 91, $b = 42)
($a = 17, $b = 30)
($a = 85, $b = 63)
</code></pre>
<p>while clause:
<code>while $a &gt; $b</code>
Output tuple stream:</p>
<pre><code>($a = 13, $b = 11)
($a = 91, $b = 42)
</code></pre>
<p>The following query illustrates how a while clause might be used to extract all items in an input sequence before the first one that fails to satisfy some condition. In this case it selects the leading <code>para</code> elements in the input sequence, stopping before the first element that is not a <code>para</code> element.</p>
<pre><code>for $x in $section/*
while $x[self::para]
return $x
</code></pre>
<p>Note:
Although the semantics are described in terms of discarding all the tuples following the first one that fails to match the condition, a practical implementation is likely to avoid evaluating those tuples, thus giving an "early exit" from the iteration performed by the FLWOR expression.</p>
<p><strong>Justification</strong></p>
<p>FLWOR expressions remain the primary control construct in XQuery, despite the introduction of higher-order functions. The inability to process input selectively until some condition is true remains one of their biggest limitations. The window clause provides a workaround for some use cases, but it is very complex, and although it can partition an input sequence based on conditions found in the data, it has no direct way of stopping processing when a condition is found. Also, it only operates on input sequences, not on the tuple stream, so it isn't able to handle a composite condition involving multiple variables, for example <code>for $i at $p in //emp while ($i/location = 'x' and $p &lt; 50) return $i</code>.</p>
<p>That particular example could be written with a <code>where</code> clause. But if a <code>where</code> clause is used, both the human reader and the query optimiser need to do some thinking to work out that early exit is possible (once $p reaches 50, no further tuples are going to have values less than 50).</p>
</div></details></div>
<div class="toot" id="closed-186"><h2>Issue #186 closed<span class="toot-id"> #closed-186</span></h2><div class="pubdate">07 Oct at 10:43:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/186">https://github.com/qt4cg/qtspecs/pull/186</a></div><p>Update build automation to publish tests</p></div>
<div class="toot" id="created-186"><h2>Pull request #186 created<span class="toot-id"> #created-186</span></h2><div class="pubdate">07 Oct at 10:36:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/186">https://github.com/qt4cg/qtspecs/pull/186</a></div><details><summary>Update build automation to publish tests</summary><div class="markup"><p>Recent changes (#184) from MK have added a new automatically generated test to the F&amp;O build.</p>
<p>This PR automates the construction and publication of new test sets from the <code>qtspecs</code> repository to the <code>qt4stests</code> repository.</p>
<p>N.B. The repository where tests are published (<code>qt4cg/qt4tests</code> in this case) must be the value of the TEST_REPOSITORY secret. If you want to automate publication to your own fork, just set the value of that secret accordingly.</p>
</div></details></div>
<div class="toot" id="created-185"><h2>Pull request #185 created<span class="toot-id"> #created-185</span></h2><div class="pubdate">07 Oct at 10:20:51 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/185">https://github.com/qt4cg/qtspecs/pull/185</a></div><details><summary>Issue118 drop xsl match</summary><div class="markup"><p>Removes the proposed new feature xsl:match from the draft spec; the proposal has been withdrawn</p>
</div></details></div>
<div class="toot" id="closed-118"><h2>Issue #118 closed<span class="toot-id"> #closed-118</span></h2><div class="pubdate">07 Oct at 10:07:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/118">https://github.com/qt4cg/qtspecs/issues/118</a></div><p>xsl:match - can we do better</p></div>
<div class="toot" id="closed-183"><h2>Issue #183 closed<span class="toot-id"> #closed-183</span></h2><div class="pubdate">07 Oct at 07:35:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/183">https://github.com/qt4cg/qtspecs/pull/183</a></div><p>Editorial</p></div>
<div class="toot" id="closed-184"><h2>Issue #184 closed<span class="toot-id"> #closed-184</span></h2><div class="pubdate">07 Oct at 07:34:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/184">https://github.com/qt4cg/qtspecs/pull/184</a></div><p>Editorial changes from PR 183</p></div>
<div class="toot" id="created-184"><h2>Pull request #184 created<span class="toot-id"> #created-184</span></h2><div class="pubdate">07 Oct at 07:28:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/184">https://github.com/qt4cg/qtspecs/pull/184</a></div><details><summary>Editorial changes from PR 183</summary><div class="markup"><p>This PR contains the editorial changes from #183 without the commits that add <code>fn:op</code> and other notes.</p>
<p>I believe I can fairly commit this PR without CG approval.</p>
</div></details></div>
<div class="toot" id="created-183"><h2>Pull request #183 created<span class="toot-id"> #created-183</span></h2><div class="pubdate">06 Oct at 17:34:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/183">https://github.com/qt4cg/qtspecs/pull/183</a></div><details><summary>Editorial</summary><div class="markup"><p>Branch for changes that are purely editorial in nature.</p>
</div></details></div>
<div class="toot" id="created-182"><h2>Issue #182 created<span class="toot-id"> #created-182</span></h2><div class="pubdate">06 Oct at 11:13:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/182">https://github.com/qt4cg/qtspecs/issues/182</a></div><details><summary>Should we allow vendor-defined optional parameters on built-in functions?</summary><div class="markup"><p>Now that we allow optional parameters on functions, with invocation by keyword, we could permit vendors to extend the function signature with optional parameters in a vendor-defined namespace. It would be required (obviously) that such parameters are optional.</p>
<p>A caveat is that under the current specification, (a) we can't stop the value of such a parameter being supplied positionally (perhaps unintentionally), and (b) the availability of such a parameter changes the arity range of the function, which potentially brings it into conflict with other like-named functions (for example functions introduced in the future).</p>
<p>A possible way of resolving this conflict is to propose that parameters whose name is namespaced can ONLY be supplied by keyword, and don't contribute to the arity range of the function. However, for user-defined functions, this rule would not be backwards compatible.</p>
<p>And a possible way around that is to say that the extensibility policy for a function is a property of its namespace; and to adopt different extensibility policies for built-in function namespaces and user-defined function namespaces.</p>
<p>Perhaps this is over-elaborate, and we should just make sure that functions that vendors might wish to extend have an options parameter, even if no standardised options are defined.</p>
</div></details></div>
<div class="toot" id="created-181"><h2>Issue #181 created<span class="toot-id"> #created-181</span></h2><div class="pubdate">05 Oct at 10:55:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/181">https://github.com/qt4cg/qtspecs/issues/181</a></div><details><summary>HOF Sequence Functions with Positional Arguments</summary><div class="markup"><p>Motivated by @michaelhkay’s question in https://github.com/qt4cg/qtspecs/issues/80#issuecomment-1253495999, I wondered if we should ~~add optional positional arguments to built-in sequence functions that take higher-order function arguments~~ (thanks, Dimitre:) extend the types of the functions that are themselves parameters to certain standard functions, by adding to their signature one more parameter, which is the index of the item that is also passed as an argument to this function.</p>
<p>Some examples:</p>
<pre><code class="language-xquery">(: fn:filter: Accept items that are identical to their predecessors :)
fn:filter(
  $sequence,
  fn($item, $pos) { $item = $sequence[$pos - 1] }
)

(: fn:for-each: Create enumerated strings for all items :)
for-each(
  $sequence,
  fn($item, $pos) { $pos || '. ' || $item }
)

(: fn:for-each-pair: Create enumerated strings for the maximum value of all item pairs :)
for-each-pair(
  $seq1, $seq2,
  fn($item1, $item2, $pos) { $pos || '. ' || max(($item1, $item2)) }
)

(: fn:fold-left: Return positions of the items matching a specific value :)
let $input := (11 to 21, 21 to 31)
let $search := 21
return fold-left($input, (), fn($seq, $curr, $pos) { $seq, $pos[$curr = $search] })
</code></pre>
<p><strong>Edit:</strong> I was wrong with my claim that the filter function could be used to replace <code>index-where</code>, and I have modified the example.</p>
</div></details></div>
<div class="toot" id="closed-180"><h2>Issue #180 closed<span class="toot-id"> #closed-180</span></h2><div class="pubdate">05 Oct at 10:17:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/180">https://github.com/qt4cg/qtspecs/pull/180</a></div><p>Implement function signatures as tables with default values</p></div>
<div class="toot" id="created-180"><h2>Pull request #180 created<span class="toot-id"> #created-180</span></h2><div class="pubdate">05 Oct at 10:10:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/180">https://github.com/qt4cg/qtspecs/pull/180</a></div><p>Implement function signatures as tables with default values</p></div>
<div class="toot" id="closed-179"><h2>Issue #179 closed<span class="toot-id"> #closed-179</span></h2><div class="pubdate">05 Oct at 09:00:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/179">https://github.com/qt4cg/qtspecs/pull/179</a></div><p>Link fixes</p></div>
<div class="toot" id="created-179"><h2>Pull request #179 created<span class="toot-id"> #created-179</span></h2><div class="pubdate">05 Oct at 08:28:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/179">https://github.com/qt4cg/qtspecs/pull/179</a></div><details><summary>Link fixes</summary><div class="markup"><p>This PR fixes some of the linking and cross-reference issues.</p>
<ol>
<li>I fixed some actual links in a few places</li>
<li>I added ID attributes to some new sections</li>
<li>I investigated, and finally punted on, the question of why some production cross-references in the XSLT 4.0 spec came out wrong. I "fixed" it by making the stylesheet more dynamic. There are still some that don't work, so we'll need to find a better solution eventually. But at least this helps.</li>
<li>I discarded an old draft that I don't believe was in use anywhere.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-178"><h2>Issue #178 closed<span class="toot-id"> #closed-178</span></h2><div class="pubdate">05 Oct at 07:05:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/178">https://github.com/qt4cg/qtspecs/pull/178</a></div><p>Fix the function finder</p></div>
<div class="toot" id="created-178"><h2>Pull request #178 created<span class="toot-id"> #created-178</span></h2><div class="pubdate">05 Oct at 07:00:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/178">https://github.com/qt4cg/qtspecs/pull/178</a></div><details><summary>Fix the function finder</summary><div class="markup"><ol>
<li>Determine which functions cannot be resolved and disable them in the pull down</li>
<li>Adjust the CSS so that the function finder doesn't scroll out-of-view</li>
</ol>
</div></details></div>
<div class="toot" id="agenda-10-11"><h2>QT4 CG meeting 006 draft agenda<span class="toot-id"> #agenda-10-11</span></h2><div class="pubdate">04 Oct at 16:56:16 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/10-11">https://qt4cg.org/meeting/agenda/2022/10-11</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="minutes-10-04"><h2>QT4 CG meeting 005 draft minutes<span class="toot-id"> #minutes-10-04</span></h2><div class="pubdate">04 Oct at 16:56:16 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/10-04">https://qt4cg.org/meeting/minutes/2022/10-04</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-177"><h2>Pull request #177 created<span class="toot-id"> #created-177</span></h2><div class="pubdate">04 Oct at 17:15:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/177">https://github.com/qt4cg/qtspecs/pull/177</a></div><p>Items before etc</p></div>
<div class="toot" id="closed-163"><h2>Issue #163 closed<span class="toot-id"> #closed-163</span></h2><div class="pubdate">04 Oct at 16:04:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/163">https://github.com/qt4cg/qtspecs/pull/163</a></div><p>New intersperse function now accepted</p></div>
<div class="toot" id="closed-176"><h2>Issue #176 closed<span class="toot-id"> #closed-176</span></h2><div class="pubdate">03 Oct at 14:58:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/176">https://github.com/qt4cg/qtspecs/issues/176</a></div><p>parse-json() - option to return numbers as xs:decimal</p></div>
<div class="toot" id="created-176"><h2>Issue #176 created<span class="toot-id"> #created-176</span></h2><div class="pubdate">03 Oct at 14:43:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/176">https://github.com/qt4cg/qtspecs/issues/176</a></div><details><summary>parse-json() - option to return numbers as xs:decimal</summary><div class="markup"><p>In response to a user request (https://saxonica.plan.io/issues/5708) I propose addition of an option to <code>fn:parse-json()</code>, say <code>number-type=double|decimal|string</code>, which causes numbers in JSON to be returned as <code>xs:decimal</code> or <code>xs:string</code> values rather than <code>xs:double</code>. Use of values with more digits of precision than <code>xs:double</code> supports is common in JSON practice, despite warnings in the RFC that it's not interoperable; and the fallback to <code>xs:string</code> is handy for people who have the misfortune to be processing incoming JSON where leading zeroes are significant (for example, Belgian VAT numbers).</p>
<p>The change also affects <code>fn:json-doc()</code></p>
</div></details></div>
<div class="toot" id="closed-174"><h2>Issue #174 closed<span class="toot-id"> #closed-174</span></h2><div class="pubdate">03 Oct at 14:17:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/174">https://github.com/qt4cg/qtspecs/issues/174</a></div><p>Should we allow f(x,,y) when calling a function where parameter 2 is optional?</p></div>
<div class="toot" id="created-175"><h2>Issue #175 created<span class="toot-id"> #created-175</span></h2><div class="pubdate">03 Oct at 10:33:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/175">https://github.com/qt4cg/qtspecs/issues/175</a></div><details><summary>In XQuery, allow a semicolon at the end of the module</summary><div class="markup"><p>A trivial little enhancement to remove an irritant: allow a semicolon after the query body in a query. Specifically, change</p>
<p><code>QueryBody ::= Expr</code></p>
<p>to</p>
<p><code>QueryBody ::= Expr Separator? </code></p>
</div></details></div>
<div class="toot" id="created-174"><h2>Issue #174 created<span class="toot-id"> #created-174</span></h2><div class="pubdate">03 Oct at 10:08:29 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/174">https://github.com/qt4cg/qtspecs/issues/174</a></div><details><summary>Should we allow f(x,,y) when calling a function where parameter 2 is optional?</summary><div class="markup"><p>If the second and third parameters of a function are optional, should we allow the syntax</p>
<p><code>f(x,,y)</code></p>
<p>to call the function using the default value for the second parameter?</p>
<p>I can see this being a handy convention for calling <code>fn:sort</code>, for example, where defaulting the second parameter (the collation) is commonplace.</p>
<p>The current proposal does not allow this, but I see no good reason not to.</p>
</div></details></div>
<div class="toot" id="created-173"><h2>Pull request #173 created<span class="toot-id"> #created-173</span></h2><div class="pubdate">01 Oct at 00:00:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/173">https://github.com/qt4cg/qtspecs/pull/173</a></div><p>Add specification for fn:op() (issue #83)</p></div>
<div class="toot" id="agenda-10-04"><h2>QT4 CG meeting 005 draft agenda<span class="toot-id"> #agenda-10-04</span></h2><div class="pubdate">30 Sep at 16:50:29 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/10-04">https://qt4cg.org/meeting/agenda/2022/10-04</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-2"><h2>Issue #2 closed<span class="toot-id"> #closed-2</span></h2><div class="pubdate">30 Sep at 16:20:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/2">https://github.com/qt4cg/qtspecs/issues/2</a></div><p>[FO] fn:intersperse</p></div>
<div class="toot" id="closed-24"><h2>Issue #24 closed<span class="toot-id"> #closed-24</span></h2><div class="pubdate">30 Sep at 16:18:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/24">https://github.com/qt4cg/qtspecs/issues/24</a></div><p>[XPath] [XQuery] The unknown ArgumentPlaceHolder EBNF symbol is referred to in several places</p></div>
<div class="toot" id="closed-27"><h2>Issue #27 closed<span class="toot-id"> #closed-27</span></h2><div class="pubdate">30 Sep at 16:16:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/27">https://github.com/qt4cg/qtspecs/pull/27</a></div><p>Fix references to ArgumentPlaceholder in the specifications.</p></div>
<div class="toot" id="created-172"><h2>Issue #172 created<span class="toot-id"> #created-172</span></h2><div class="pubdate">30 Sep at 08:09:25 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/172">https://github.com/qt4cg/qtspecs/issues/172</a></div><details><summary>Record Tests</summary><div class="markup"><p>The draft XPath specification includes a proposal for Record Tests - see section 3.6.4.3. This issue seeks WG endorsement of this enhancement, and also for the use of Record Tests as match patterns in XSLT.</p>
<p>The purpose of the feature is to provide more useful type checking for common use cases where maps are used to represent heterogeneous data. The feature enhances the type system but doesn't change the data model (that is, the new types represent a new way of placing constraints on the value space of maps, without introducing new kinds of values or new operations).</p>
<p>The type subsumption rules for record tests proposed in §3.7.2 clauses (m) et seq include a couple of TODO entries that need completing.</p>
</div></details></div>
<div class="toot" id="created-171"><h2>Issue #171 created<span class="toot-id"> #created-171</span></h2><div class="pubdate">30 Sep at 07:59:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/171">https://github.com/qt4cg/qtspecs/issues/171</a></div><details><summary>XPath ternary conditional operator</summary><div class="markup"><p>The draft XPath specification proposes a ternary conditional operator</p>
<p><code>C ?? X !! Y</code></p>
<p>with the same semantics as</p>
<p><code>if (C) then X else Y</code></p>
<p>This issue seeks WG endorsement of this enhancement.</p>
<p>The choice of operator symbols is from Perl; no other obvious candidates are available.</p>
<p>The proposal is free-standing, it has no dependencies or interactions.</p>
<p>The proposal adds no new functionality, but in some contexts (especially in the middle of an expression that uses symbolic operators rather than keywords) it aids readability:</p>
<p><code>//employee[@salary &gt; (@currency == 'GBP' ?? 10000 !! 12000)]/@name</code></p>
<p>There is room for debate about the operator precedence.</p>
</div></details></div>
<div class="toot" id="created-170"><h2>Issue #170 created<span class="toot-id"> #created-170</span></h2><div class="pubdate">30 Sep at 07:48:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/170">https://github.com/qt4cg/qtspecs/issues/170</a></div><details><summary>XPath "otherwise" operator</summary><div class="markup"><p>The draft specification proposes an "otherwise" operator. This issue seeks WG endorsement of this addition.</p>
<p>See section 4.18 of the XPath draft specification.</p>
<p>The semantics are that (X otherwise Y) returns X, except in the case where X evaluates to an empty sequence, in which case it returns Y. A typical usage would be <code>//employee ! (@location otherwise "Denver")</code>.</p>
<p>There are two questions the WG might choose to discuss:</p>
<ul>
<li>How should the operator be spelled? The symbol "?:" has been proposed as an alternative to the keyword "otherwise".</li>
<li>What should the operator precedence be?</li>
</ul>
<p>I propose that once approved, we also add this operator to the list recognised by the fn:op function.</p>
</div></details></div>
<div class="toot" id="created-169"><h2>Issue #169 created<span class="toot-id"> #created-169</span></h2><div class="pubdate">30 Sep at 07:01:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/169">https://github.com/qt4cg/qtspecs/issues/169</a></div><details><summary>Handling of duplicate keys in xsl:map</summary><div class="markup"><p>The draft specifications include proposals to enhance the handling of duplicate key values in xsl:map. This issue seeks WG endorsement of these changes.</p>
<p>See XSLT section 21.2.1</p>
<p>map:merge currently provides a set of fixed "policy" options for handling of duplicates; xsl:map always raises an error.</p>
<p>Rather than adopt the fixed set of policies in map:merge, I propose that xsl:map should accept a callback function to process duplicates. For example, forming a sequence-concatenation of the values can be achieved using <code>on-duplicates="op(',')"</code>. This approach allows all the options provided by map:merge, and more; for example the duplicate entries can be combined using string-join() if so desired.</p>
</div></details></div>
<div class="toot" id="created-168"><h2>Issue #168 created<span class="toot-id"> #created-168</span></h2><div class="pubdate">30 Sep at 06:49:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/168">https://github.com/qt4cg/qtspecs/issues/168</a></div><details><summary>XSLT Extension Instructions invoking Named Templates</summary><div class="markup"><p>This feature is already present in the draft specification; the issue is being raised to seek WG endorsement of the change.</p>
<p>See section 10.1.3 of the draft.</p>
<p>The change is self contained with no dependencies. It adds no new functionality, merely syntactic convenience.</p>
</div></details></div>
<div class="toot" id="created-167"><h2>Issue #167 created<span class="toot-id"> #created-167</span></h2><div class="pubdate">30 Sep at 06:37:33 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/167">https://github.com/qt4cg/qtspecs/issues/167</a></div><details><summary>XSLT Conditional Instructions</summary><div class="markup"><p>These changes are already present in the draft specification: this issue is being raised to seek WG endorsement of the changes.</p>
<p>See section 8 of the specification.</p>
<ol>
<li>In <code>xsl:if</code>, add optional <code>then</code> and <code>else</code> attributes</li>
<li>In <code>xsl:when</code> and <code>xsl:otherwise</code>, add an optional <code>select</code> attribute which can be used in place of the sequence constructor</li>
<li>Add a new <code>xsl:switch</code> instruction</li>
</ol>
<p>Justification: these changes do not add any functional capability to the language, they simply provide a small improvement in usability. The changes are self-contained with no dependencies on other changes.</p>
</div></details></div>
<div class="toot" id="closed-154"><h2>Issue #154 closed<span class="toot-id"> #closed-154</span></h2><div class="pubdate">29 Sep at 20:33:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/154">https://github.com/qt4cg/qtspecs/issues/154</a></div><p>Namespaces for Functions</p></div>
<div class="toot" id="created-166"><h2>Pull request #166 created<span class="toot-id"> #created-166</span></h2><div class="pubdate">29 Sep at 20:28:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/166">https://github.com/qt4cg/qtspecs/pull/166</a></div><details><summary>Variadicity</summary><div class="markup"><p>Two main separate but related features: (a) allow function declarations in XQuery and XSLT to define optional parameters, (b) allow static function calls (including partial function application) to take keyword arguments.</p>
</div></details></div>
<div class="toot" id="created-165"><h2>Issue #165 created<span class="toot-id"> #created-165</span></h2><div class="pubdate">29 Sep at 11:38:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/165">https://github.com/qt4cg/qtspecs/issues/165</a></div><details><summary>Keyword arguments: ":=" or ":"?</summary><div class="markup"><p>In function calls using keyword arguments, should we use the syntax <code>name := value</code>, or <code>name : value</code>?</p>
<p>Regarding <code>:=</code>:</p>
<ul>
<li>Function declarations in XQuery will presumably use the syntax <code>name := value</code> to define the default value for a parameter,  by analogy with initial values in global variable declarations, so it seems consistent to use <code>name := value</code> in function calls as well</li>
<li>The syntax <code>name := value</code> is also used in XPath <code>let</code> expressions to bind a value to a variable name.</li>
</ul>
<p>Regarding <code>:</code>:</p>
<ul>
<li>It matches the use in map constructors</li>
<li>It's used this way in C#</li>
<li>There is a need to use whitespace to prevent ambiguity, for example in a construct like <code>f:display(first: first, last: last)</code>; moreover, if the space is omitted, there is a danger that the expression will still be valid but will have an unintended meaning.</li>
<li>Map constructors also require the disambiguating whitespace, but with map constructors, use of a bare name on the LHS is unusual (more common is a string literal in quotes), and failure to include the whitespace is almost certain to lead to a syntax error.</li>
</ul>
<p>My feeling is that <code>:=</code> is the better choice.</p>
<p>Note: <code>=</code> (as used in Python) is not an option, because a call like <code>not(x = y)</code> already has a well-defined meaning.</p>
</div></details></div>
<div class="toot" id="closed-164"><h2>Issue #164 closed<span class="toot-id"> #closed-164</span></h2><div class="pubdate">29 Sep at 10:37:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/164">https://github.com/qt4cg/qtspecs/pull/164</a></div><p>Fix error in input paths for XSLT</p></div>
<div class="toot" id="created-164"><h2>Pull request #164 created<span class="toot-id"> #created-164</span></h2><div class="pubdate">29 Sep at 10:32:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/164">https://github.com/qt4cg/qtspecs/pull/164</a></div><details><summary>Fix error in input paths for XSLT</summary><div class="markup"><p>The XSLT 4.0 spec didn't build correctly because the input paths in the build script were missing the /specification/ directory :-(</p>
</div></details></div>
<div class="toot" id="created-163"><h2>Pull request #163 created<span class="toot-id"> #created-163</span></h2><div class="pubdate">27 Sep at 22:06:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/163">https://github.com/qt4cg/qtspecs/pull/163</a></div><details><summary>New intersperse function now accepted</summary><div class="markup"><p>and correct the fos.xsd schema for history/version information</p>
</div></details></div>
<div class="toot" id="created-162"><h2>Issue #162 created<span class="toot-id"> #created-162</span></h2><div class="pubdate">27 Sep at 19:20:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/162">https://github.com/qt4cg/qtspecs/issues/162</a></div><details><summary>Support unbounded variadic functions on map parameter keys</summary><div class="markup"><p>Where a parameter is defined as a map, then named/keyword arguments bind to keys in that map if the named/keyword argument does not match a parameter name in that function. For example, <code>fn:serialize($data, method: "json")</code>.</p>
<h1>Motivation</h1>
<p>There are several functions that take an option map in XQFO. It can be clunky to construct the map options when calling these functions.</p>
<p>The option map is a common pattern in other implementations. Specifically, MarkLogic makes use of that pattern.</p>
<h1>Note</h1>
<p>If the argument name is an NCName, the xs:NCName value should be cast to the map's key type using the XQFO type/value casting rules.</p>
<p>The argument name should support string literals, as map keys can contain spaces. In this case, the xs:string type is cast to the map's key type using the XQFO type/value casting rules.</p>
<p>The #159 proposal allows QNames for the argument names in order to support parameters that are QNames. When binding to a map key an error (static or dynamic) should be raised.</p>
</div></details></div>
<div class="toot" id="created-161"><h2>Issue #161 created<span class="toot-id"> #created-161</span></h2><div class="pubdate">27 Sep at 19:00:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/161">https://github.com/qt4cg/qtspecs/issues/161</a></div><details><summary>Support unbounded variadic functions on sequence parameters</summary><div class="markup"><p>Where a parameter is defined as a 0-or-more sequence (<code>T*</code>) or a 1-or-more sequence (<code>T+</code>) and that parameter is indicated as behaving variadically, then positional (non-keyword) arguments from that parameter onward are bound to that sequence.</p>
<h1>Motivation</h1>
<p>The XQFO specification supports the <code>fn:concat</code> function which takes 2 or more arguments. The "or more" part is defined as "..." with a short sentence stating that this is the only function that supports two or more arguments. As such, the behaviour of this function is loosely defined.</p>
<p>Other implementors and specifications (BaseX, EXQuery RESTXQ, MarkLogic) make use of these variadic sequence types in several functions.</p>
<p>In all of these cases (and for user-defined variadic sequence parameters) the semantics of the functions should be well defined.</p>
<h1>Note</h1>
<p>In the case where the 0-or-more sequence is the last parameter (or the parameter receiving the unbounded argument values), that parameter would be an optional value as if it was defined as <code>$param as T* := ()</code>.</p>
<p>One possibility with the interaction with named arguments is to allow that to break up two sequence parameters that behave variadically. For example, given <code>f($a as xs:int*, $b as xs:string, $c as xs:int*)</code> it may be possible to call it like <code>f(1, 2, 3, b: "4", 5, 6, 7)</code> which would be equivalent to <code>f((1, 2, 3), "4", (5, 6, 7))</code> currently.</p>
<p>This should be defined such that calling the function with the same number of arguments as the function has parameters then none of the parameters behave variadically. This has the intention of not breaking existing code.</p>
</div></details></div>
<div class="toot" id="created-160"><h2>Issue #160 created<span class="toot-id"> #created-160</span></h2><div class="pubdate">27 Sep at 18:35:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/160">https://github.com/qt4cg/qtspecs/issues/160</a></div><details><summary>Support named arguments on dynamic function calls</summary><div class="markup"><p>This proposal extends #159 to dynamic functions. For example, <code>let $x := fn:tokenize#3 return $x("abcbdCef", pattern: "c", flags: "i")</code>.</p>
<h2>Motivation</h2>
<p>This is the same as the motivation for #159, but in the context of a) inline functions, and b) named function references. This is specifically useful for XPath expressions where defining the functions in XSLT is cumbersome and makes it harder to share the implementation between XSLT and XQuery.</p>
<h2>Notes</h2>
<p>If the resolved function (static or inline) from the dynamic expression does not have a parameter with the specified name, a suitable error should be raised.</p>
</div></details></div>
<div class="toot" id="created-159"><h2>Issue #159 created<span class="toot-id"> #created-159</span></h2><div class="pubdate">27 Sep at 18:13:03 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/159">https://github.com/qt4cg/qtspecs/issues/159</a></div><details><summary>Support named arguments on static function calls</summary><div class="markup"><p>This proposal adds the ability to specify the names (referred to here as "keywords") of the parameters of a function at the point at which the function is called. This uses the form <code>name: value</code> where name is a QName and value is a single expression, for example <code>fn:tokenize("abcbdCef", pattern: "c", flags: "i")</code>.</p>
<h2>Motivation</h2>
<p>If a function takes several arguments of the same type (xs:boolean, xs:integer, xs:string, etc.) it can be easy to mix up the parameters. As such, it can be useful to specify these by name when calling the function, e.g. <code>f(a: true(), b: false(), c: true())</code> to both aid readability and to prevent bugs when the values are specified in the wrong order to how they are declared (such as swapping the <code>$pattern</code> and <code>$flags</code> parameters in <code>fn:tokenize</code>).</p>
<p>If a function takes several optional parameters and the caller only wants to override one of the later parameters (such as the <code>$collation</code> in <code>fn:differences</code>), specifying the name of the parameter avoids specifying a value for the other arguments. This makes it clearer what is happening (as the user does not need to think about the supplied default arguments), and reduces errors (such as specifying a wrong default value for the arguments the caller is not interested in).</p>
<h2>Notes</h2>
<p>Because function parameter names are EQNames, the keyword should also be an EQName. If the keyword is an NCName, then it should follow the same rules as parameter NCNames such that the namespace URI is empty.</p>
<p>Like with maps, if the value starts with an element name (EQName) then there must be a space after the <code>:</code>. This should use the same note as the one in the map constructor section.</p>
<p>An alternative <code>name := value</code> syntax has also been suggested. An informal consensus is in favour of using <code>name: value</code>.</p>
</div></details></div>
<div class="toot" id="minutes-09-27"><h2>QT4 CG meeting 004 draft minutes<span class="toot-id"> #minutes-09-27</span></h2><div class="pubdate">27 Sep at 16:40:49 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/09-27">https://qt4cg.org/meeting/minutes/2022/09-27</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-158"><h2>Issue #158 created<span class="toot-id"> #created-158</span></h2><div class="pubdate">27 Sep at 17:22:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/158">https://github.com/qt4cg/qtspecs/issues/158</a></div><details><summary>Support optional parameters on dynamic functions</summary><div class="markup"><p>This proposal extends #155 to dynamic functions.</p>
<h2>Motivation</h2>
<p>Within XPath there isn't a defined mechanism for declaring static functions. It can be such that declaring a function outside of the XPath expression is more cumbersome (such as defining it within XSLT) and makes the resulting expression less portable between XSLT and XQuery.</p>
<p>There are 2 cases where this applies:</p>
<ol>
<li>
<p>Defining inline functions -- These should work like declaring default values for static functions, with the rules for applying default values working at the dynamic call site.</p>
</li>
<li>
<p>Specifying named function references for functions with additional default arguments, such as <code>fn:tokenize#2("lorem ipsum")</code> where the <code>fn:tokenize#2</code> binds the <code>$flags</code> default value and the dynamic call applies the default value for <code>$pattern</code>. -- This is possible to define as creating an inline function such that any default parameters are preserved along with the parameter types at the corresponding parameter index.</p>
</li>
</ol>
<h2>Note</h2>
<p>For FunctionTest (i.e. function types), I'm not sure of a use case where extending optional parameters to that would be useful, as any higher-order function would always call the input function with the correct number of arguments. If this is useful, then that should be moved to a separate proposal.</p>
</div></details></div>
<div class="toot" id="created-157"><h2>Issue #157 created<span class="toot-id"> #created-157</span></h2><div class="pubdate">27 Sep at 17:00:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/157">https://github.com/qt4cg/qtspecs/issues/157</a></div><details><summary>Proposal to support optional parameters that bind to the context item.</summary><div class="markup"><p>This proposal formalizes the definition of the 0-arity versions of <code>fn:string</code>, <code>fn:data</code>, etc. that bind to the context item.</p>
<h2>Motivation</h2>
<p>This allows <code>fn:string</code> to be defined and implemented in a single function of the form:</p>
<pre><code>declare function fn:string($item as item()? := .) as xs:string { ... }
</code></pre>
<h2>Notes</h2>
<p>When the default value is specified, the function is ·context-independent·, and ·focus-independent· at this point.</p>
<p>When the default value is <em>not</em> specified, the function is ·context-dependent·, and ·focus-dependent· at this point.</p>
<p>This allows users to define their own functions that can be used at the end of path expressions, e.g. <code>/color/hexcode/to-int(16)</code>.</p>
<p>Once this proposal has been accepted, we should go through the XSLT and XQFO specifications and use defaults for all the relevant functions.</p>
</div></details></div>
<div class="toot" id="closed-156"><h2>Issue #156 closed<span class="toot-id"> #closed-156</span></h2><div class="pubdate">27 Sep at 16:50:45 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/156">https://github.com/qt4cg/qtspecs/pull/156</a></div><p>Changes agreed 2022-09-20, and add history info to the spec for each function</p></div>
<div class="toot" id="created-156"><h2>Pull request #156 created<span class="toot-id"> #created-156</span></h2><div class="pubdate">27 Sep at 16:45:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/156">https://github.com/qt4cg/qtspecs/pull/156</a></div><details><summary>Changes agreed 2022-09-20, and add history info to the spec for each function</summary><div class="markup"><p>Approved <a href="https://qt4cg.org/meeting/minutes/2022/09-27.html">on 27 September</a></p>
</div></details></div>
<div class="toot" id="closed-134"><h2>Issue #134 closed<span class="toot-id"> #closed-134</span></h2><div class="pubdate">27 Sep at 16:43:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/134">https://github.com/qt4cg/qtspecs/pull/134</a></div><p>Make agreed changes to fn:all and fn:some functions.</p></div>
<div class="toot" id="closed-152"><h2>Issue #152 closed<span class="toot-id"> #closed-152</span></h2><div class="pubdate">27 Sep at 16:42:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/152">https://github.com/qt4cg/qtspecs/pull/152</a></div><p>Mike's changes to fn:all and fn:some</p></div>
<div class="toot" id="created-155"><h2>Issue #155 created<span class="toot-id"> #created-155</span></h2><div class="pubdate">27 Sep at 16:36:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/155">https://github.com/qt4cg/qtspecs/issues/155</a></div><details><summary>Proposal to support optional parameter values on static functions.</summary><div class="markup"><p>This proposal allows users to define optional parameters for a function. When calling the function statically (e.g. <code>f(1,2,3)</code>), or creating a named function reference to it (e.g. <code>f#3</code>), any optional parameters that are not specified take the default values.</p>
<h2>Motivation</h2>
<p>Defining functions that can take one or more optional argument (such as in the Functions and Operators specification) adds a lot of boilerplate code. For example, `fn:tokenize could be written as:</p>
<pre><code>declare function fn:tokenize($value as xs:string?) as xs:string* {
   fn:tokenize($value, "\s+")
};

declare function fn:tokenize($value as xs:string?, $pattern as xs:string) as xs:string* {
   fn:tokenize($value, $pattern, "")
};

declare function fn:tokenize($value as xs:string?, $pattern as xs:string, $flags as xs:string) as xs:string* {
   ...
};
</code></pre>
<p>In this proposal, the above can be written more simply and concisely as:</p>
<pre><code>declare function fn:tokenize(
   $value as xs:string?,
   $pattern as xs:string := "\s+",
   $flags as xs:string := ""
) as xs:string* {
   ...
};
</code></pre>
<p>Both of these definitions of <code>fn:tokenize</code> are equivalent.</p>
<h2>Note</h2>
<p>Once this proposal has been accepted, we should go through the XSLT and XQFO specifications and use defaults for all the relevant functions.</p>
</div></details></div>
<div class="toot" id="created-154"><h2>Issue #154 created<span class="toot-id"> #created-154</span></h2><div class="pubdate">27 Sep at 08:16:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/154">https://github.com/qt4cg/qtspecs/issues/154</a></div><details><summary>Namespaces for Functions</summary><div class="markup"><p>The current F+O function library is divided into four namespaces: fn, map, array, and math.</p>
<p>The use of separate namespaces serves little purpose, because they are all controlled by the same naming authority.</p>
<p>But it has some significant disadvantages:</p>
<p>(a) The proliferation of namespace declarations and namespace prefixes in user programs causes visual clutter.</p>
<p>(b) Putting additional namespaces into the static context causes semantic clutter: such namespaces become available for unwanted purposes, such as casting strings to QNames, which also means that the namespace bindings need to be retained at run time, which bloats compiled code.</p>
<p>(c) It's not always obvious, either to the specification developers or to users, what namespace a new function belongs in.</p>
<p>I've attempted various ways of solving this problem, such as having a "namespace search list" used to resolve unprefixed function names, in place of a single default namespace. This idea falls down because we already have duplication across the current namespaces, for example fn:remove and map:remove.</p>
<p>Polymorphism (deciding which function to call based on the type of the first argument) also seems unpromising as a way forward; our type system is not classically object-oriented.</p>
<p>I propose instead that all functions in F+O should have an alias/synonym in the fn namespace:</p>
<ul>
<li><code>map:remove()</code> becomes available as <code>m.remove()</code>, etc</li>
<li><code>array:size()</code> becomes available as <code>a.size()</code>, etc</li>
<li><code>math:tan()</code> becomes available as <code>tan()</code> etc</li>
</ul>
<p>I also propose removing the rule that user-declared functions have to be in a namespace. Instead, a function declared with no prefix (at least in XSLT, not sure exactly how this works in XQuery) should be in no namespace; and the binding rule for unprefixed names in function calls is to search first for no-namespace names, then for names in the default (usually fn) namespace. Of course this creates a risk of binding to the "wrong" function, but users can defend against this in a number of ways: they can avoid use of the feature, they can use the fn: prefix for disambiguation when necessary, they can adopt a naming convention like calling their own functions my.sum(). We should treat users as adults, able to make their own decisions on such matters.</p>
<p>We will still encourage third-party developers of function libraries to put their functions in their own namespace, and of course this applies to EXPath modules such as file and binary.</p>
</div></details></div>
<div class="toot" id="created-153"><h2>Pull request #153 created<span class="toot-id"> #created-153</span></h2><div class="pubdate">26 Sep at 12:14:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/153">https://github.com/qt4cg/qtspecs/pull/153</a></div><details><summary>Explicitly mention subtypes for arrays and maps</summary><div class="markup"><p>Reword section 3.6.4 for map and array type tests to explicitly mention sub typing and link to the relevant section.</p>
<p>I believe, it is important to add examples for subtypes of arrays and maps. Can someone advise how and where to add them?</p>
<p>map subtype example (could be added to 3.7.2.4 d.):</p>
<pre><code class="language-xml">&lt;note&gt;
  &lt;p&gt;&lt;code&gt;map(xs:integer, element(fruit))&lt;/code&gt; is a subtype of &lt;code&gt;map(xs:anyAtomic, node())&lt;/code&gt;&lt;/p&gt;
&lt;/note&gt;
</code></pre>
<p>array subtype example (could be added to 3.7.2.4 i.):</p>
<pre><code class="language-xml">&lt;note&gt;
  &lt;p&gt;&lt;code&gt;array(xs:positiveInteger)&lt;/code&gt; is a subtype of &lt;code&gt;array(xs:decimal)&lt;/code&gt;&lt;/p&gt;
&lt;/note&gt;
</code></pre>
</div></details></div>
<div class="toot" id="agenda-09-27"><h2>QT4 CG meeting 004 draft agenda<span class="toot-id"> #agenda-09-27</span></h2><div class="pubdate">25 Sep at 17:48:07 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/09-27">https://qt4cg.org/meeting/agenda/2022/09-27</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-152"><h2>Pull request #152 created<span class="toot-id"> #created-152</span></h2><div class="pubdate">22 Sep at 09:03:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/152">https://github.com/qt4cg/qtspecs/pull/152</a></div><details><summary>Mike's changes to fn:all and fn:some</summary><div class="markup"><p>This is a re-application of Mike's PR onto the latest sources and build environment.</p>
</div></details></div>
<div class="toot" id="closed-110"><h2>Issue #110 closed<span class="toot-id"> #closed-110</span></h2><div class="pubdate">21 Sep at 17:34:27 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/110">https://github.com/qt4cg/qtspecs/issues/110</a></div><p>JSON templates</p></div>
<div class="toot" id="created-151"><h2>Issue #151 created<span class="toot-id"> #created-151</span></h2><div class="pubdate">21 Sep at 17:34:06 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/151">https://github.com/qt4cg/qtspecs/issues/151</a></div><details><summary>map:build() function</summary><div class="markup"><p>This proposal replaces https://github.com/qt4cg/qtspecs/issues/110</p>
<pre><code>map:build($input as item()*, 
                  $makeKey as function(item()) as xs:anyAtomicValue, 
                  $makeValue as function(item()) as item()*.
                  $duplicates as function(item()*, item()*) as item()*) as map(*)

The fourth argument is optional and defaults to fn:op(",").

The third argument is optional and defaults to fn:identity#1

</code></pre>
<p>Example 1:</p>
<p><code>map:build(//employee, -&gt;{@ssn}, identity#1, -&gt;($x,$y){error()})</code>
Constructs an index of employees with the atomised @ssn attribute as key, and the employee element as the associated value, failing if there are any duplicates</p>
<p>This can be abbreviated to <code>map:build(//employee, -&gt;{@ssn})</code> if it is known that there are no duplicates, or if the default action on duplicates is acceptable.</p>
<p>Example 2:</p>
<p><code>map:build(//employee, -&gt;{location/city}, -&gt;{xs:decimal(salary)}, op(","))</code></p>
<p>Constructs a map whose keys are the locations of employees and whose associated values are the salaries of employees at that location. The effect of the $duplicates argument is that if there are several employees at the same location, their salaries are combined into a sequence (using the "," operator). If the last argument were <code>op("+")</code>, the map would contain the sum of the salaries for each location.</p>
<p>Rules</p>
<p>The function creates a map.</p>
<p>Informally, the function processes each item in the input sequence in turn in sequence order. It calls the $makeKey function on that item to obtain a key value, and the $makeValue function to obtain an associated value. If the key is not already present in the map, it creates a new key-value pair with that key and that value. If the key is already present, it combines the existing value for the key with the new value using the $duplicates function, and replaces the entry with this combined value.</p>
<p>More formally, the result of the function is the result of the following expression:</p>
<pre><code>fold-left($input, map{}, -&gt;($old, $next){
    let $key := $makeKey($next)
    let $value := $makeValue($next)
    return 
       if (map:contains($old, $key))
       then map:put($old, $key, $duplicates($map:get($key), $value))
       else map:put($old, $key, $value)
   })
</code></pre>
<p>NOTE: although defined to process the input sequence in order, the implementation may be optimised (for example to work in parallel) if it is known that the $duplicates function is symmetric, that is, if $duplicates($a, $b) produces the same result as $duplicates($b, $a).</p>
</div></details></div>
<div class="toot" id="created-150"><h2>Issue #150 created<span class="toot-id"> #created-150</span></h2><div class="pubdate">21 Sep at 03:10:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/150">https://github.com/qt4cg/qtspecs/issues/150</a></div><details><summary>fn:ranks: Produce all ranks in applying a function on the items of a sequence</summary><div class="markup"><p>We all know the value and usefulness of functions such as <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-highest"><strong><em><code>fn:highest()</code></em></strong></a> <a href="https://qt4cg.org/specifications/xpath-functions-40/Overview.html#func-lowest"><strong><em><code>and fn:lowest()</code></em></strong></a>.</p>
<p>Sometimes, when we need to see all rankings of a particular sorting result, for example the rankings of a sport competition, we realize that highest and lowest are just the highest and lowest ranking-groups from all the rankings.</p>
<p>We define these three overloads for <strong><code>fn:ranks</code></strong>:</p>
<p><strong>fn:ranks</strong>($input as item()*) as array(item()*)*</p>
<p><strong>fn:ranks</strong>($input as item()*, $collation as xs:string?) as array(item()*)*</p>
<p><strong>fn:ranks</strong>($input	 as item()*, $collation	 as xs:string?, 	$key	 as function(item()) as xs:anyAtomicType*) as array(item()*)*</p>
<p>The rules and semantics for the arguments are the same as those for <strong>fn:highest</strong>, <strong>fn:lowest</strong>, <strong>fn:sort</strong>. What is different is just the result.</p>
<p><strong>Here is one possible XPath implementation and also a complete example</strong>:</p>
<pre><code class="language-xq">let $ranks := function(
                $input as item()*,
                $collation as xs:string?,
                $key as function(item()) as xs:anyAtomicType*) as array(item()*)*
 {
    for $v in sort(distinct-values($input ! $key(.)),  $collation)
     return [$input[$key(.) eq $v]]
 },
 
   $inp := (3, 2, 4),
   $keyfun := function($n) {$n mod 2},
   $theRanks :=  $ranks($inp, (), $keyfun),
   $theHighest := $theRanks[last()], 
   $theLowest := $theRanks[1]
 return
 
   ( "Ranks:", $theRanks,
     "=================",
     "Highest:",
     $theHighest,
     "=================",
     "Lowest:",
     $theLowest
   )
</code></pre>
<p>The result, as intended is all the rankings (in this case they are just 2 groups of equally-ranked items), then the highest and lowest, extracted as the last and first of the rankings:</p>
<pre><code>Ranks:
[(2, 4)]
[3]
=================
Highest:
[3]
=================
Lowest:
[(2, 4)]
</code></pre>
</div></details></div>
<div class="toot" id="created-149"><h2>Issue #149 created<span class="toot-id"> #created-149</span></h2><div class="pubdate">20 Sep at 20:12:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/149">https://github.com/qt4cg/qtspecs/issues/149</a></div><details><summary>Functions for splitting a sequence (or array) based on predicate matching </summary><div class="markup"><p>This is concerned with use cases like "How do I select all the paragraphs before the first H2?" or "How do I select items between <start-milestone></start-milestone> and <end-milestone></end-milestone>?".</p>
<p>Currently in the draft spec we have proposals for:</p>
<p><code>range-from($input, $predicate)</code>: Returns a sequence containing items from an input sequence, starting with the first item that matches a supplied predicate.</p>
<p><code>range-to($input, $predicate)</code>: Returns a sequence containing items from an input sequence, ending with the first item that matches a supplied predicate.</p>
<p>These both include the matching item, on the theory that it's easier to drop it if it's not wanted, than to add it if its needed.</p>
<p>I've also proposed (as an alternative) a family of four functions <code>items-before</code>, <code>items-to</code>, <code>items-from</code>, <code>items-after</code> giving four combinations of taking the subsequence before/after the first match of the predicate, and including or not including the matched item.</p>
<p>It's worth pointing out that these can all be defined in terms of index-where. For example range-to (assuming at least one item matches the predicate) is subsequence($input, 1, index-where($input, $predicate).</p>
<p>These functions all treat the first match of the predicate as special: they partition the sequence before or after the first item that matches the predicate. An alternative, inspilred by XSLT's for-each-group group-ending|starting-with, would be to partition the sequence breaking immediately before or after every item that matches the predicate:</p>
<pre><code>group-breaking-after($input, $predicate)
group-breaking-before($input, $predicate)
</code></pre>
<p>But these logically return a sequence of sequences, which would typically be presented either as an array of sequences or a sequence of arrays, neither of which is ideal. (An alternative would be to return a sequence of arity-0 functions)</p>
<p>Having reviewed the options, I think my preferance remains having a family of four functions which I have called  items-before, items-to, items-from, items-after. But I'm certainly open to other options. The logical names would probably be subsequence-before etc, but that's a bit of a mouthful.</p>
<p>Whatever family of functions we decide upon, there's logically a requirement to offer the same for arrays.</p>
<p>Michael Kay</p>
</div></details></div>
<div class="toot" id="minutes-09-20"><h2>QT4 CG meeting 003 draft minutes<span class="toot-id"> #minutes-09-20</span></h2><div class="pubdate">20 Sep at 18:25:39 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/09-20">https://qt4cg.org/meeting/minutes/2022/09-20</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-148"><h2>Issue #148 created<span class="toot-id"> #created-148</span></h2><div class="pubdate">20 Sep at 13:24:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/148">https://github.com/qt4cg/qtspecs/issues/148</a></div><details><summary>Get the type of a value</summary><div class="markup"><p>This could be a language construct like <code>type of $a</code> similar to <code>$a instance of &lt;type&gt;</code> or a function <code>fn:type-of(item()*)</code>.</p>
<p>It returns the string representation of the type of a value.</p>
<ul>
<li>For atomic values, return the local name of the most specific built-in (XSD) type of which the value is an instance of.</li>
<li>For nodes, return node-kind(name) where node-kind is for example "element" or "attribute" and name (for nodes that have a name) is the node name in Q{uri}local notation.</li>
<li>For other functions return a string representation of the function signature that (a) conforms to XPath SequenceType syntax, and (b) uses EQName notation for qualified names.</li>
<li>For empty maps and arrays return <code>map(*)</code> and <code>array(*)</code> respectively</li>
<li>For arrays and maps with members and entries the implementation <em>can</em> attempt to find the most specific shared type like <code>array(xs:string)</code>, <code>map(xs:integer, element(banana))</code>
<ul>
<li>The inspection should stop as early as possible, when the first mismatching type is encountered.</li>
</ul>
</li>
</ul>
<pre><code class="language-xquery">type of "", (: yields "xs:string" :)
type of [], (: yields "array(*)" :)
type of [map{"a": true(), "b": false()}, map{"c", false()}], (: yields "array(map(xs:string, xs:boolean))" :)
type of ([], map{}, function () {}]), (: yields "function(*)" :)
type of [map{"a": true(), "b": "false"}, map{"c", false()}] (: yields "array(map(xs:string, xs:anyAtomic))" or "array(map(xs:string, *))" :)
</code></pre>
<p>I wrote an implementation in XQuery as a PoC utilizing typeswitch:</p>
<p>https://github.com/line-o/xbow/commit/ca6e593f869c15b1fb372d24653715abfbda5cf8</p>
<p>There is an implementation in baseX <a href="https://docs.basex.org/wiki/Inspection_Module#inspect:type">inspect:type</a>.
<code>inspect:type#2</code> allowing to set additional options which should be considered.</p>
</div></details></div>
<div class="toot" id="created-147"><h2>Issue #147 created<span class="toot-id"> #created-147</span></h2><div class="pubdate">19 Sep at 10:50:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/147">https://github.com/qt4cg/qtspecs/issues/147</a></div><details><summary>Terse syntax for map entries</summary><div class="markup"><p>Allow variables to be used to construct map entries with</p>
<ul>
<li>the key being the variable name cast to xs:string and</li>
<li>the value to be the value of the variable</li>
</ul>
<p>The syntax would change to something along</p>
<pre><code>mapExpression ::= 'map' '{' ( expr ':' expr | variableReference ) [ ',' ( expr ':' expr | variableReference ) ]* '}'
</code></pre>
<p>Example:</p>
<pre><code class="language-xquery">let $my-var := &lt;root /&gt;
let $other := map { "a": [ 1, 2, 3 ] }
return map {
  $my-var,
  $other
}
</code></pre>
<p>evaluates to</p>
<pre><code class="language-xquery">map {
  "my-var": &lt;root /&gt;
  "other": map { "a": [ 1, 2, 3 ] }
}
</code></pre>
<p>This is the inverse operation of destructuring a map as proposed in https://github.com/qt4cg/qtspecs/issues/37</p>
<pre><code>let ${my-var, other} := map {
  "my-var": &lt;root /&gt;
  "other": map { "a": [ 1, 2, 3 ] }
}
</code></pre>
<p>In the Slack discussion John Lumley and Liam Quinn raised concerns this construct might be error prone when both methods to construct an entry can be mixed</p>
<pre><code class="language-xquery">  map { $a : $b, $c }
</code></pre>
<pre><code class="language-xquery">map:for-each($m, function ($k, $v as xs:anyAtomic) { map{ $v : $k } }),
map:for-each($m, function ($k, $v as xs:anyAtomic) { map{ $v, $k } })
</code></pre>
</div></details></div>
<div class="toot" id="created-146"><h2>Issue #146 created<span class="toot-id"> #created-146</span></h2><div class="pubdate">18 Sep at 18:57:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/146">https://github.com/qt4cg/qtspecs/issues/146</a></div><details><summary>fn:apply with last two arguments (array, map) for the positional and keyword args in a func-call</summary><div class="markup"><p>The existing <a href="https://www.w3.org/TR/xpath-functions-31/#func-apply"><strong><em>fn:apply() in XPath 3.1</em></strong></a> "Makes a dynamic call on a function with an argument list supplied in the form of an array."</p>
<p>However in XPath 4.0 <strong><em><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-function-calls">a function may have both (required) positional and variadic arguments, expressed as  keyword arguments if the function is map-variadic</a></em></strong>. Thus there are cases when it is impossible to provide the arguments of the function just within an array.</p>
<p><strong>For such cases, we need a new overload</strong>:</p>
<p><code>fn:apply($function as function(*), $array as array(*), $map as map(*)) as item()*</code></p>
<p><strong>The result</strong> of the function is obtained by creating and invoking the same dynamic call that would be the result of  a  function-call to <code>$function</code> with positional arguments taken from the (ordered) members of the supplied array <code>$array</code> and keyword arguments taken from the (unordered) entries (KVPs - keyword-value pairs) of  <code>$map</code>.</p>
<p><strong>The effect of calling</strong> <code>fn:apply($f, [$a, $b, $c, ...], map{"k1" : v1, "k2" : v2, ...})</code> is the same as the effect of the dynamic function call resulting from <code>$function($a, $b, $c, ...., $k1 = v1, $k2 = v2, ...)</code>. The function conversion rules are applied to the supplied arguments in the usual way.</p>
<p><strong>Dependencies</strong></p>
<ol>
<li>
<p>The new overload of <code>fn:apply()</code> is needed <strong><em><a href="https://qt4cg.org/specifications/xquery-40/xpath-40.html#id-function-calls">if we have in XPath 4.0 function calls with both positional and keyword arguments</a></em></strong>. In other words, this proposal supposes (depends on) the existence of this new XPath feature</p>
</li>
<li>
<p>Some newly proposed features, such as <strong><em><a href="https://github.com/qt4cg/qtspecs/issues/106">Function Decorators</a></em></strong>, depend on the existence of this new overload of <code>fn:apply()</code></p>
</li>
</ol>
<p><strong>Example</strong>:</p>
<p>The expression:</p>
<pre><code class="language-xq">let $data := &lt;a b="3"/&gt;
 return
    fn:apply(fn:serialize#2, [$data], map{"method":"xml", "omit-xml-declaration":true()})
</code></pre>
<p>returns:</p>
<p><code>'&lt;a b="3"/&gt;'</code></p>
</div></details></div>
<div class="toot" id="closed-145"><h2>Issue #145 closed<span class="toot-id"> #closed-145</span></h2><div class="pubdate">17 Sep at 13:28:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/145">https://github.com/qt4cg/qtspecs/pull/145</a></div><p>Cleaned up infrastructure</p></div>
<div class="toot" id="created-145"><h2>Pull request #145 created<span class="toot-id"> #created-145</span></h2><div class="pubdate">17 Sep at 13:27:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/145">https://github.com/qt4cg/qtspecs/pull/145</a></div><details><summary>Cleaned up infrastructure</summary><div class="markup"><p>I couldn't leave well enough alone. This "finishes" the conversion to a more modern build system, fixes a number of small editorial issues (incorrect bibliographic links, etc.), and suppresses some warnings by default.</p>
</div></details></div>
<div class="toot" id="closed-144"><h2>Issue #144 closed<span class="toot-id"> #closed-144</span></h2><div class="pubdate">16 Sep at 19:35:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/144">https://github.com/qt4cg/qtspecs/pull/144</a></div><p>Fix links</p></div>
<div class="toot" id="created-144"><h2>Pull request #144 created<span class="toot-id"> #created-144</span></h2><div class="pubdate">16 Sep at 19:30:28 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/144">https://github.com/qt4cg/qtspecs/pull/144</a></div><details><summary>Fix links</summary><div class="markup"><p>My bad. At some point, not too recently, I changed from using /branch/master to hold the current specifications to /specifications. The old links persisted in the index page for qt4cg.org and got (quite reasonably) copied into the README but I didn't notice.</p>
<p>Yesterday, I think, I was cleaning up some things and deleted the stale /branch/master files.</p>
</div></details></div>
<div class="toot" id="agenda-09-20"><h2>QT4 CG meeting 003 draft agenda<span class="toot-id"> #agenda-09-20</span></h2><div class="pubdate">16 Sep at 15:59:58 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/09-20">https://qt4cg.org/meeting/agenda/2022/09-20</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="closed-17"><h2>Issue #17 closed<span class="toot-id"> #closed-17</span></h2><div class="pubdate">15 Sep at 17:04:04 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/17">https://github.com/qt4cg/qtspecs/issues/17</a></div><p>readme</p></div>
<div class="toot" id="closed-138"><h2>Issue #138 closed<span class="toot-id"> #closed-138</span></h2><div class="pubdate">15 Sep at 16:56:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/138">https://github.com/qt4cg/qtspecs/pull/138</a></div><p>Update README.md</p></div>
<div class="toot" id="closed-143"><h2>Issue #143 closed<span class="toot-id"> #closed-143</span></h2><div class="pubdate">15 Sep at 16:53:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/143">https://github.com/qt4cg/qtspecs/pull/143</a></div><p>Infrastructure updates</p></div>
<div class="toot" id="created-143"><h2>Pull request #143 created<span class="toot-id"> #created-143</span></h2><div class="pubdate">15 Sep at 16:51:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/143">https://github.com/qt4cg/qtspecs/pull/143</a></div><details><summary>Infrastructure updates</summary><div class="markup"><p>This PR doesn't make any technical changes (and it probably won't build correctly as a PR, so I'm just going to merge it).</p>
<ol>
<li>I tinkered a little bit with the URIs on the specifications so that they point to more accurate URIs.</li>
<li>I've tried to make a few of the XSLT files "less chatty". I'd like to make it easier to see what the errors and warnings are so that we can resolve them. It's the sort of thing that bugs me, so if no one else does it, I'll probably chip away at them as we go.</li>
<li>I reworked the way that the XPath Functions and XSLT specifications are built. I've pulled the tasks out of the ant files and implemented them directly in Gradle. (The XPath and XQuery specifications are as yet unchanged, they're more complicated and this already took longer than I had anticipated.)</li>
<li>The <code>specification/{specid}/build</code> and <code>specification/{specid}/html</code> directories are no longer used. All of the build and intermediate files are under <code>build</code>. (For XPath Functions and XSLT.)</li>
<li>I stopped trying to build all the namespace documents. Those aren't useful unless they're installed in the "real" URIs and I have no idea if/how we'll be able to update those. When we're closer to the end, I can get the namespace documents building again. For now, it's just faster not to.</li>
</ol>
<p>It's now easier to see what is happening and Gradle will do a better job of managing the dependencies. So if you are building it locally, it should do less work on each build.</p>
<p>Everything should just build the same way it used to. Changes to the sources or the stylesheets should cause the right builds to run. It is, of course, possible that I've broken something. I tried to check everything, but there are a lot of moving pieces here. Comments, questions, and complaints most welcome.</p>
</div></details></div>
<div class="toot" id="closed-142"><h2>Issue #142 closed<span class="toot-id"> #closed-142</span></h2><div class="pubdate">15 Sep at 11:26:17 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/142">https://github.com/qt4cg/qtspecs/pull/142</a></div><p>Improve workflows</p></div>
<div class="toot" id="created-142"><h2>Pull request #142 created<span class="toot-id"> #created-142</span></h2><div class="pubdate">15 Sep at 11:26:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/142">https://github.com/qt4cg/qtspecs/pull/142</a></div><details><summary>Improve workflows</summary><div class="markup"><p>This PR updates the github workflows so that all branches are published and so that the PR path is exposed in the environment.</p>
</div></details></div>
<div class="toot" id="closed-140"><h2>Issue #140 closed<span class="toot-id"> #closed-140</span></h2><div class="pubdate">14 Sep at 14:52:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/140">https://github.com/qt4cg/qtspecs/pull/140</a></div><p>Make agreed changes to fn:all and fn:som functions (NW testing)</p></div>
<div class="toot" id="closed-141"><h2>Issue #141 closed<span class="toot-id"> #closed-141</span></h2><div class="pubdate">14 Sep at 13:15:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/141">https://github.com/qt4cg/qtspecs/pull/141</a></div><p>Fix branch name</p></div>
<div class="toot" id="created-141"><h2>Pull request #141 created<span class="toot-id"> #created-141</span></h2><div class="pubdate">14 Sep at 13:15:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/141">https://github.com/qt4cg/qtspecs/pull/141</a></div><p>Fix branch name</p></div>
<div class="toot" id="created-140"><h2>Pull request #140 created<span class="toot-id"> #created-140</span></h2><div class="pubdate">14 Sep at 13:11:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/140">https://github.com/qt4cg/qtspecs/pull/140</a></div><p>Make agreed changes to fn:all and fn:som functions (NW testing)</p></div>
<div class="toot" id="closed-137"><h2>Issue #137 closed<span class="toot-id"> #closed-137</span></h2><div class="pubdate">14 Sep at 13:04:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/137">https://github.com/qt4cg/qtspecs/pull/137</a></div><p>A copy of Mike's fn-all-some changes for testing</p></div>
<div class="toot" id="closed-139"><h2>Issue #139 closed<span class="toot-id"> #closed-139</span></h2><div class="pubdate">14 Sep at 13:02:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/139">https://github.com/qt4cg/qtspecs/pull/139</a></div><p>Fix markup error introduced yesterday</p></div>
<div class="toot" id="created-139"><h2>Pull request #139 created<span class="toot-id"> #created-139</span></h2><div class="pubdate">14 Sep at 13:01:09 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/139">https://github.com/qt4cg/qtspecs/pull/139</a></div><details><summary>Fix markup error introduced yesterday</summary><div class="markup"><p>A commit yesterday introduced a markup error.</p>
</div></details></div>
<div class="toot" id="created-138"><h2>Pull request #138 created<span class="toot-id"> #created-138</span></h2><div class="pubdate">14 Sep at 12:43:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/138">https://github.com/qt4cg/qtspecs/pull/138</a></div><details><summary>Update README.md</summary><div class="markup"><p>First draft of revising readme.md. I would propose also adding instructions detailing the build process for local builds of the repo.</p>
</div></details></div>
<div class="toot" id="created-137"><h2>Pull request #137 created<span class="toot-id"> #created-137</span></h2><div class="pubdate">14 Sep at 12:05:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/137">https://github.com/qt4cg/qtspecs/pull/137</a></div><details><summary>A copy of Mike's fn-all-some changes for testing</summary><div class="markup"><p>This should create a formatted PR!</p>
</div></details></div>
<div class="toot" id="closed-136"><h2>Issue #136 closed<span class="toot-id"> #closed-136</span></h2><div class="pubdate">14 Sep at 12:02:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/136">https://github.com/qt4cg/qtspecs/pull/136</a></div><p>Workflow changes</p></div>
<div class="toot" id="closed-133"><h2>Issue #133 closed<span class="toot-id"> #closed-133</span></h2><div class="pubdate">14 Sep at 12:01:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/133">https://github.com/qt4cg/qtspecs/pull/133</a></div><p>Norm never plans to merge this, it's a test</p></div>
<div class="toot" id="created-136"><h2>Pull request #136 created<span class="toot-id"> #created-136</span></h2><div class="pubdate">14 Sep at 12:00:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/136">https://github.com/qt4cg/qtspecs/pull/136</a></div><details><summary>Workflow changes</summary><div class="markup"><p>Add two workflows, update the build script to create an index page</p>
</div></details></div>
<div class="toot" id="created-135"><h2>Issue #135 created<span class="toot-id"> #created-135</span></h2><div class="pubdate">13 Sep at 18:21:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/135">https://github.com/qt4cg/qtspecs/issues/135</a></div><details><summary>Arrays' counterparts for functions on sequences, and vice versa</summary><div class="markup"><p>When we have a proposal for a function <code>f1</code> that has a sequence-argument, we need to also have (or propose if not-existent) a corresponding function <code>f2</code> that has an array-argument in place of the <code>f1</code>'s sequence argument.</p>
<p>For example:</p>
<p><code>all($input as item()*, $predicate as function(item()) as xs:boolean)</code></p>
<p>the above function accepts a sequence as its 1st argument. In this case there is no existing function <code>all</code> for arrays, therefore we will define/propose it together with the above function:</p>
<p><code>array:all($input as array(*), $predicate as function(item()*) as xs:boolean))</code></p>
<p>For consistency, clarity and to not confuse the reader of the Spec (for example trying to find why there is no corresponding 2nd function and abuse their imagination) we shall as a rule always provide a pair of such functions: one defined on sequence(s)  and one defined on array(s).</p>
<p>Even if we were not going to propose a new function, but an "orphan" such function already exists, we will add its corresponding 2nd function.</p>
</div></details></div>
<div class="toot" id="minutes-09-13"><h2>QT4 CG meeting 002 draft minutes<span class="toot-id"> #minutes-09-13</span></h2><div class="pubdate">13 Sep at 16:30:29 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/09-13">https://qt4cg.org/meeting/minutes/2022/09-13</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-134"><h2>Pull request #134 created<span class="toot-id"> #created-134</span></h2><div class="pubdate">13 Sep at 17:27:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/134">https://github.com/qt4cg/qtspecs/pull/134</a></div><p>Make agreed changes to fn:all and fn:some functions.</p></div>
<div class="toot" id="created-133"><h2>Pull request #133 created<span class="toot-id"> #created-133</span></h2><div class="pubdate">13 Sep at 16:43:34 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/133">https://github.com/qt4cg/qtspecs/pull/133</a></div><details><summary>Norm never plans to merge this, it's a test</summary><div class="markup"><p>This is a test. This is only a test. Had this been a real emergency, we would have fled in terror and you would not have been informed.</p>
</div></details></div>
<div class="toot" id="agenda-09-13"><h2>QT4 CG meeting 002 draft agenda<span class="toot-id"> #agenda-09-13</span></h2><div class="pubdate">12 Sep at 11:48:44 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/09-13">https://qt4cg.org/meeting/agenda/2022/09-13</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="minutes-09-06"><h2>QT4 CG meeting 001 draft minutes<span class="toot-id"> #minutes-09-06</span></h2><div class="pubdate">06 Sep at 16:38:31 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2022/09-06">https://qt4cg.org/meeting/minutes/2022/09-06</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="created-132"><h2>Issue #132 created<span class="toot-id"> #created-132</span></h2><div class="pubdate">06 Sep at 08:46:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/132">https://github.com/qt4cg/qtspecs/issues/132</a></div><details><summary>Clarify if redirects should be followed</summary><div class="markup"><p>If a user requests a document (using doc, document, unparsed-text, etc) with an HTTP(S) URI, and a redirect response is returned, what should the processor do?</p>
</div></details></div>
<div class="toot" id="agenda-09-06"><h2>QT4 CG meeting 001 draft agenda<span class="toot-id"> #agenda-09-06</span></h2><div class="pubdate">05 Sep at 14:45:39 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2022/09-06">https://qt4cg.org/meeting/agenda/2022/09-06</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-131"><h2>Issue #131 created<span class="toot-id"> #created-131</span></h2><div class="pubdate">23 Aug at 12:49:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/131">https://github.com/qt4cg/qtspecs/issues/131</a></div><details><summary>Expression for binding the Context Value</summary><div class="markup"><p><strong>REVISED:</strong> I’ve incorporated the feedback from the comments (thanks).</p>
<p>We have no expression yet to bind a value to the context value. Such an expression would be useful, among other things, to extend the focus function to sequences (<code>fn { . }</code>, see #129).</p>
<p>Here are 3 possible constructs for that, ordered by my personal preference:</p>
<h3>1. Value Map Expression</h3>
<pre><code class="language-xquery">ValueExpr      ::=  ValidateExpr | ExtensionExpr | ValueMapExpr
ValueMapExpr   ::=  SimpleMapExpr ("~" SimpleMapExpr)*
SimpleMapExpr  ::=  PathExpr ("!" PathExpr)*

(: Example :)
//flower ~ (count(.) || ' flowers: ' || string-join(name, ', '))
</code></pre>
<p>The expression would be similar to the simple map expression (which we could rename to item map expression). The following equivalents would then exist for simple FLWOR expressions:</p>
<pre><code class="language-xquery">for $i in (1 to 5) return string($i)  ≍  (1 to 5) ! string(.)
let $i := (1 to 5) return count($i)   ≍  (1 to 5) ~ count(.)
</code></pre>
<p><code>fn { E }</code> could be rewritten to <code>fn($c) { $c ~ E }</code>.</p>
<h3>2. Context Value Declaration</h3>
<pre><code class="language-xquery">ContextExpr  ::=  "context" "{" Expr "}" EnclosedExpr

(: Example :)
context { //flower } {
  count(.) || ' flowers: ' || string-join(name, ', ')
}
</code></pre>
<p>The result of the first expression defines the context value, the second expression can reference the context.</p>
<p><code>fn { E }</code> could be rewritten to <code>fn($c) { context { $c } { E } }</code>.</p>
<h3>3. Enhanced FLWOR expression (for the sake of completion)</h3>
<p>Similar to variables, the dot could be used to bind and reference the context:</p>
<pre><code class="language-xquery">LetBinding  ::=  ("." | ("$" VarName)) TypeDeclaration? ":=" ExprSingle
ForBinding  ::=  ("." | ("$" VarName)) TypeDeclaration? AllowingEmpty? PositionalVar? "in" ExprSingle

(: Example :)
let . := //flower
return count(.) || ' flowers: ' || string-join(name, ', ')
</code></pre>
<p><code>fn { E }</code> could be rewritten to <code>fn($c) { let . := $c return E }</code>.</p>
<h3>Assessment</h3>
<ul>
<li>The first solution looks most appealing to me. I like the analogy with the existing syntax for single items.</li>
<li>We could choose the second solution if we believe that the expression will be rarely used.</li>
<li>I‘ve backed away from the third solution; I think it would be too pervasive.</li>
</ul>
</div></details></div>
<div class="toot" id="created-130"><h2>Issue #130 created<span class="toot-id"> #created-130</span></h2><div class="pubdate">22 Aug at 12:23:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/130">https://github.com/qt4cg/qtspecs/issues/130</a></div><details><summary>New super/union type xs:binary?</summary><div class="markup"><p>I know we want to avoid in-depth changes in the type system. Still, now that we have <code>xs:numeric</code>, is there an obvious reason why we have no super oder union type for <code>xs:base64Binary</code> and <code>xs:hexBinary</code>? It would simplify the definition of many extensions functions a lot (e.g. in the EXPath Binary or File Module).</p>
</div></details></div>
<div class="toot" id="closed-127"><h2>Issue #127 closed<span class="toot-id"> #closed-127</span></h2><div class="pubdate">19 Aug at 09:50:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/127">https://github.com/qt4cg/qtspecs/issues/127</a></div><p>[XPath] [XQuery] Function items: Align "function" and "-&gt;" </p></div>
<div class="toot" id="created-129"><h2>Issue #129 created<span class="toot-id"> #created-129</span></h2><div class="pubdate">18 Aug at 16:59:16 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/129">https://github.com/qt4cg/qtspecs/issues/129</a></div><details><summary>Context item → Context value?</summary><div class="markup"><p>This has already been discussed before at various places, I’d like to raise it again: What about generalizing the context item and allowing it to reference sequences? Are there definitive showstoppers?</p>
<h3>The Context Item</h3>
<p>As its name says, the context item is a container for a single item in the current context. A value that is bound to the context item is referenced with the <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-context-item-expression">Context Item Expression</a>, the single dot: <code>.</code>.</p>
<p>The context item shares many similarities with variables. The main difference is that it currently cannot be used for sequences. I propose to generalize the semantics and introduce a “context value”:</p>
<ul>
<li>Items that have formerly been bound to the context item (via the Context Item Declaration, within predicates, the simple map operator, path expressions, the <code>transform with</code> expression, etc.) are now bound to the context value.</li>
<li>The revised Context Item Expression returns sequences instead of single items.</li>
<li>We cannot drop context items completely – for example, we have a <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-context-item-declarations">Context Item Declaration</a> in the prolog of XQuery expressions, which uses the <code>item</code> keyword – but we can treat it as a secondary concept.</li>
</ul>
<h3>Context Value Declaration</h3>
<p>It has become a common pattern to use <code>declare context item</code> to bind a document to the context item and process queries on that item:</p>
<pre><code class="language-xquery">declare context item := doc('flowers');
.//flower[name = 'Tigridia']
</code></pre>
<p>If data can be distributed across multiple documents (which is often, if not the standard case, in databases), this approach does not work. It would work if we could bind sequences:</p>
<pre><code class="language-xquery">declare context value := collection('flowers');
.//flower[name = 'Tigridia']
</code></pre>
<h3>External Bindings</h3>
<p>Many processors allow users to bind external values to the context item. This approach is particularly restricting for databases, in which data is often distributed across multiple documents. With the generalized concept, it would get possible to bind sequences and collections to the context. Paths like the following one could be used, no matter if the contents are stored in a single document or in a collection:</p>
<pre><code class="language-xquery">//flower[name = 'Iridaceae']
</code></pre>
<h3>Focus Functions</h3>
<p>The <a href="https://qt4cg.org/specifications/xquery-40/xquery-40.html#id-focus-functions">focus function</a> provides a compact syntax for common arity-one functions. The single argument is bound it to the context item:</p>
<pre><code class="language-xquery">sort($flowers, (), function { @petals })
</code></pre>
<p>With the generalization to values, we could easily enhance focus functions to accept arbitrary sequences:</p>
<pre><code class="language-xquery">array:sort($flower-species, (), function { count(.) })
</code></pre>
<pre><code class="language-xquery">let $flowers := array:join(
  for $flower in //flower
  group by $_ := $flower/name
  return [ $flower ]
)
(: some $p in petals satisfies $p gt 4 :)
return array:filter($flowers, function { petals &gt; 4 })
</code></pre>
<h3>Use Case: Arrow Expressions</h3>
<p>The arrow expression provides an intuitive syntax for performing multiple subsequent operations on a given input. With the context value generalization, we could also process chained sequences:</p>
<pre><code class="language-xquery">//flower[name = 'Psychotria']
=&gt; function { count(.) || ' flower(s) found' }()
</code></pre>
</div></details></div>
<div class="toot" id="created-128"><h2>Issue #128 created<span class="toot-id"> #created-128</span></h2><div class="pubdate">17 Aug at 10:29:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/128">https://github.com/qt4cg/qtspecs/issues/128</a></div><details><summary>fn:replace: Tweaks</summary><div class="markup"><p>Some suggestions for <code>fn:replace</code>:</p>
<h4>A. Simplify/unify retrieval of the replacement value</h4>
<ul>
<li>If <code>$action</code> is present, call the function.</li>
<li>If <code>$replacement</code> is present, obtain its value.</li>
<li>If no argument is present, use the empty sequence.</li>
</ul>
<p>See https://github.com/qt4cg/qtspecs/issues/104#issuecomment-1210506639 for similar replacements in maps and arrays.</p>
<h4>B. Simplify actions by relaxing types:</h4>
<ol>
<li>Pass on matches as <code>xs:untypedAtomic</code> items.</li>
<li>Apply <code>fn:string</code> to the result of the action (or even <code>fn:string-join</code>, if we allow sequences as return values).</li>
</ol>
<h4>C. Always use <code>xs:string?</code> for <code>$flags</code></h4>
<p>…affects <code>fn:matches</code>, <code>fn:tokenize</code>, and <code>fn:analyze-string</code>.</p>
<h4>Resulting function signature</h4>
<pre><code class="language-xquery">fn:replace(
  $value        as xs:string?,
  $pattern      as xs:string,
  $replacement  as xs:string?                                                  := '',
  $flags        as xs:string?                                                  := '',
  $action       as (function(xs:untypedAtomic, xs:untypedAtomic*) as item()?)? := ()
) as xs:string
</code></pre>
<h4>Examples</h4>
<p>…taken from the <a href="https://qt4cg.org/branch/master/xpath-functions-40/Overview-diff.html#func-replace">specification draft</a> and simplified/fixed:</p>
<pre><code class="language-xquery">fn:replace("Chapter 9", "[0-9]+", action := function { . + 1 }),

fn:replace(
  "57°43′30″",
  "([0-9]+)°([0-9]+)′([0-9]+)″",
  action := function($matches) {
    ($matches[1] + $matches[2] div 60 + $matches[3] div 3600) || '°'
  }
)
</code></pre>
</div></details></div>
<div class="toot" id="created-127"><h2>Issue #127 created<span class="toot-id"> #created-127</span></h2><div class="pubdate">16 Aug at 09:40:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/127">https://github.com/qt4cg/qtspecs/issues/127</a></div><details><summary>[XPath] [XQuery] Function items: Align "function" and "-&gt;" </summary><div class="markup"><p>I think that <code>function</code> and <code>-&gt;</code> should be 100% interchangeable:</p>
<pre><code>Current Rule:
[83] InlineFunctionExpr  ::=  (("function"&nbsp;FunctionSignature) | ("-&gt;"&nbsp;FunctionSignature?))&nbsp;FunctionBody

Proposed:
[83] InlineFunctionExpr  ::=  (("function"&nbsp;| "-&gt;") FunctionSignature?) FunctionBody
</code></pre>
<p>And an editorial note: In https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#id-inline-func, the expanded syntax needs to be changed from</p>
<pre><code>function($x as item()} as item()* {$x -&gt; {EXPR}}
</code></pre>
<p>to</p>
<pre><code>function($x as item()} as item()* { $x ! EXPR }
</code></pre>
</div></details></div>
<div class="toot" id="created-126"><h2>Issue #126 created<span class="toot-id"> #created-126</span></h2><div class="pubdate">16 Aug at 09:25:02 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/126">https://github.com/qt4cg/qtspecs/issues/126</a></div><details><summary>Mathematical Operator Unicode Symbols</summary><div class="markup"><p>As <a href="https://www.hanselman.com/blog/monospaced-programming-fonts-with-ligatures">programming fonts with ligatures</a> get more and more common, we should ensure that Unicode symbols that are defined as equivalents for ASCII operators will not be mixed up with ligatures.</p>
<p>In particular, it’s the aliases for value comparisons that I believe should be used for general comparison operators instead:</p>
<ul>
<li><code>≤</code> → <code>&lt;=</code> (instead of<code>le</code>)</li>
<li><code>≥</code> → <code>&gt;=</code> (instead of<code>ge</code>)</li>
<li><code>≠</code> → <code>!=</code> (instead of <code>ne</code>)</li>
<li><code>≐</code>, <code>⋖</code>, <code>⋗</code> …drop them?</li>
</ul>
<p>The full list of the currently defined aliases: https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#id-math-symbols</p>
</div></details></div>
<div class="toot" id="created-125"><h2>Issue #125 created<span class="toot-id"> #created-125</span></h2><div class="pubdate">15 Aug at 10:02:26 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/125">https://github.com/qt4cg/qtspecs/issues/125</a></div><details><summary>array:partition → fn:partition: empty results; examples</summary><div class="markup"><p>1.&nbsp;I think that an empty sequence should be returned if <code>array:partition</code> is invoked with an empty array. See e.g. <code>fn:tokenize('')</code>, which also returns an empty sequence and no zero-character string.</p>
<p>2.&nbsp;The last two example queries need to be revised, e.g. as follows:</p>
<pre><code class="language-xquery">array:partition(
  tokenize("In the beginning was the word"),
  function($previous, $current) { sum(($previous, $current) ! string-length()) gt 10 }
)

array:partition(
  (1, 2, 3, 6, 7, 9, 10),
  function($seq, $new) { not($new = $seq[last()] + 1) }
)
</code></pre>
<p>Maybe an affirming <code>$add-when</code> function is more intuitive than <code>$break-when</code>, in particular for function bodies with sequence operations and general comparisons.</p>
</div></details></div>
<div class="toot" id="closed-10"><h2>Issue #10 closed<span class="toot-id"> #closed-10</span></h2><div class="pubdate">11 Aug at 23:20:11 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/10">https://github.com/qt4cg/qtspecs/issues/10</a></div><p>[FO] fn:filter with a function returning empty sequence</p></div>
<div class="toot" id="closed-61"><h2>Issue #61 closed<span class="toot-id"> #closed-61</span></h2><div class="pubdate">11 Aug at 22:57:10 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/61">https://github.com/qt4cg/qtspecs/issues/61</a></div><p>[FO] fn:all and fn:some have an xs:integer* return type, but describe an xs:boolean return type</p></div>
<div class="toot" id="closed-81"><h2>Issue #81 closed<span class="toot-id"> #closed-81</span></h2><div class="pubdate">11 Aug at 22:46:08 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/81">https://github.com/qt4cg/qtspecs/issues/81</a></div><p>[xslt30] Typo in §4.4</p></div>
<div class="toot" id="closed-102"><h2>Issue #102 closed<span class="toot-id"> #closed-102</span></h2><div class="pubdate">11 Aug at 22:42:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/102">https://github.com/qt4cg/qtspecs/issues/102</a></div><p>[xslt30] Meaning of the term "lexical space"</p></div>
<div class="toot" id="closed-117"><h2>Issue #117 closed<span class="toot-id"> #closed-117</span></h2><div class="pubdate">11 Aug at 22:22:19 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/117">https://github.com/qt4cg/qtspecs/issues/117</a></div><p>Downcasting (relabelling) in the coercion rules</p></div>
<div class="toot" id="closed-120"><h2>Issue #120 closed<span class="toot-id"> #closed-120</span></h2><div class="pubdate">11 Aug at 22:11:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/120">https://github.com/qt4cg/qtspecs/issues/120</a></div><p>Typo:  "stremability"</p></div>
<div class="toot" id="created-124"><h2>Issue #124 created<span class="toot-id"> #created-124</span></h2><div class="pubdate">10 Aug at 19:16:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/124">https://github.com/qt4cg/qtspecs/issues/124</a></div><details><summary>[XPath] [XQuery] Incorrect subtype-itemtype rules for pure and local union types</summary><div class="markup"><p>Looking at https://github.com/qt4cg/qtspecs/issues/122, I've identified a possible gap in the logic for pure union types and <code>LocalUnionTypes</code>. Specifically, the rules are defined for when <code>A</code> is one of these union types but not when <code>B</code> is one of these union types.</p>
<p>That is, under the current 4.0 draft rules:</p>
<ol>
<li><code>subtype-itemtype(union(xs:string, xs:integer), xs:string)</code> is defined and will return false (<code>xs:integer</code> is not a subtype of <code>xs:string</code>).</li>
<li><code>subtype-itemtype(xs:string, union(xs:string, xs:integer))</code> is not defined and will return false even though the union type supports <code>xs:string</code> as one of its member types.</li>
</ol>
<p>Note that in the earlier standard versions, the pure union type case is handled by <code>derives-from(AT, ET)</code>:</p>
<ol>
<li><code>ET</code> is a pure union type of which <code>AT</code> is a member type</li>
</ol>
<p>With <code>derives-from(AT, ET)</code> only being applied in the case when both are atomic types</p>
<h2>Draft Wording</h2>
<ol start="2">
<li><em>Conditions for atomic and union types:</em>
a. <code>A</code> and <code>B</code> are <code>AtomicOrUnionType</code>s, and <code>derives-from(A, B)</code> returns true.
b. <code>A</code> is a <code>LocalUnionType</code> in the form <code>union(T1, T2, ...)</code> and every type <code>T</code> in (<code>T1</code>, <code>T2</code>, ...) satisfies <code>subtype-itemType(T, B)</code>.
c. <code>B</code> is a <code>LocalUnionType</code> in the form <code>union(T1, T2, ...)</code> and any type <code>T</code> in (<code>T1</code>, <code>T2</code>, ...) satisfies <code>subtype-itemType(A, T)</code>.</li>
</ol>
<blockquote>
<p>Design Note: There is no need for a rule when <code>A</code> is a pure union type as that is covered by the "There is a type MT such that derives-from( AT, MT ) and derives-from( MT, ET )" rule for <code>derives-from</code>.</p>
</blockquote>
</div></details></div>
<div class="toot" id="created-123"><h2>Issue #123 created<span class="toot-id"> #created-123</span></h2><div class="pubdate">09 Aug at 17:33:59 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/123">https://github.com/qt4cg/qtspecs/issues/123</a></div><details><summary>fn:duplicate-values</summary><div class="markup"><h3>Motivation</h3>
<p>The new function <code>fn:all-equal</code> can be used for consistency checks (e.g., to verify if IDs are distinct). Often, however, developers rather need to find the actual values that exist more than once. A <code>fn:duplicate-values</code> (or <code>fn:duplicates</code>) function could fill that gap.</p>
<h3>Summary</h3>
<p>Returns values that appear more than once in a sequence. Values are compared according to the rules of the <code>fn:distinct-values</code> function.</p>
<h3>Signature</h3>
<pre><code class="language-xquery">fn:duplicate-values(
  $values     as xs:anyAtomicType*,
  $collation  as xs:string?        := ()
) as xs:anyAtomicType*
</code></pre>
<h3>Use Case</h3>
<p>Find the values of duplicate IDs in a sequence:</p>
<pre><code class="language-xquery">let $ids := duplicate-values(//@id)
where exists($ids)
return error((), 'Duplicate IDs found: ' || string-join($ids, ', '))
</code></pre>
<h3>Examples</h3>
<p>Query | Result
--- | ---
<code>fn:duplicate-values((1, '2', 3.0))</code> | <em>empty sequence</em>
<code>fn:duplicate-values(('id1', 'id10', 'id1'))</code> | <code>id1</code>
<code>fn:duplicate-values((1, 1 to 2, 1 to 3))</code> | <code>1</code>, <code>2</code>
<code>fn:duplicate-values((1, 1.0, 1e0))</code> | <code>1</code> (as with <code>fn:distinct-values</code>, items may be of different type)
<code>fn:duplicate-values(1 to 1000000000000000000)</code> | <em>empty sequence</em>
<code>fn:duplicate-values(())</code> | <em>empty sequence</em></p>
<h3>Equivalent Expression</h3>
<pre><code class="language-xquery">for $group in $values
group by $value := $group (: collation 'value of $collation' :)
where count($group) &gt; 1
return $value
</code></pre>
<h3>Advantages vs. Drawbacks</h3>
<p>+&nbsp;simple and intuitive to understand as proposed
+&nbsp;behavior analogous to <code>distinct-values</code>
– narrow focus (similar as <code>distinct-values</code>)
–&nbsp;“yet another convenience function”</p>
<p>Maybe it boils down to if we want to have more easy-to-use convenience functions, or if we rather wish to keep the set of functions limited.</p>
</div></details></div>
<div class="toot" id="created-122"><h2>Issue #122 created<span class="toot-id"> #created-122</span></h2><div class="pubdate">09 Aug at 12:20:01 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/122">https://github.com/qt4cg/qtspecs/issues/122</a></div><details><summary>Support general union sequence types</summary><div class="markup"><h1>Use Case</h1>
<p>There are a number of cases where it is beneficial to define a type more precisely (specifically in parameters and return types) as a union of item or sequence types, for example:</p>
<ol>
<li>a binary type over <code>xs:hexBinary</code> and <code>xs:base64Binary</code>;</li>
<li>an element that accepts <code>ol</code> or <code>ul</code> html list element names;</li>
<li>an options parameter that accepts strings (<code>xs:string*</code>) an element (<code>element(options)</code>) or a map;</li>
<li>a function that takes JSON types (map, array, xs:integer, xs:decimal, xs:string).</li>
</ol>
<p>There are a number of MarkLogic APIs that make use of this. Several EXPath and EXQuery specifications can take advantage of this. I've also used this in my XQuery IntelliJ plugin when defining vendor APIs that have changed over the different versions.</p>
<h1>Examples</h1>
<pre><code>(: BaseX API change in 8.5 :)
declare function archive:options($archive as xs:base64Binary)
     as (element(archive:options) | map(*)) external;

declare function html:list($list as (element(ol) | element(ul))) { ... };

(: https://docs.marklogic.com/cts:classify -- MarkLogic defines this as `(element() | map:map)?` :)
declare function cts:classify($data-nodes as node()*,
                              $classifier as element(cts:classifier),
                              $options as (element()? | map:map?))
     as element(cts:label)* external;

(: https://docs.marklogic.com/cts:search :)
declare function cts:search($expression as node()*,
                            $query as cts:query?,
                            $options as (cts:order* | xs:string*))
     as node()* external;
</code></pre>
<h1>Existing Support</h1>
<ol>
<li><a href="https://qt4cg.org/branch/master/xquery-40/xquery-40.html#id-local-union-types">Local Union Types</a> -- This handles support for unions over atomic types.</li>
<li>https://github.com/qt4cg/qtspecs/issues/23 -- This provides a more concise syntax for unions over element or attribute names.</li>
<li><a href="https://www.w3.org/TR/xquery-semantics/#doc-fs-Type">Types</a> -- The Formal Semantics specification defines union types.</li>
<li><a href="https://rhdunn.github.io/xquery-intellij-plugin/specifications/XQuery%20IntelliJ%20Plugin%20XQuery.html#2126-sequence-types">Sequence Type Union</a> -- This is the definition in my XQuery IntelliJ plugin.</li>
</ol>
<p>Note: Due to <code>SequenceTypeUnion</code> being present in typeswitch expressions XQuery implementations will have existing code to handle matching these unioned types.</p>
<h1>Syntax</h1>
<h2>3.4 Sequence Types</h2>
<pre><code>SequenceTypeUnion ::= SequenceType  ("|"  SequenceType)*
SequenceType ::= EmptySequenceType | (ItemType OccurrenceIndicator?) | ParenthesizedSequenceType
EmptySequenceType ::= "empty-sequence" "(" ")"
ParenthesizedSequenceType ::= "(" SequenceTypeUnion ")"
ItemType ::= AnyItemTest | TypeName | KindTest | FunctionTest | MapTest | ArrayTest |
             AtomicOrUnionType | RecordTest | LocalUnionType | EnumerationType
</code></pre>
<blockquote>
<p>Design Note: <code>SequenceTypeUnion</code> is an existing BNF symbol used in typeswitch expressions that is unchanged in this issue.</p>
</blockquote>
<h2>3.6 Item Types</h2>
<pre><code>ItemTypeUnion ::= ItemType  ("|"  ItemType)*
ParenthesizedItemType ::= "("  ItemTypeUnion  ")"
ParenthesizableItemType ::= ItemType | ParenthesizedItemType
</code></pre>
<blockquote>
<p>Design Note: <code>ItemTypeUnion</code> mirrors <code>SequenceTypeUnion</code>, allowing the non-sequence unions to be used in the contexts where only item types are allowed. Implementations can make use of the <code>SequenceTypeUnion</code> logic after the syntax/parser validates the item type restriction in those contexts.</p>
</blockquote>
<blockquote>
<p>Design Note: An alternative to this -- in order to minimize grammar changes -- would be to replace the <code>ItemType</code> with an <code>ItemTypeBase</code> symbol (or appropriately named alternative), and then define <code>ItemType</code> accordingly:
<code>ItemTypeBase ::= AnyItemTest | TypeName | KindTest | ...</code>
<code>ItemTypeUnion ::= ItemTypeBase  ("|"  ItemTypeBase)*</code>
<code>ItemType ::= ItemTypeBase | ParenthesizedItemType</code>
<code>SequenceType ::= EmptySequenceType | (ItemTypeBase OccurrenceIndicator?) | ParenthesizedSequenceType</code></p>
</blockquote>
<h2>Other Changes</h2>
<blockquote>
<p>Design Notes: If <code>ItemType</code> is changed to <code>ParenthesizableItemType</code>, these are the other areas in the current XPath/XQuery 4.0 grammar that need changing.</p>
</blockquote>
<pre><code>ContextItemDecl ::= "declare"  "context"  "item"  ("as"  ParenthesizableItemType)?
                    ((":="  VarValue)  |  ("external"  (":="  VarDefaultValue)?))
ItemTypeDecl ::= "item-type" EQName "as" ParenthesizableItemType
TypedMapTest ::= "map" "(" ParenthesizableItemType "," SequenceType ")"
LocalUnionType ::= "union" "(" ParenthesizableItemType ("," ParenthesizableItemType)* ")"
</code></pre>
<h1>Text</h1>
<h2>4.22.2 Typeswitch</h2>
<p>The <em>effective case</em> definition is defined as:</p>
<blockquote>
<p>The effective case in a typeswitch expression is the first case clause in which the value of the operand expression matches a <a href="https://www.w3.org/TR/xquery-31/#doc-xquery31-SequenceType">SequenceType</a> in the <a href="https://www.w3.org/TR/xquery-31/#doc-xquery31-SequenceType">SequenceTypeUnion</a> of the case clause, using the rules of <a href="https://www.w3.org/TR/xquery-31/#dt-sequencetype-matching">SequenceType matching</a>.</p>
</blockquote>
<p>In order to make that fit this proposal, the wording should be updated to something like:</p>
<blockquote>
<p>The effective case in a typeswitch expression is the first case clause in which the value of the operand expression matches the <a href="https://www.w3.org/TR/xquery-31/#doc-xquery31-SequenceType">SequenceTypeUnion</a> of the case clause, using the rules of <a href="https://www.w3.org/TR/xquery-31/#dt-sequencetype-matching">SequenceType matching</a>.</p>
</blockquote>
<h2>3.7.2 The judgement subtype-itemtype(A, B)</h2>
<p>Section (2) <em>Conditions for atomic and union types:</em> should add the following rules:</p>
<ol>
<li><code>A</code> is an <code>ItemTypeUnion</code> in the form <code>(T1 | T2 | ...)</code> and every type <code>T</code> in (<code>T1</code>, <code>T2</code>, ...) satisfies <code>subtype-itemType(T, B)</code>.</li>
<li><code>B</code> is an <code>ItemTypeUnion</code> in the form <code>(T1 | T2 | ...)</code> and any type <code>T</code> in (<code>T1</code>, <code>T2</code>, ...) satisfies <code>subtype-itemType(A, T)</code>.</li>
</ol>
<h2>3.7.1 The judgement subtype(A, B)</h2>
<p>The first paragraph in this section shall be replaced by:</p>
<p>The judgement <code>subtype(A, B)</code> determines if the <a href="https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#dt-sequence-type">sequence type</a> <code>A</code> is a <a href="https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#dt-subtype">subtype</a> of the sequence type <code>B</code>. <code>A</code> can either be <code>empty-sequence()</code>, <code>xs:error</code>, an <a href="https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#doc-xquery40-ItemType">ItemType</a>, <code>Ai</code>, possibly followed by an occurrence indicator, or a <code>SequenceTypeUnion</code>. Similarly <code>B</code> can either be <code>empty-sequence()</code>, <code>xs:error</code>, an <a href="https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#doc-xquery40-ItemType">ItemType</a>, <code>Bi</code>, possibly followed by an occurrence indicator, or a <code>SequenceTypeUnion</code>.</p>
<p>The result of the <code>subtype(A, B)</code> judgement can be determined as follows:</p>
<ol>
<li>If <code>A</code> is a <code>SequenceTypeUnion</code> in the form <code>(T1 | T2 | ...)</code> and every type <code>T</code> in (<code>T1</code>, <code>T2</code>, ...) satisfies <code>subtype(T, B)</code>, then <code>subtype(A, B)</code> is true.</li>
<li>If <code>B</code> is a <code>SequenceTypeUnion</code> in the form <code>(T1 | T2 | ...)</code> and any type <code>T</code> in (<code>T1</code>, <code>T2</code>, ...) satisfies <code>subtype(A, T)</code>, then <code>subtype(A, B)</code> is true.</li>
<li>Otherwise, the result of the subtype(A, B) judgement can be determined from the table below, which makes use of the auxiliary judgement subtype-itemtype(Ai, Bi) defined in <a href="https://qt4cg.org/branch/master/xquery-40/xquery-40-diff.html#id-itemtype-subtype">3.7.2 The judgement subtype-itemtype(A, B) </a>.</li>
</ol>
</div></details></div>
<div class="toot" id="closed-103"><h2>Issue #103 closed<span class="toot-id"> #closed-103</span></h2><div class="pubdate">09 Aug at 09:24:12 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/103">https://github.com/qt4cg/qtspecs/issues/103</a></div><p>fn:all, fn:some</p></div>
<div class="toot" id="created-121"><h2>Issue #121 created<span class="toot-id"> #created-121</span></h2><div class="pubdate">08 Aug at 19:58:48 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/121">https://github.com/qt4cg/qtspecs/issues/121</a></div><details><summary>[FO] fn:nl, fn:tab, fn:cr</summary><div class="markup"><p>The most popular custom functions in BaseX, and the most boring ones, allow users to insert new line and tab characters. It would be nice to see official variants added to the spec:</p>
<p>Function | Returned character
--- | ---
<code>fn:nl() as xs:string</code> | end of line (<code>&amp;#10;</code>, <code>&amp;NewLine;</code>)
<code>fn:tab() as xs:string</code> | character tabulation (<code>&amp;#9;</code>, <code>&amp;Tab;</code>)
<code>fn:cr() as xs:string</code> | carriage return (<code>&amp;#13;</code>)</p>
<p>The third function can possibly be dropped.</p>
</div></details></div>
<div class="toot" id="created-120"><h2>Issue #120 created<span class="toot-id"> #created-120</span></h2><div class="pubdate">25 Jul at 13:14:18 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/120">https://github.com/qt4cg/qtspecs/issues/120</a></div><details><summary>Typo:  "stremability"</summary><div class="markup"><p>I noticed it in <code>3.5.3.3 Overriding Components from a Used Package</code>.</p>
</div></details></div>
<div class="toot" id="created-119"><h2>Issue #119 created<span class="toot-id"> #created-119</span></h2><div class="pubdate">16 Jul at 22:25:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/119">https://github.com/qt4cg/qtspecs/issues/119</a></div><details><summary>Allow a map's key value to be any sequence</summary><div class="markup"><p>Since being introduced in XSLT 3.0 and later in XPath 3.1 the <strong><em><a href="https://www.w3.org/TR/xpath-functions-31/#maps-and-arrays">map</a></em></strong> datatype has become a powerful and expressive tool for programming in XPath.</p>
<p>At present the value of a key of a map can be <strong><em><a href="https://www.w3.org/TR/xpath-functions-31/#maps-and-arrays">"an arbitrary atomic value"</a></em></strong>, thus a sequence of zero or more than one atomic items cannot be used in a map-key specification.</p>
<p>Besides giving us an almost <code>1 : 1</code> correspondence to a <code>JSON</code> object (when used with arrays, which themselves can be thought of as maps) maps are useful for expressing the tabular representation of a function that has one argument of type  <code>xs:anyAtomicType</code>.</p>
<p>It is not possible using a map to naturally express the tabular representation of a function having two or more (or 0) arguments. While something like this can be done using nested maps as in the example below, this technique is cumbersome and error-prone even when having two arguments, and almost prohibitively difficult when applied to expressing functions with more than 2 arguments.</p>
<p>Here is how we could express one possible tabular form of the function <code>M**N</code> (<code>M</code> to the power of <code>N</code>), where the two arguments are of type <code>xs:positiveInteger</code>:</p>
<pre><code class="language-xq">let $m1 := map {1 : 1, 2 : 2, 3 : 3, 4 : 4, 5 : 5, 6 : 6, 7 : 7, 8 :  8, 9 : 9, 10 :10},
    $m2 := map {1 : 1, 2 : 4, 3 : 9, 4 : 16, 5 : 25, 6 : 36, 7 : 49, 8 : 64, 9 : 81, 10 :100},
    $m3 := map {1 : 1, 2 : 8, 3 : 27, 4 : 64, 5 : 125, 6 : 216, 7 : 343, 8 : 512, 9 : 729, 10 :1000},
    (:  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  .  . :)  
  
    $M := map{ 1: $m1,  2: $m2,  3: $m3 (: ... :)  }
  return $M(3)(4)
</code></pre>
<p>Here evaluating <code>$M(3)(4)</code> produces the value <code>4**3</code> (<code>4</code> to the power of <code>3</code>), that is:
<code>64</code></p>
<p><strong><em>This proposal is to expand the allowed value-space for a key of a map to any sequence.</em></strong></p>
<p>Thus one will be able to write:</p>
<pre><code class="language-xq">let $M := map{ (2, 2) : 4, (3, 2) : 9, (: . . . :)
               (2, 3) : 8, (3, 3) : 27 (: . . . :)
}
 return
    $M((2, 3))
</code></pre>
<p>And evaluating this returns the correct result <code>8</code>.</p>
<p><strong>Possible implementation</strong>:
The implementation is very straightforward: just use in <strong><em><a href="https://www.w3.org/TR/xpath-functions-31/#func-same-key">op:same-key</a></em></strong> as comparison function an improvement of <strong><a href="https://www.w3.org/TR/xpath-functions-31/#func-deep-equal"><code>fn:deep-equal()</code></a></strong>, which has similar behavior, but never throws errors, is context-free, error-free and transitive. Due to lack of fantasy I called this function <strong><code>deep-equal-safe()</code></strong> and its description is <strong><a href="https://github.com/dnovatchev/FXSL-XSLT2/blob/master/fn-deep-equal-safe.pdf">here</a></strong></p>
<p><strong>Note</strong>:
No new datatypes and no changes to the XDM are necessary in order to implement this proposal.</p>
</div></details></div>
<div class="toot" id="created-118"><h2>Issue #118 created<span class="toot-id"> #created-118</span></h2><div class="pubdate">21 Jun at 16:38:15 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/118">https://github.com/qt4cg/qtspecs/issues/118</a></div><details><summary>xsl:match - can we do better</summary><div class="markup"><p>The draft spec proposes an instruction xsl:match to test whether a given item matches a specified pattern, returning a boolean.</p>
<p>While this fills a gap, it's rather clumsy, especially because instructions that return atomic values typically have to be wrapped in xsl:variable or xsl:function to be useful.</p>
<p>It might be better to try and make xsl:apply-templates work more nicely as a function.</p>
<p>The current <code>&lt;xsl:match select="N" match="P"/&gt;</code> is roughly equivalent to <code>&lt;xsl:apply-template mode="test-pattern" select="N"/&gt;</code> where</p>
<pre><code>&lt;xsl:mode name="test-pattern" as="xs:boolean"&gt;
   &lt;xsl:template match="P"&gt;&lt;xsl:sequence select="true()"/&gt;&lt;/xsl:template&gt;
   &lt;xsl:template match="."&gt;&lt;xsl:sequence select="false()"/&gt;&lt;/xsl:template&gt;
&lt;/xsl:mode&gt;
</code></pre>
<p>Can we improve this?</p>
<p>(a) we could allow <code>&lt;xsl:mode name="test-pattern" function-name="my:test"/&gt; </code> so that a function call <code>my:test(XXX)</code> is equivalent to the instruction <code>&lt;xsl:apply-templates mode="test-pattern" select="X"/&gt;</code>: that is, each mode can declare the name of a function whose effect is to apply templates in that mode (with no parameters).</p>
<p>(b) we could allow a <code>select</code> attribute on xsl:template to provide a quick way of returning the result, avoiding xsl:sequence.</p>
<p>(c) we could allow <code>&lt;xsl:mode on-no-match="return false()"/&gt;</code> to avoid the fallback template rule.</p>
<p>The use-case would then become</p>
<pre><code>&lt;xsl:mode name="test-pattern" as="xs:boolean" on-no-match="return false()" function-name="my:test"&gt;
   &lt;xsl:template match="P" select="true()"/&gt;
&lt;/xsl:mode&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-117"><h2>Issue #117 created<span class="toot-id"> #created-117</span></h2><div class="pubdate">21 Jun at 16:16:30 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/117">https://github.com/qt4cg/qtspecs/issues/117</a></div><details><summary>Downcasting (relabelling) in the coercion rules</summary><div class="markup"><p>The proposed coercion rules (aka function conversion rules) permitting down-casting (aka "relabelling") introduce a backwards incompatibility.</p>
<p>For example in XSLT3 test case as-1711 we have</p>
<pre><code>  &lt;xslt:variable name="var1" select="/doc-schemaas/elem-NMTOKEN" as="xs:token"/&gt;

   &lt;xslt:template match="/doc-schemaas"&gt;
            &lt;xslt:value-of select="$var1 instance of xs:NMTOKEN"/&gt;
   &lt;/xslt:template&gt; 
</code></pre>
<p>where the result of atomising elem-NMTOKEN is of type xs:NMTOKEN.</p>
<p>Under the new rules this is "relabelled" as xs:token, causing the "instance of" test to return false, where in XSLT 2.0/3.0 it returned true.</p>
<p>I think the relabelling rules should probably be amended so that if the supplied value is already an instance of the required type, no relabelling takes place - it retains its existing type.</p>
</div></details></div>
<div class="toot" id="created-116"><h2>Issue #116 created<span class="toot-id"> #created-116</span></h2><div class="pubdate">19 May at 09:52:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/116">https://github.com/qt4cg/qtspecs/issues/116</a></div><details><summary>Clarify the fn:transform function() wrt multiple top-level elements</summary><div class="markup"><p>The <code>fn:transform</code> function should clarify the expected behavior when the stylesheet node passed in has two top-level <code>xsl:stylesheet</code> elements.</p>
<p>Personally, I think this should be an error.</p>
</div></details></div>
<div class="toot" id="created-115"><h2>Issue #115 created<span class="toot-id"> #created-115</span></h2><div class="pubdate">04 May at 18:55:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/115">https://github.com/qt4cg/qtspecs/issues/115</a></div><details><summary>Lookup operator on arrays of maps</summary><div class="markup"><p>I've been converting the XMark data files and queries from XML to JSON.</p>
<p>Here's part of Q20 in its XML form:</p>
<pre><code> &lt;preferred&gt;
  {count (/site/people/person/profile[@income &gt;= 100000])}
 &lt;/preferred&gt;
</code></pre>
<p>which becomes this, when we access the JSON form of the data:</p>
<pre><code> &lt;preferred&gt;
  {count (?people?*?profile[?income &gt;= 100000])}
 &lt;/preferred&gt;
</code></pre>
<p>It can get worse, for example Q16 has</p>
<p><code>exists ($a?annotation?description?parlist?*?parlist?*?text?*?emph?*?keyword?*?("§")) </code></p>
<p>These paths arise because a structured derived from JSON often includes map entries whose values are arrays.</p>
<p>It's very hard to get these paths right, and it's hard to produce good diagnostics when you get them wrong.</p>
<p>I'd like to allow the <code>?*?</code> "operators" to be replaced with a simple "?". This isn't difficult. Currently the rules for the lookup operator say:</p>
<pre><code>If the context item is an array:
If the [KeySpecifier] is an NCName, the [UnaryLookup](https://www.w3.org/TR/xpath-31/#doc-xpath31-UnaryLookup) operator raises a type error 
</code></pre>
<p>All that's needed is to change this to say that if the context item is an array, and the KeySpecifier is an NCName, then the array must be an array of maps and the lookup is applied to these maps.</p>
</div></details></div>
<div class="toot" id="created-114"><h2>Issue #114 created<span class="toot-id"> #created-114</span></h2><div class="pubdate">04 May at 11:07:20 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/114">https://github.com/qt4cg/qtspecs/issues/114</a></div><details><summary>[fo] array:index-where</summary><div class="markup"><p>There is a need for an <code>array:index-where()</code> function to operate on arrays in the same way as <code>fn:index-where()</code> operates on sequences/</p>
<p>Use case: consider XMark query Q4, which uses the <code>&lt;&lt;</code> operator:</p>
<pre><code>(: Q4. List the reserves of those open auctions where a
       certain person issued a bid before another person. :)

for    $b in /site/open_auctions/open_auction
where  $b/bidder/personref[@person="person18829"] &lt;&lt;
            $b/bidder/personref[@person="person10487"]
return &lt;history&gt;{ $b/reserve }&lt;/history&gt;
</code></pre>
<p>With the bidders held in an array like this:</p>
<pre><code>     "bidders": [
        { "increase":18, "time":"13:16:15", "date":"2001-06-13", "personref":"person0" },
        { "increase":12, "time":"11:29:44", "date":"2000-09-18", "personref":"person23" },
        { "increase":18, "time":"10:23:59", "date":"1998-01-07", "personref":"person14" },
        { "increase":4.5, "time":"14:00:39", "date":"2001-07-10", "personref":"person16" }
      ],
</code></pre>
<p>the best way of expressing this query seems to be:</p>
<pre><code>for    $b in ?open_auctions?*
let    $bidders := $b?bidders
where  array:index-where($bidders, -&gt;($bidder) {$bidder?personref="person18829"}) &lt;
            array:index-where($bidders, -&gt;($bidder) {$bidder?personref="person10487"})
return &lt;history&gt;{ $b?reserve }&lt;/history&gt;
</code></pre>
</div></details></div>
<div class="toot" id="created-113"><h2>Issue #113 created<span class="toot-id"> #created-113</span></h2><div class="pubdate">04 May at 07:53:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/113">https://github.com/qt4cg/qtspecs/issues/113</a></div><details><summary>[xslt] Constructing arrays</summary><div class="markup"><p>I've felt for a while that the current proposal for xsl:array is messy. It's both semantically and syntactically messy with it's <code>composite=yes|no</code> attribute and the <code>xsl:array-member</code> child. I've been using it doing XML to JSON conversion and you get a lot of stuff like this:</p>
<pre><code>&lt;xsl:template match="closed_auctions"&gt;
      &lt;xsl:array&gt;
         &lt;xsl:for-each select="closed_auction"&gt;
            &lt;xsl:map&gt;
               &lt;xsl:apply-templates select="*"/&gt;
            &lt;/xsl:map&gt;
         &lt;/xsl:for-each&gt;
      &lt;/xsl:array&gt;
   &lt;/xsl:template&gt;
</code></pre>
<p>Almost invariably, xsl:array has xsl:for-each or xsl:apply-templates as a child. So how about allowing:</p>
<pre><code>&lt;xsl:template match="closed_auctions"&gt;
         &lt;xsl:for-each select="closed_auction" form="array"&gt;
            &lt;xsl:map&gt;
               &lt;xsl:apply-templates select="*"/&gt;
            &lt;/xsl:map&gt;
         &lt;/xsl:for-each&gt;
   &lt;/xsl:template&gt;
</code></pre>
<p>The semantics here is that xsl:for-each delivers an array in which there is one member for each item in the input sequence. This cleanly eliminates the need for <code>composite=yes|no</code> and <code>xsl:array-member</code>: you can create a "composite" array using</p>
<pre><code>&lt;xsl:for-each select="1 to 5" form="array"&gt;
   &lt;xsl:sequence select="., .+1"/&gt;
&lt;/xsl:for-each&gt;
</code></pre>
<p>which delivers <code>[(1,2), (2,3), (3,4), (4,5), (5,6)]</code>.</p>
<p>The attribute <code>form="array"</code> can also appear on <code>xsl:apply-templates</code> and <code>xsl:for-each-group</code>. In the latter case each group produces one member of the resulting array:</p>
<pre><code>&lt;xsl:for-each-group select="0 to 9" group-adjacent="0 idiv 5" form="array"&gt;
   &lt;xsl:sequence select="current-group()"/&gt;
&lt;/xsl:for-each-group&gt;
</code></pre>
<p>delivers <code>[(0,1,2,3,4), (5,6,7,8,9)]</code></p>
<p>The attribute <code>form="sequence"</code> is the default and specifies the current behaviour.</p>
<p>I've been wondering also about extending this to <code>form="map"</code>. In most cases when you construct a map from an input sequence, both the key and the value are functions of the input item. So instead of:</p>
<pre><code>&lt;xsl:template match="regions"&gt;
      &lt;xsl:map&gt;
         &lt;xsl:for-each select="*"&gt;
            &lt;xsl:map-entry key="name()"&gt;
               &lt;xsl:array&gt;
                  &lt;xsl:for-each select="item"&gt;
                     &lt;xsl:array-member&gt;
                        &lt;xsl:apply-templates select="."/&gt;
                     &lt;/xsl:array-member&gt;
                  &lt;/xsl:for-each&gt;
               &lt;/xsl:array&gt;
            &lt;/xsl:map-entry&gt;
         &lt;/xsl:for-each&gt;
      &lt;/xsl:map&gt;
   &lt;/xsl:template&gt;
</code></pre>
<p>we could write:</p>
<pre><code>&lt;xsl:template match="regions"&gt;
         &lt;xsl:for-each select="*" form="map" key="name()"&gt;
                  &lt;xsl:apply-templates select="item" form="array"/&gt;
         &lt;/xsl:for-each&gt;
 &lt;/xsl:template&gt;
</code></pre>
<p>which strikes me as an improvement...</p>
</div></details></div>
<div class="toot" id="created-112"><h2>Issue #112 created<span class="toot-id"> #created-112</span></h2><div class="pubdate">30 Mar at 15:28:37 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/112">https://github.com/qt4cg/qtspecs/issues/112</a></div><details><summary>Abbreviate `map:function($someMap)` to `$someMap?function()`</summary><div class="markup"><p>The title says it all.</p>
<p>We already have a proposal to be able to have (when <code>$m</code> is a map and <code>$x</code> is a variable of type <code>xs:string</code>):</p>
<pre><code class="language-xq">$m?$x
</code></pre>
<p>instead of: <code>map:get($m, $x)</code></p>
<p>The next logical step is to allow the RHS of the <code>?</code> operator to be any of the standard functions in the namespace "http://www.w3.org/2005/xpath-functions/map" (with the standard prefix "map:".</p>
<p>Thus, instead of <code>map:keys($m)</code>  or <code>$m =&gt; map:keys()</code></p>
<p>One would simply write:</p>
<p><code>$m?keys()</code></p>
</div></details></div>
<div class="toot" id="created-111"><h2>Issue #111 created<span class="toot-id"> #created-111</span></h2><div class="pubdate">04 Feb at 23:02:52 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/111">https://github.com/qt4cg/qtspecs/issues/111</a></div><details><summary>FLWOR tracing</summary><div class="markup"><p>I've been developing a complex query involving grouping, windowing, and sorting, and finding it very hard to debug.</p>
<p>I propose a new clause that can be included anywhere in a FLWOR expression</p>
<p><code>TraceClause ::= "trace" Expr</code></p>
<p>for example</p>
<pre><code>for $item in //items
trace "input: ", $item/@id
group by $sku := $item/sku
trace "group: ", data($sku), " items: ", data($item/@id)
return count($item) 
</code></pre>
<p>As with fn:trace(), the precise output is implementation-dependent.</p>
<p>The trace clause passes the incoming tuple stream unchanged to the next clause in the pipeline, with the side effect of evaluating an expression in the context of the variables defined in that tuple stream and displaying the value of the expression in an implementation-defined way.</p>
</div></details></div>
<div class="toot" id="created-110"><h2>Issue #110 created<span class="toot-id"> #created-110</span></h2><div class="pubdate">23 Jan at 11:20:13 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/110">https://github.com/qt4cg/qtspecs/issues/110</a></div><details><summary>JSON templates</summary><div class="markup"><h3>JSON templates</h3>
<p>JSON templates are introduced as a convenient way of constructing maps and arrays, especially for use in a stylesheet designed to deliver serialised JSON output (but not restricted to that use case).</p>
<p>A new kind of XPath expression called a JSON template is introduced. The following specification is informal.</p>
<p>The syntax is</p>
<p><code>json-template ::= "[#" parameterized-json "#]"</code></p>
<p>The syntax of <code>parameterised-json</code> is a modified form of the JSON syntax.</p>
<p>There are three modifications:</p>
<p>(a) single quotes can be used instead of double-quotes</p>
<p>(b) wherever a JSON value is permitted (including a string used as a key), we allow a parenthesised XPath expression</p>
<p>For example</p>
<pre><code>{ "sum": ($x + $y),
  "difference": ($x - $y),
  ($extra) : true }

</code></pre>
<p>The rules for what the XPath expression may return are essentially the same as the JSON serialization rules, except that if the value is a node, it is atomised rather than serialized.</p>
<p>(c) within an array, wherever an array element may appear, we allow the syntax "*(" expression ")") to deliver a sequence of array elements. For example</p>
<p><code>[ 1, 2, *(5 to 10)]</code></p>
<p>returns the array [1, 2, 3, 5, 6, 7, 8, 9, 10]</p>
<p>Similarly, within an object, wherever a member may appear, we allow the syntax "*(" expression ")") to deliver a sequence of members. The XPath expression must deliver a map or sequence of maps, whose entries are used as the members of the target object. For example</p>
<p><code>{ "A":1, "B":2, *(//book ! map{isbn : price}) } </code>
Entries with duplicate keys result in an error.</p>
<p>Note: an XPath expression appearing within a json-template may of course contain nested json-templates.</p>
<p>JSON templates can be embedded in XPath using the syntax "[#" parameterized-json "#]", and we also allow them to be embedded in XSLT using the instruction:</p>
<p><code>&lt;xsl:json-template&gt; parameterized-json &lt;/xsl:json-template&gt;</code></p>
</div></details></div>
<div class="toot" id="created-109"><h2>Issue #109 created<span class="toot-id"> #created-109</span></h2><div class="pubdate">20 Jan at 20:40:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/109">https://github.com/qt4cg/qtspecs/issues/109</a></div><details><summary>[xslt4] xsl:note for structured documentation</summary><div class="markup"><p>I propose that we add an element <code>xsl:note</code> whose intended use is for structured documentation.</p>
<p>The element may appear anywhere and may have any attributes and content, including elements in the XSLT namespace. Any <code>xsl:note</code> elements in the stylesheet are stripped (together with their attributes and descendants) at the same time as comments and processing instructions are stripped. (Rules such as "xsl:param must come first" or "xsl:apply-imports must be empty" thus apply to the stylesheet AFTER <code>xsl:note</code> elements are stripped.)</p>
<p>Traditionally, structured documentation comments have been written in a third-party namespace. This approach has two disadvantages:</p>
<p>(a) they can only appear in a limited number of places (typically as children of <code>xsl:stylesheet</code>)</p>
<p>(b) they require an extra namespace to appear on the <code>xsl:stylesheet</code> element, and this namespace has semantics that affect the stylesheet execution. It even needs to be carried through to run-time, in case someone (for example) tries to cast a dynamic string to a QName.</p>
<p>The spec would say very little about <code>xsl:note</code>, except that it is permitted and ignored by the XSLT processor. It might offer some usage suggestions:</p>
<p>(a) an <code>xsl:note</code> appearing as the first child of <code>xsl:package</code> or <code>xsl:stylesheet</code> should be taken as pertaining to the package or stylesheet as a whole; an <code>xsl:note</code> appearing anywhere else should be taken as pertaining to the first following sibling element that is not an xsl:note (if there is one)</p>
<p>(b) third party software that takes account of <code>xsl:note</code> (for example, a tool that generates documentation) should only recognise xsl:note elements that specify target=XXX where XXX is a string that they decide upon.</p>
<p>(c) XSLT processors are discouraged from using xsl:note elements to modify the behaviour of the processor in any way, for example in ways that change the output or the performance; they are expressly not allowed to use xsl:note elements to trigger non-conformant behaviour.</p>
</div></details></div>
<div class="toot" id="created-108"><h2>Issue #108 created<span class="toot-id"> #created-108</span></h2><div class="pubdate">19 Jan at 08:30:58 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/108">https://github.com/qt4cg/qtspecs/issues/108</a></div><details><summary>Template match using values of [tunnel] parameters</summary><div class="markup"><p>It would often be useful to make a template match conditional on the values of the supplied parameters, especially tunnel parameters.</p>
<p>This is especially the case when matching JSON-derived structures (maps and arrays), as no context information is then available via the ancestor axis.</p>
<p>Obviously, the parameters are not in scope within the match pattern, and I don't propose to change that. Instead I propose that xsl:param (when used in a template rule) should have a <code>test="expression"</code> attribute. The expression may refer to the parameter being declared (and to no other parameters or local variables). For the template rule to match, any parameters having a test attribute must be satisfied: specifically, the test expression must have an effective boolean value of true. If no value is supplied for the parameter, then if required="yes" is specified, the template rule does not match; if required="no" is specified, the test is applied to its default value. The focus for evaluating the test expression is absent. The existence of the test has no effect on the priority of the template rule. An error evaluating the test expression means that the template rule does not match.</p>
<p>For example, this template rule</p>
<pre><code>&lt;xsl:template match="record(long, lat)"&gt;
  &lt;xsl:param name="country" test="$country = 'UK'" tunnel="yes" required="yes"/&gt;
  ....
&lt;/xsl:template&gt;
</code></pre>
<p>matches only if the tunnel parameter <code>$country</code> is present with the value "UK".</p>
<p>In some cases this capability can substitute for modes, except that the values are entirely dynamic.</p>
</div></details></div>
<div class="toot" id="created-107"><h2>Issue #107 created<span class="toot-id"> #created-107</span></h2><div class="pubdate">04 Jan at 22:01:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/107">https://github.com/qt4cg/qtspecs/issues/107</a></div><details><summary>Allow self::(a|b|c)</summary><div class="markup"><p>After an explicit axis specifier (including the abbreviated axis specifier "@", but not including the default axis specifier), allow a composite NodeTest that consists of a |-separated list of NodeTest's in parentheses. For example</p>
<p><code>@(id|name)</code></p>
<p><code>ancestor::(section|chapter)</code></p>
<p><code>child::(comment()|processing-instruction())</code></p>
<p>The composite NodeTest matches a node if any of its constituent NodeTest's matches.</p>
</div></details></div>
<div class="toot" id="created-106"><h2>Issue #106 created<span class="toot-id"> #created-106</span></h2><div class="pubdate">02 Jan at 02:25:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/106">https://github.com/qt4cg/qtspecs/issues/106</a></div><details><summary>Decorators' support</summary><div class="markup"><h3>Decorators</h3>
<p>A <strong>Decorator</strong> is a tool to wrap (extend/change/modify) the behavior of one or more existing functions without modifying their code.</p>
<p>There are many cases when <em><strong>we want to handle a call to a specific function <code>f()</code> and do some or all of the following</strong></em>:</p>
<ol>
<li>Perform some initial action based on the context and on the arguments in the call to <code>f()</code>.</li>
<li>Transform the set of the actual arguments on the call to some other set of argument values -- substituted arguments.</li>
<li>Decide whether or not to invoke <code>f()</code>, passing to it the actual arguments or the substituted ones, created in the previous step.</li>
<li>If we invoked the function in the previous step, we could do something with its result.</li>
<li>Perform some final processing that may (but does not have to) depend on the result of the invocation of <code>f()</code>.</li>
</ol>
<p><strong>Here is a small, typical problem</strong> that is well handled with decorators:</p>
<p>We want to have a tool to help us with debugging <em>any</em> function. When a function is called (and if we are in <em>Debug</em> mode), this tool will:</p>
<ul>
<li>Tell us that a call to the function was performed and will list  the function name and the parameters, passed to the function</li>
<li>Tell us what the result of the call to the function was</li>
</ul>
<p>We will be able to do such tracing with not just one but with all functions, whose behavior we want to observe.</p>
<pre><code class="language-xq">let $trace-decorator := function($debug as xs:boolean, $f as function(*))
    {
      let $theDecorator := function($args as array(*), $kw-args as map(*))
      {
        if($debug)
        then 
          let $func-name := (function-name($f), $kw-args("$funcName"))[1],
            $pre-msg := "Calling function " || $func-name || " with params: " || array:flatten(($args))
            || "," || map:for-each( $kw-args, function($key as xs:anyAtomicType, $val)
                                          {if($key ne "$funcName")
                                            then (" "|| string($key)||": " || string($val))
                                            else ()
                                          }),
            
            $result := $f($args, $kw-args),
            $post-msg := "Got result: " || string($result) || "&amp;#xA;"
           return
             ($pre-msg, $post-msg)
         else $f($args, $kw-args)
      }
      return $theDecorator
    },
    
    $upper := function($args as array(*), $kw-args as map(*))
    {
      let $txt := $args[1]
        return upper-case($txt)
    }
    
    return 
      (
        $trace-decorator(true(), $upper)(["hello"], map{"$funcName" : "$upper"}),
        $trace-decorator(true(), $upper)(["reader"], map{"$funcName" : "$upper"}),
        "=======================================================================",
        $trace-decorator(false(), $upper)(["hello"], map{"$funcName" : "$upper"}),
        $trace-decorator(false(), $upper)(["reader"], map{"$funcName" : "$upper"})
       )
</code></pre>
<p>The result of evaluating the above XPath 3.1 expression is exactly what we wanted to get:</p>
<blockquote>
<p>Calling function $upper with params: hello,
Got result: HELLO</p>
<p>Calling function $upper with params: reader,
Got result: READER</p>
<p>=======================================================================
HELLO
READER</p>
</blockquote>
<p>So, it is possible to write and use decorators even in XPath 3.1 as above. <strong>Then why XPath decorators are as rare as the white peacock</strong>?</p>
<p><img src="https://user-images.githubusercontent.com/10605892/147841450-5a8f5e94-db6a-4030-80b9-af17c0966763.jpg" alt="peacock">
Photo Via: aboutpetlife.com</p>
<p>The answer is simple: just try to write even the simplest decorator in XPath 3.1 and you'll know how difficult and error-prone this is.
This is why <strong>several programming languages provide special support for decorators</strong>:</p>
<ul>
<li>
<p><a href="https://en.wikipedia.org/wiki/Python_syntax_and_semantics#Decorators"><strong>Python</strong></a>: <a href="https://www.datacamp.com/community/tutorials/decorators-python"><strong><em>decorators</em></strong></a> are a standard feature of the language.</p>
<ul>
<li>A standard syntax is provided to declare that a function is being decorated by another function. Composition of multiple decorators is supported.</li>
<li>There is a standard Python way of getting "<em>any actual arguments</em>" with which the unknown in advance function (to be decorated) is called.</li>
<li>There is a standard Python way to call any function passing to it just an array (for its positional arguments) and a map (for its keyword arguments).</li>
</ul>
</li>
<li>
<p><a href="https://saul-mirone.github.io/a-complete-guide-to-typescript-decorator/"><strong>Typescript</strong></a>:</p>
<ul>
<li>A standard syntax is provided to declare that a function is being decorated by another function. Composition of multiple decorators is supported.</li>
<li>Decorators can be applied not only to methods but also to their parameters (and to classes, constructors, static and instance properties, accessors).</li>
<li>The actual parameters in calling the manipulated method are accessed in a standard way as a <strong><em>spread</em></strong> (the opposite of <strong><em>destructuring</em></strong>). The spread syntax is used both for getting the parameters and in providing them in the call to the manipulated method.</li>
</ul>
</li>
<li>
<p><a href="https://www.geeksforgeeks.org/what-are-decorators-and-how-are-they-used-in-javascript/"><strong>Javascript</strong></a> : Almost the same as in Typescript (above)</p>
</li>
<li>
<p><strong>.NET/C#</strong>: <a href="https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/attributes/"><strong>C# Attributes</strong></a>, and in particular <a href="http://www.castleproject.org/projects/dynamicproxy/"><strong>Dynamic Proxies on the Fly in the Castle project</strong></a>.</p>
</li>
<li>
<p><strong>Java</strong>: <strong><a href="http://perfectjpattern.sourceforge.net/dp-decorator.html">A PerfectJpattern implementation</a></strong></p>
</li>
</ul>
<h2>Goal of this proposal</h2>
<p><em>To provide standard XPath support for decorators, as seen in other languages</em> (above):</p>
<ol>
<li>Provide syntax for specifying the decoration of a function:</li>
</ol>
<p><strong>Update rule</strong>:</p>
<p>[<a href="https://www.saxonica.com/qt4specs/XP/xpath-40-diff.html#doc-xpath40-FullSignature"><strong>72</strong></a>] | FullSignature | ::= | "function" "(" ParamList? ")" TypeDeclaration?
-- | -- | -- | --</p>
<p><strong>To</strong>:</p>
<p>[72] | FullSignature | ::= | ("^"  DecoratorReference)* "function" "(" ParamList? ")" TypeDeclaration?
-- | -- | -- | --</p>
<p><strong>And add this new rule</strong>:</p>
<p>[NN] | DecoratorReference | ::= |  VarRef ArgumentList? |  FunctionCall
-- | -- | -- | --</p>
<ol start="2">
<li>
<p>When a decorated function is called, the XPath processor should create from the actual arguments of the call <strong>an array <em><code>$args</code></em> that holds all positionally-specified arguments</strong> in the call, and <strong>a map <em><code>$kw-args</code></em> that will hold the name - value pairs of all keyword-arguments</strong> in the call. Then the decorator will be called with these two arguments: <strong><code>($args, $kw-args)</code></strong> in addition to any of its own positional arguments (if it has any).</p>
<p><strong><code>^decorator-name $funcName</code></strong></p>
<p>is converted behind the scenes by the XPath engine to:</p>
<pre><code class="language-xq">let $funcName := decorator-name($funcName)
  return
  ...remaining code in the same scope
</code></pre>
<p>This redefining of the inline-function name allows us to reference the result of the decoration using the same function item name (<code>$funcName</code>) in the remainder of the current scope.</p>
</li>
<li>
<p>When any function is called just with two arguments: <strong><code>($args, $kw-args)</code></strong> (such as from a decorator), the XPath processor must perform everything necessary in order to call the function in the way it expects to be called. For this purpose, <strong>a new overload of  <a href="https://www.saxonica.com/qt4specs/FO/Overview-diff.html#func-apply"><code>fn:apply()</code></a> is defined</strong> (<a href="https://github.com/qt4cg/qtspecs/issues/146">proposed separately here</a>):</p>
</li>
</ol>
<blockquote>
<p><strong><code>fn:apply</code></strong><code>($function as function(*), $array as array(*), $map as map(*)) as item()*</code></p>
<p><strong>The result</strong> of the function is obtained by creating and invoking the same dynamic call that would be the result of  a  function-call to <code>$function</code> with (positional) arguments taken from the members of the supplied array <code>$array</code> and (keyword arguments) taken from <code>$map</code>.</p>
<p><strong>The effect of calling</strong> <code>fn:apply($f, [$a, $b, $c, ...], map{"k1" : v1, "k2" : v2, ...})</code> is the same as the effect of the dynamic function call resulting from <code>$function($a, $b, $c, ...., $k1 = v1, $k2 = v2, ...)</code>. The function conversion rules are applied to the supplied arguments in the usual way.</p>
</blockquote>
<hr>
<p><strong>Example</strong>:</p>
<p>With this support added to the language, we simply write:</p>
<pre><code class="language-xq">let $f := $trace-decorator(true()) ( upper-case#1 )
  return
    ("hello", "reader") ! $f()
</code></pre>
<p>which produces the same correct result:</p>
<blockquote>
<p>Calling function upper-case with params: hello,
Got result: HELLO</p>
<p>Calling function upper-case with params: reader,
Got result: READER</p>
</blockquote>
<p>And this:</p>
<pre><code class="language-xq">let $f := $trace-decorator(false())  ( upper-case#1 )
  return
    ("hello", "reader") ! $f()
</code></pre>
<p>Produces just the normal result of executing the original function <code>$f()</code>, as the $debug argument is <code>false()</code> here</p>
<blockquote>
<p>HELLO
READER</p>
</blockquote>
<p><strong>When we decorate an inline-function</strong> (say the $upper from the initial example), we can even simply write:</p>
<pre><code class="language-xq">^$trace-decorator(true())  $upper,
.   .   .   .   .
  return
    ("hello", "reader") ! $upper()
</code></pre>
<p>to get again the the correct result:</p>
<blockquote>
<p>Calling function $upper with params: hello,
Got result: HELLO</p>
<p>Calling function $upper with params: reader,
Got result: READER</p>
</blockquote>
<p><strong>Do note</strong>:</p>
<ol>
<li>The decorator and the manipulated function are completely independent of each other and may be written long before / after each other and by different people who may not be aware of each other.</li>
<li>They can reside in different code files.</li>
<li>We can have a library of useful decorator functions and can append them to decorate any wanted function.</li>
<li>As the updated <strong><em><code>Rule 72</code></em></strong> above suggests, <strong>one can specify a chain of decorators</strong> manipulating a specific function. The inner-most decorator is passed to the next-inner-most-decorator, and so on..., which is passed ... to the outer-most decorator. <strong>Decorating is right-associative</strong>.
The different decorators specified don't know about each other, are completely independent and may be written by different authors at any times and reside in different, unrelated function libraries.</li>
</ol>
</div></details></div></div></article></main></body></html>