<!DOCTYPE HTML><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta charset="UTF-8"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1"><link rel="stylesheet" href="/css/status.css"><title>@qt4cg statuses</title></head><body><main><article><h1>@qt4cg statuses</h1><p>This page displays recent status
            updates
            about the QT4CG project.</p><p>The are also captured in <a href="status.rss">an RSS feed</a>.</p><p>By year: <a href="2025/">2025</a>, <a href="2024/">2024</a>, <a href="2023/">2023</a>, <a href="2022/">2022</a>, <a href="2021/">2021</a>, <a href="2020/">2020</a></p><div class="toots">
<div class="toot" id="agenda-01-28"><h2>QT4 CG meeting 107 draft agenda<span class="toot-id"> #agenda-01-28</span></h2><div class="pubdate">27 Jan at 09:30:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/agenda/2025/01-28">https://qt4cg.org/meeting/agenda/2025/01-28</a></div><p>Draft agenda published.</p></div>
<div class="toot" id="created-1732"><h2>Pull request #1732 created<span class="toot-id"> #created-1732</span></h2><div class="pubdate">26 Jan at 22:12:14 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1732">https://github.com/qt4cg/qtspecs/pull/1732</a></div><details><summary>1720 grammar simplification</summary><div class="markup"><p>This PR primarily affects the grammar file, simplifying it to remove most of the material that is only there to support the generation of a JavaCC parser (which has probably not been achievable since XPath/XQuery 2.0).</p>
<p>The section of the grammar that defines the binary operators starting with <code>OrExpr</code> is now expressed using conventional production rules, rather than the precedence-based grammar previously used. This allows deletion of some convoluted code in grammar2spec.xsl.</p>
<p>The DTD for the grammar file is revised to exclude many constructs that are no longer used.</p>
<p>Many simple token definitions (especially those that consist of a simple constant string) have been inlined.</p>
<p>Fix #1720</p>
</div></details></div>
<div class="toot" id="created-1731"><h2>Pull request #1731 created<span class="toot-id"> #created-1731</span></h2><div class="pubdate">25 Jan at 23:20:57 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1731">https://github.com/qt4cg/qtspecs/pull/1731</a></div><details><summary>1719 drop shared spec from build</summary><div class="markup"><p>Removes tasks from the gradle build, and associated stylesheets, that are there only to construct the "shared XPath/XQuery specification" which is no longer used by the editors or made visible to readers.</p>
<p>Also fixes a couple of link errors/warnings in the build.</p>
<p>Fix #1719</p>
</div></details></div>
<div class="toot" id="created-1730"><h2>Issue #1730 created<span class="toot-id"> #created-1730</span></h2><div class="pubdate">25 Jan at 18:03:46 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1730">https://github.com/qt4cg/qtspecs/issues/1730</a></div><details><summary>Consistency in default handling of map duplicates</summary><div class="markup"><p>In 3.1:</p>
<ul>
<li><code>map:merge()</code> defaults to duplicates = use-first</li>
<li><code>xsl:map</code> defaults to duplicates = reject</li>
</ul>
<p>In 4.0</p>
<ul>
<li><code>map:build</code> defaults to duplicates = combine</li>
<li><code>map:of-pairs</code> defaults to duplicates = combine</li>
</ul>
<p>Should we try to align the defaults?</p>
</div></details></div>
<div class="toot" id="created-1729"><h2>Issue #1729 created<span class="toot-id"> #created-1729</span></h2><div class="pubdate">24 Jan at 22:04:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1729">https://github.com/qt4cg/qtspecs/issues/1729</a></div><details><summary>Grammar problems introduced by #1721</summary><div class="markup"><p>Some productions of the XQuery 4.0 grammar were made obsolete by recent changes, but still occur in the document:</p>
<ul>
<li><code>StringConstructorStart</code></li>
<li><code>StringInterpolationStart</code></li>
<li><code>StringInterpolationEnd</code></li>
<li><code>StringConstructorEnd</code></li>
<li><code>TagQName</code></li>
<li><code>EndTagQName</code></li>
<li><code>ProcessingInstructionStart</code></li>
<li><code>ProcessingInstructionEnd</code></li>
<li><code>DirCommentContentChar</code></li>
<li><code>DirCommentContentDashChar</code></li>
</ul>
<p>Also, the replacement of <code>declare record</code> by <code>declare type record</code> has intoduced a new ambiguity. For example, with the input</p>
<pre><code class="language-xquery">declare type A as xs:integer;
declare type record as (A);
</code></pre>
<p>it remains unclear whether the second line declares a  type named "record", in which case</p>
<pre><code class="language-xquery">42 instance of record
</code></pre>
<p>or a type named "as", where</p>
<pre><code class="language-xquery">{'A': 42} instance of as
</code></pre>
<p>My proposal would be return to <code>declare record</code>. There are also 13 examples in the document using <code>declare record</code>.</p>
</div></details></div>
<div class="toot" id="closed-1723"><h2>Issue #1723 closed<span class="toot-id"> #closed-1723</span></h2><div class="pubdate">24 Jan at 21:00:42 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1723">https://github.com/qt4cg/qtspecs/issues/1723</a></div><p>`ThenAction` left over after removal of `BracedActions`</p></div>
<div class="toot" id="created-1728"><h2>Pull request #1728 created<span class="toot-id"> #created-1728</span></h2><div class="pubdate">24 Jan at 13:15:53 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1728">https://github.com/qt4cg/qtspecs/pull/1728</a></div><details><summary>Fix CSS for production tables</summary><div class="markup"><p>This PR removes some extraneous space between the rows and columns in the production tables (cellspacing) and turns off the odd grey background on comments. (I don't think the grey backbround was helping any, but if you disagree...)</p>
</div></details></div>
<div class="toot" id="closed-1721"><h2>Issue #1721 closed<span class="toot-id"> #closed-1721</span></h2><div class="pubdate">24 Jan at 13:01:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1721">https://github.com/qt4cg/qtspecs/pull/1721</a></div><p>1713 Revise code for generating production rules</p></div>
<div class="toot" id="created-1727"><h2>Pull request #1727 created<span class="toot-id"> #created-1727</span></h2><div class="pubdate">23 Jan at 17:58:36 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1727">https://github.com/qt4cg/qtspecs/pull/1727</a></div><details><summary>1725 Define more detailed rules for duplicates in maps</summary><div class="markup"><p>Clarifies the rules for how duplicates are handled by map:merge, map:build, map:of-pairs, and xsl:map.</p>
<p>Introduces a callback option for map:merge that is compatible with map:build and map:of-pairs, to increase commonality between all four functions/instructions.</p>
<p>Fix #1725</p>
</div></details></div>
<div class="toot" id="closed-1726"><h2>Issue #1726 closed<span class="toot-id"> #closed-1726</span></h2><div class="pubdate">23 Jan at 16:50:50 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1726">https://github.com/qt4cg/qtspecs/pull/1726</a></div><p>1726 Control order when map input has duplicate keys</p></div>
<div class="toot" id="created-1726"><h2>Pull request #1726 created<span class="toot-id"> #created-1726</span></h2><div class="pubdate">23 Jan at 12:54:05 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1726">https://github.com/qt4cg/qtspecs/pull/1726</a></div><p>1726 Control order when map input has duplicate keys</p></div>
<div class="toot" id="created-1725"><h2>Issue #1725 created<span class="toot-id"> #created-1725</span></h2><div class="pubdate">23 Jan at 11:20:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1725">https://github.com/qt4cg/qtspecs/issues/1725</a></div><details><summary>Position of duplicates in ordered maps</summary><div class="markup"><p>It became clear to me when writing test cases that the specs aren't entirely clear about what happens when building a map from an input sequence that contains duplicate keys. It says clearly what entry should be created for the duplicated key, but it doesn't say clearly where this entry should appear in the result.</p>
<p>There are four functions/instructions that this applies to: map:merge, map:build, map:of-pairs, and xsl:map.</p>
<p>I propose that in each case, the position of the entry for the duplicated key in the resulting map should correspond to the position of the first occurrence of that key in the input sequence. That is, "order of first appearance": the effect should be the same as if new entries are always created using a map:put() operation.</p>
<p>This might be slightly unexpected in the case of <code>map:merge()</code> with the option <code>duplicates=use-last</code>. It means the value will be that of the last duplicate, but its position will be that of the first duplicate. However, the other three functions/instructions achieve the effect of use-last with the callback <code>on-duplicates=fn{$a, $b){$a}</code> which only controls the value of the entry, and cannot be used to control its position, and I think it makes sense for <code>map:merge</code> with <code>duplicates=use-last</code> to behave in the same way.</p>
<p>Of course we could introduce a separate option to control the position of the combined entry, but I think that would be overkill. <code>xsl:for-each-group</code> and <code>distinct-values</code> both use the "order of first appearance" rule and this has never caused any problems. (<code>group-by</code> in XQuery delivers groups in implementation-dependent order, however).</p>
</div></details></div>
<div class="toot" id="created-1724"><h2>Issue #1724 created<span class="toot-id"> #created-1724</span></h2><div class="pubdate">22 Jan at 23:54:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1724">https://github.com/qt4cg/qtspecs/issues/1724</a></div><details><summary>Allow @copy-namespaces on &lt;xsl:mode&gt;?</summary><div class="markup"><p>As part of an XSLT transformation I need to remove an unused (anywhere) namespace declaration and <code>&lt;xsl:mode on-no-match="shallow-copy"/&gt;</code> doesn’t appear to accept a <code>@copy-namespaces</code> attribute where I can tell it not to copy unused namespaces. The unused namespace was used on a single attribute on the input document, but I’m removing the attribute entirely as part of the transformation, so nothing will remain in the output document that uses the namespace in question. With <code>&lt;xsl:mode on-no-match="shallow-copy"/&gt;</code> the namespace declaration is copied into the result, even though it is not used. If I use the old identity template and set the value of <code>@copy-namespaces</code> on it to something falsy, I get the result I want, that is, no unneeded namespace declaration.</p>
<p>Insofar as <code>&lt;xsl:mode on-no-match="shallow-copy"/&gt;</code> has come to fill the role formerly occupied by the identity template, would it be reasonable to allow it also to declare that unused namespaces should not be copied? If that request is reasonable, is it reasonable to think of it as a bug fix, rather than a new-feature request?</p>
</div></details></div>
<div class="toot" id="created-1723"><h2>Issue #1723 created<span class="toot-id"> #created-1723</span></h2><div class="pubdate">22 Jan at 22:07:49 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1723">https://github.com/qt4cg/qtspecs/issues/1723</a></div><details><summary>`ThenAction` left over after removal of `BracedActions`</summary><div class="markup"><p>Thanks for fixing the <code>IfExpr</code> ambiguity.</p>
<p>In #1712, <code>BracedAction</code> was introduced to replace the previous rules for braced actions. Of these, <code>ThenAction</code> still appears in the EBNF summary, but it is no longer referenced.</p>
</div></details></div>
<div class="toot" id="closed-1651"><h2>Issue #1651 closed<span class="toot-id"> #closed-1651</span></h2><div class="pubdate">22 Jan at 17:27:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1651">https://github.com/qt4cg/qtspecs/issues/1651</a></div><p>Ordered Maps: maps that retain insertion order</p></div>
<div class="toot" id="closed-1703"><h2>Issue #1703 closed<span class="toot-id"> #closed-1703</span></h2><div class="pubdate">22 Jan at 17:27:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1703">https://github.com/qt4cg/qtspecs/pull/1703</a></div><p>1651 ordered maps</p></div>
<div class="toot" id="closed-1709"><h2>Issue #1709 closed<span class="toot-id"> #closed-1709</span></h2><div class="pubdate">22 Jan at 11:55:07 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1709">https://github.com/qt4cg/qtspecs/issues/1709</a></div><p>Extend diagram of item types to include record types etc</p></div>
<div class="toot" id="created-1722"><h2>Pull request #1722 created<span class="toot-id"> #created-1722</span></h2><div class="pubdate">22 Jan at 11:46:31 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1722">https://github.com/qt4cg/qtspecs/pull/1722</a></div><details><summary>1717 define focus functions using pipeline operator</summary><div class="markup"><p>Fix #1717</p>
<p>Provides a formal definition of focus functions making use of the new pipeline operator.</p>
</div></details></div>
<div class="toot" id="created-1721"><h2>Pull request #1721 created<span class="toot-id"> #created-1721</span></h2><div class="pubdate">22 Jan at 11:27:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1721">https://github.com/qt4cg/qtspecs/pull/1721</a></div><details><summary>1713 Revise code for generating production rules</summary><div class="markup"><p>The main change here is to change the way "scraps" are expanded: these are the local collections of production rules that appear inline within the spec. These are now driven by a single <code>prodrecap</code> element naming the rule to be expanded, and the logic is now automated for deciding (a) which subsidiary production rules to include in the scrap, and (b) which occurrence of a production rule to use as the target for a hyperlinked reference to that rule, depending on where the reference appears.</p>
<p>Along with this there has been a fair bit of deletion of legacy code and general modernisation (e.g using XSLT 2.0 and 3.0 constructs where appropriate).</p>
</div></details></div>
<div class="toot" id="created-1720"><h2>Issue #1720 created<span class="toot-id"> #created-1720</span></h2><div class="pubdate">22 Jan at 10:50:32 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1720">https://github.com/qt4cg/qtspecs/issues/1720</a></div><details><summary>Grammar overhaul</summary><div class="markup"><p>There is a lot of dead wood in the xpath-grammar.xml file. This issue is raised to capture some observations and suggestions about how it can be simplified.</p>
<ul>
<li>The DTD lists 19 attributes that can appear on g:token, and documents the meaning of 5 of them (very briefly). I suspect that many of the attributes are never used. Many of them were probably intended primarily for use by the JavaCC parser generator.</li>
<li>As if that weren't enough, the grammar2spec stylesheet has logic that looks for additional attributes (an example is <code>@alias-for</code>) which are not even allowed by the DTD let alone being in active use.</li>
<li>The "if" logic to assign productions to different languages (xpath, xquery, XSLT patterns) is hard to maintain and could be automated: just search for productions that are reachable from the top-level production for each language. This could be done by a preprocessing stylesheet that generates a grammar file for each language.</li>
<li>The switch into a precedence-based grammar for binary operators (g:exprProduction name="OperatorExpr") doesn't really help anyone. For generating production rules in the spec, it just complicates the generation logic. The same is true for anyone else writing applications that use the grammar as input. It doesn't really make life easier for maintainers of the grammar, because it means there is more to learn.</li>
</ul>
<p>All the JavaCC machinery is still in the repo and I think it could probably go. Leaving stuff like that lying around makes things more difficult when you need to search filestore for references to things.</p>
</div></details></div>
<div class="toot" id="created-1719"><h2>Issue #1719 created<span class="toot-id"> #created-1719</span></h2><div class="pubdate">21 Jan at 22:57:23 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1719">https://github.com/qt4cg/qtspecs/issues/1719</a></div><details><summary>Purging dead build code</summary><div class="markup"><p>In the course of working on #1713 I've been exploring some dark corners of the build system. There's a lot of dead code. Some of it might come in useful in the future (e.g. code supporting XQuery Update) but most will be very hard to revive. For example there's a lot of grammar machinery which is there only to allow generation of a JavaCC parser.</p>
<p>The main purpose of this issue is to capture notes that might lead to some reduction of technical debt.</p>
<p>The gradle build is currently giving me</p>
<blockquote>
<p>Warning: link-text-with-check was unable to make a link for $ref-id="doc-shared40-Prolog"</p>
</blockquote>
<p>That message comes from <code>xmlspec-override.xsl</code>. This stylesheet looks like dead code because it has lots of references to XPath30 and XQuery30. But it can't be completely dead if we're getting errors from it. It's imported from two places: xpath-functions-30.xsl in the F&amp;O tree and shared.xsl in the xquery40 tree. The message comes from gradle task <code>xquery_shared_html</code>. As far as I can see the build system is constructing an XPath specification, an XQuery specification, and a "shared" specification which is a union of the two. (It starts off "XQuery 4.0 and XPath 4.0 is an expression language that allows..."). Presumably this was intended to allow editors and WG members to review a single document rather than reviewing XPath and XQuery separately. But I don't think it's used today, I think we could kill it off.</p>
<p>shared.xsl is referenced only from build.gradle when building the shared specification.</p>
<p>xpath-functions-30.xsl doesn't appear to be referenced from anywhere, and it carries a comment saying</p>
<pre><code> Created 17 Dec 2008 by MHK.
 No longer used 16 Feb 2009?
</code></pre>
<p>In the short term I've deleted the code in xmlspec-override.xsl starting with the comment "Our inability to create a link for $ref-id may be a sign of something wrong, so...". This gets rid of the warning messages. In the longer term, subject to confirmation, I think we can delete the build targets associated with the "shared" language spec, and delete the stylesheets xmlspec-override.xsl, xpath-functions-30.xsl, and shared.xsl.</p>
</div></details></div>
<div class="toot" id="created-1718"><h2>Issue #1718 created<span class="toot-id"> #created-1718</span></h2><div class="pubdate">21 Jan at 17:45:35 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1718">https://github.com/qt4cg/qtspecs/issues/1718</a></div><details><summary>Ordered Maps: positions in callback functions</summary><div class="markup"><p>Now that maps have a defined order, we should add the position to HOF parameters in map functions (in alignment with sequence and array functions). Examples:</p>
<pre><code class="language-xquery">map:for-each(
  $map     as map(*),	
  $action  as fn($key as xs:anyAtomicType, $value as item()*, $pos as xs:integer) as item()*	
) as item()*

map:filter(
  $map        as map(*),	
  $predicate  as fn($key as xs:anyAtomicType, $value as item()*, $pos as xs:integer) as xs:boolean?	
) as map(*)
</code></pre>
</div></details></div>
<div class="toot" id="minutes—01-21"><h2>QT4 CG meeting 106 draft minutes<span class="toot-id"> #minutes—01-21</span></h2><div class="pubdate">21 Jan at 17:40:00 GMT</div><div class="link">Link: <a href="https://qt4cg.org/meeting/minutes/2025/01-21">https://qt4cg.org/meeting/minutes/2025/01-21</a></div><p>Draft minutes published.</p></div>
<div class="toot" id="closed-1706"><h2>Issue #1706 closed<span class="toot-id"> #closed-1706</span></h2><div class="pubdate">21 Jan at 17:22:44 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1706">https://github.com/qt4cg/qtspecs/issues/1706</a></div><p>Ambiguous `if` syntax</p></div>
<div class="toot" id="closed-1712"><h2>Issue #1712 closed<span class="toot-id"> #closed-1712</span></h2><div class="pubdate">21 Jan at 17:22:43 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1712">https://github.com/qt4cg/qtspecs/pull/1712</a></div><p>1706 Drop "else if" and "else" clauses from braced conditionals</p></div>
<div class="toot" id="closed-1685"><h2>Issue #1685 closed<span class="toot-id"> #closed-1685</span></h2><div class="pubdate">21 Jan at 17:20:39 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1685">https://github.com/qt4cg/qtspecs/issues/1685</a></div><p>Pipeline Operator</p></div>
<div class="toot" id="closed-1686"><h2>Issue #1686 closed<span class="toot-id"> #closed-1686</span></h2><div class="pubdate">21 Jan at 17:20:38 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1686">https://github.com/qt4cg/qtspecs/pull/1686</a></div><p>1685 Pipeline Operator</p></div>
<div class="toot" id="closed-1701"><h2>Issue #1701 closed<span class="toot-id"> #closed-1701</span></h2><div class="pubdate">21 Jan at 17:18:47 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1701">https://github.com/qt4cg/qtspecs/pull/1701</a></div><p>Add dedication to MSM (action QT4CG-088-01)</p></div>
<div class="toot" id="closed-1705"><h2>Issue #1705 closed<span class="toot-id"> #closed-1705</span></h2><div class="pubdate">21 Jan at 17:16:22 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/issues/1705">https://github.com/qt4cg/qtspecs/issues/1705</a></div><p>fn:divide-decimals, fn:round: large precision values</p></div>
<div class="toot" id="closed-1711"><h2>Issue #1711 closed<span class="toot-id"> #closed-1711</span></h2><div class="pubdate">21 Jan at 17:16:21 GMT</div><div class="link">Link: <a href="https://github.com/qt4cg/qtspecs/pull/1711">https://github.com/qt4cg/qtspecs/pull/1711</a></div><p>1705 Say that max precision is implementation-defined</p></div></div><p>See 3481
            more statuses in yearly archives.</p></article></main></body></html>